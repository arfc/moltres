<!DOCTYPE html><head><meta charset="UTF-8"><title>VacuumConcBC | Moltres</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/moltres.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../contrib/katex/katex.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Moltres</a><a href="https://github.com/arfc/moltres" class="right"><img src="../../media/framework/github-logo.png" alt="GitHub wordmark" class="github-mark"></img><img src="../../media/framework/github-mark.png" alt="GitHub logo" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="e83ea466-aa23-4636-a791-c67f185b5481" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="fda020ad-c972-4e5a-9299-020aa93abf1c" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="5971550a-4840-4dd1-99be-a1fad33d97b4" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#" class="sidenav-trigger" data-target="24e22693-0152-4fce-a39f-3cc303e2ddb5"><i class="material-icons">menu</i></a><ul class="sidenav" id="24e22693-0152-4fce-a39f-3cc303e2ddb5"><li><a href="#!" class="dropdown-trigger" data-target="14c7ff69-85f1-44ce-b72c-55e5cdc1b305" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="ec9ccd8d-77fc-4aec-8b68-17721810a7a6" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="cac22171-5541-4e6e-a4ca-ae950f56d855" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="e83ea466-aa23-4636-a791-c67f185b5481"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/theory.html">Theory</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="fda020ad-c972-4e5a-9299-020aa93abf1c"><li><a href="../../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="5971550a-4840-4dd1-99be-a1fad33d97b4"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul><ul class="dropdown-content" id="14c7ff69-85f1-44ce-b72c-55e5cdc1b305"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/theory.html">Theory</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="ec9ccd8d-77fc-4aec-8b68-17721810a7a6"><li><a href="../../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="cac22171-5541-4e6e-a4ca-ae950f56d855"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><span class="breadcrumb">source</span><span class="breadcrumb">bcs</span><a href="#" class="breadcrumb">VacuumConcBC</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="7f34a767-607e-4831-91c7-3613c5f45434" data-section-level="1" data-section-text="VacuumConcBC"><h1 id="vacuumconcbc">VacuumConcBC</h1><p></p><section class="scrollspy" id="535025e4-fcd3-40aa-93eb-1825b97b7c19" data-section-level="2" data-section-text="Overview"><h2 id="overview">Overview</h2><p>This object adds the <span class="moose-katex-inline-equation" id="moose-equation-3d3a98c4-eef7-49dc-826a-bb6ff7a31bd2"><script>var element = document.getElementById("moose-equation-3d3a98c4-eef7-49dc-826a-bb6ff7a31bd2");katex.render("\\phi_g+\\alpha D_g\\hat{n}\\cdot\\nabla\\phi_g = 0", element, {displayMode:false,throwOnError:false});</script></span> vacuum boundary condition of the multigroup neutron diffusion equations. The weak form after applying integration by parts to the neutron diffusion term (<a href="../kernels/GroupDiffusion.html">GroupDiffusion</a>) is:</p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-ded2006d-e3ed-46f2-8187-da76e2e88e4b"></span><script>var element = document.getElementById("moose-equation-ded2006d-e3ed-46f2-8187-da76e2e88e4b");katex.render("-\\int_{\\partial V}\\psi D_g\\nabla\\phi_g\\cdot\\hat{n}\\ dS = \\int_{\\partial V}\\psi\\frac{\\phi_g}{\\alpha}\\ dS", element, {displayMode:true,throwOnError:false});</script></span><p>The value of <span class="moose-katex-inline-equation" id="moose-equation-db0e8e93-8695-43f2-abd0-b88174027027"><script>var element = document.getElementById("moose-equation-db0e8e93-8695-43f2-abd0-b88174027027");katex.render("\\alpha", element, {displayMode:false,throwOnError:false});</script></span> varies depending on the BC type selected using the <code>vacuum_bc_type</code> parameter. The available options are:</p><ol class="browser-default" start="1"><li><p>Marshak: <span class="moose-katex-inline-equation" id="moose-equation-1999d240-bbc9-4635-ade6-610c24f75e72"><script>var element = document.getElementById("moose-equation-1999d240-bbc9-4635-ade6-610c24f75e72");katex.render("\\alpha=2", element, {displayMode:false,throwOnError:false});</script></span> </p></li><li><p>Mark: <span class="moose-katex-inline-equation" id="moose-equation-dd00ee01-ebe7-46ff-b456-fb40a67e4018"><script>var element = document.getElementById("moose-equation-dd00ee01-ebe7-46ff-b456-fb40a67e4018");katex.render("\\alpha=\\sqrt{3}", element, {displayMode:false,throwOnError:false});</script></span> </p></li><li><p>Milne: <span class="moose-katex-inline-equation" id="moose-equation-c76f7205-7414-4658-a763-da1e67713d14"><script>var element = document.getElementById("moose-equation-c76f7205-7414-4658-a763-da1e67713d14");katex.render("\\alpha=3\\times 0.710446", element, {displayMode:false,throwOnError:false});</script></span></p></li></ol><p>The Marshak and Mark BCs are derived from vacuum boundary condition approximations using <span class="moose-katex-inline-equation" id="moose-equation-60071d22-85a6-4fc8-b8c0-52de4a02343a"><script>var element = document.getElementById("moose-equation-60071d22-85a6-4fc8-b8c0-52de4a02343a");katex.render("P_1", element, {displayMode:false,throwOnError:false});</script></span> and <span class="moose-katex-inline-equation" id="moose-equation-ef5e0042-7d7a-4662-bf93-8a175081150c"><script>var element = document.getElementById("moose-equation-ef5e0042-7d7a-4662-bf93-8a175081150c");katex.render("S_2", element, {displayMode:false,throwOnError:false});</script></span> transport methods, respectively. The Milne BC is derived from the exact analytical solution of the Milne problem (<a href="#placzek_milnes_1947">Placzek and Seidel, 1947</a>) and has been proven to be accurate for a wide range of diffusive problems (<a href="#rulko_variational_1995">Rulko et al., 1995</a>).</p></section><section class="scrollspy" id="ee37efc7-e98a-429a-8023-f57a69e05303" data-section-level="2" data-section-text="Example Input File Syntax"><h2 id="example-input-file-syntax">Example Input File Syntax</h2><p></p></section><section class="scrollspy" id="225fa35f-b338-438c-938e-387ebc866e89" data-section-level="2" data-section-text="Input Parameters"><h2 id="input-parameters">Input Parameters</h2><section id="b46eca7c-379f-48e0-b504-de1012bb5afe" data-section-level="3" data-section-text="Required Parameters" data-details-open="open"><details class="moose-section-content" open="open"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">boundary</span><span class="moose-parameter-header-description">The list of boundary IDs from the mesh where this object applies</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;BoundaryName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The list of boundary IDs from the mesh where this object applies</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">variable</span><span class="moose-parameter-header-description">The name of the variable that this residual object operates on</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>NonlinearVariableName</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of the variable that this residual object operates on</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Required Parameters</h3></summary></details></section><section id="99d0637a-dd2a-43ff-84b2-13e7983353eb" data-section-level="3" data-section-text="Optional Parameters" data-details-open="open"><details class="moose-section-content" open="open"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">displacements</span><span class="moose-parameter-header-description">The displacements</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;VariableName&gt;</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The displacements</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">matrix_only</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether this object is only doing assembly to matrices (no vectors)</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether this object is only doing assembly to matrices (no vectors)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">use_exp_form</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether concentrations should be in an expotential/logarithmic format.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether concentrations should be in an expotential/logarithmic format.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">vacuum_bc_type</span><span class="moose-parameter-header-default">marshak</span><span class="moose-parameter-header-description">Whether to apply Marshak, Mark, or Milne vacuum boundary conditions. Defaults to Marshak.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>marshak</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>marshak, mark, milne</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether to apply Marshak, Mark, or Milne vacuum boundary conditions. Defaults to Marshak.</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Optional Parameters</h3></summary></details></section><section id="e3029a22-093d-4b83-8091-93fe6103a63a" data-section-level="3" data-section-text="Contribution To Tagged Field Data Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">absolute_value_vector_tags</span><span class="moose-parameter-header-description">The tags for the vectors this residual object should fill with the absolute value of the residual contribution</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tags for the vectors this residual object should fill with the absolute value of the residual contribution</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">extra_matrix_tags</span><span class="moose-parameter-header-description">The extra tags for the matrices this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The extra tags for the matrices this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">extra_vector_tags</span><span class="moose-parameter-header-description">The extra tags for the vectors this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The extra tags for the vectors this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">matrix_tags</span><span class="moose-parameter-header-default">system</span><span class="moose-parameter-header-description">The tag for the matrices this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>system</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MultiMooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nontime, system</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tag for the matrices this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">vector_tags</span><span class="moose-parameter-header-default">nontime</span><span class="moose-parameter-header-description">The tag for the vectors this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>nontime</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MultiMooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nontime, time</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tag for the vectors this Kernel should fill</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Contribution To Tagged Field Data Parameters</h3></summary></details></section><section id="bf2fa6cc-afed-4eba-b9e0-7f4bcdfd1d8b" data-section-level="3" data-section-text="Advanced Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">control_tags</span><span class="moose-parameter-header-description">Adds user-defined labels for accessing object parameters via control logic.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;std::string&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Adds user-defined labels for accessing object parameters via control logic.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">diag_save_in</span><span class="moose-parameter-header-description">The name of auxiliary variables to save this BC's diagonal jacobian contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;AuxVariableName&gt;</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of auxiliary variables to save this BC's diagonal jacobian contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">enable</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Set the enabled status of the MooseObject.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>Yes</p><p class="moose-parameter-description"><span>Description:</span>Set the enabled status of the MooseObject.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">implicit</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Determines whether this object is calculated using an implicit or explicit form</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Determines whether this object is calculated using an implicit or explicit form</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">save_in</span><span class="moose-parameter-header-description">The name of auxiliary variables to save this BC's residual contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;AuxVariableName&gt;</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of auxiliary variables to save this BC's residual contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">search_method</span><span class="moose-parameter-header-default">nearest_node_connected_sides</span><span class="moose-parameter-header-description">Choice of search algorithm.  All options begin by finding the nearest node in the primary boundary to a query point in the secondary boundary.  In the default nearest_node_connected_sides algorithm, primary boundary elements are searched iff that nearest node is one of their nodes.  This is fast to determine via a pregenerated node-to-elem map and is robust on conforming meshes.  In the optional all_proximate_sides algorithm, primary boundary elements are searched iff they touch that nearest node, even if they are not topologically connected to it.  This is more CPU-intensive but is necessary for robustness on any boundary surfaces which has disconnections (such as Flex IGA meshes) or non-conformity (such as hanging nodes in adaptively h-refined meshes).</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>nearest_node_connected_sides</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nearest_node_connected_sides, all_proximate_sides</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Choice of search algorithm.  All options begin by finding the nearest node in the primary boundary to a query point in the secondary boundary.  In the default nearest_node_connected_sides algorithm, primary boundary elements are searched iff that nearest node is one of their nodes.  This is fast to determine via a pregenerated node-to-elem map and is robust on conforming meshes.  In the optional all_proximate_sides algorithm, primary boundary elements are searched iff they touch that nearest node, even if they are not topologically connected to it.  This is more CPU-intensive but is necessary for robustness on any boundary surfaces which has disconnections (such as Flex IGA meshes) or non-conformity (such as hanging nodes in adaptively h-refined meshes).</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">seed</span><span class="moose-parameter-header-default">0</span><span class="moose-parameter-header-description">The seed for the master random number generator</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>0</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The seed for the master random number generator</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">skip_execution_outside_variable_domain</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether to skip execution of this boundary condition when the variable it applies to is not defined on the boundary. This can facilitate setups with moving variable domains and fixed boundaries. Note that the FEProblem boundary-restricted integrity checks will also need to be turned off if using this option</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether to skip execution of this boundary condition when the variable it applies to is not defined on the boundary. This can facilitate setups with moving variable domains and fixed boundaries. Note that the FEProblem boundary-restricted integrity checks will also need to be turned off if using this option</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">use_displaced_mesh</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether or not this object should use the displaced mesh for computation.  Note that in the case this is true but no displacements are provided in the Mesh block the undisplaced mesh will still be used.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether or not this object should use the displaced mesh for computation.  Note that in the case this is true but no displacements are provided in the Mesh block the undisplaced mesh will still be used.</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Advanced Parameters</h3></summary></details></section><section id="bd0385cf-45a6-4490-be57-8f4deda535cd" data-section-level="3" data-section-text="Material Property Retrieval Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">prop_getter_suffix</span><span class="moose-parameter-header-description">An optional suffix parameter that can be appended to any attempt to retrieve/get material properties. The suffix will be prepended with a '_' character.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MaterialPropertyName</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>An optional suffix parameter that can be appended to any attempt to retrieve/get material properties. The suffix will be prepended with a '_' character.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">use_interpolated_state</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">For the old and older state use projected material properties interpolated at the quadrature points. To set up projection use the ProjectedStatefulMaterialStorageAction.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>For the old and older state use projected material properties interpolated at the quadrature points. To set up projection use the ProjectedStatefulMaterialStorageAction.</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Material Property Retrieval Parameters</h3></summary></details></section></section><section class="scrollspy" id="5b11cf10-8b54-4ac7-8a9a-1c7900f95b0a" data-section-level="2" data-section-text="Input Files"><h2 id="input-files">Input Files</h2><ul class="moose-list-inputs browser-default"><li><a class="moose-source-filename tooltipped modal-trigger" href="#af9bca88-645d-464b-b8d8-b2505bcad361">(problems/022317_test_critical_neutronics_only_reactor/k-eig-922.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6b10b024-ac3a-442f-9a0c-8a584bd99360">(problems/publication_level_cases/3d_steady_state/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e1f5218e-22cd-4392-b8a0-56f1091eca00">(problems/LOSCA/HXFailure/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#2eab468c-b6f2-4422-b41a-8953183b75b3">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_restart.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9a046e7e-709e-47ae-9c9c-cf2d2f7e8b43">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_control.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9e490a82-7e13-4d8f-8033-d28b2bdee153">(problems/022317_test_critical_neutronics_only_reactor/k-eig-msre-file-mesh-two-grp.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b8589726-847b-408a-9565-5f7b800a5730">(problems/LOFA/steady/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6aa4d8ce-700c-4cd7-a772-a8fb2b35a4c3">(problems/picard/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#88350f30-ae54-4935-a2a9-c8fe86be99e6">(tutorial/transient/transient.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#96c35d85-3b49-4686-a6e7-b4b4f32a5ed2">(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#55bcbbbc-31e9-47fd-b01d-42ab19b31c1d">(problems/072017_dg_temperature/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#43441bff-d242-430f-bae3-aad9f8b241bc">(tutorial/eigenvalue/nts.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#ba7ab5d7-a293-4a03-9b0e-21ac231ea336">(problems/LOFA/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#543d0686-e4ac-4f56-b2e2-6257c6fd8323">(problems/022317_test_critical_neutronics_only_reactor/transient-msre-file-mesh-two-grp-two-b1-mat.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#3ebffb70-2e94-46ec-b1f7-e0c0b5bb31de">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9dbcdc3e-5e2a-4c1e-9cda-f65187503f8d">(problems/022317_test_critical_neutronics_only_reactor/k-eigen-gen-mesh-should-be-crit-one-group.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6a0eebea-b028-4536-a7b3-13ee076f37e1">(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#cec042bd-6e33-494f-a0a3-1d6761027e1e">(problems/022317_test_critical_neutronics_only_reactor/k-eigen-gen-mesh-rad-57-mc-gcs.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#88542fe4-ee15-4688-9d03-22332c57d5b9">(problems/022317_test_critical_neutronics_only_reactor/k-eigen-gen-mesh-rad-73-mc-gcs.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#63222f19-2f96-4e02-8461-120d142f957d">(problems/publication_level_cases/transient_single_channel_blockage/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#eead7c16-4a5e-4f32-a163-b1c719b36877">(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-b1-two-mat.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#994a29d0-215a-4362-b6fb-4145401fda24">(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-channel-msre-dimensions.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9cecf39d-ede1-4cf5-953b-ff01b330daea">(problems/LOSCA/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#d3b63bb3-89b0-4a27-af12-5243fb72a567">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_direct.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9085f8e0-5102-4bf7-a073-f2428773c2d1">(problems/single_msre_channel_velocity_heat_nts/nts-eigenvalue-msre-channel-dimensions.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#d653f4a2-48b6-47a0-ae4c-cac51ab2cadb">(problems/picard/tmp_nts.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#cb84c6d5-55f0-4950-ba6d-1cd5bec33f49">(problems/022317_test_critical_neutronics_only_reactor/k-eig-one-channel-two-grp-two-mat-scale.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#303e5532-3a72-499f-8a13-8ea9f7b6a416">(tests/coupled/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#817d6749-f765-4d94-a2a9-fec8659f4a34">(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6c6854fa-8d70-4cc9-92cc-4ee694dbc19e">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive_PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b26dd454-5b7d-4cd3-a564-fb5d3dffcfe0">(problems/publication_level_cases/gamma_heating_3d_ss/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e61f5a5e-6799-4ea1-8935-7510d0b49889">(problems/publication_level_cases/LOSCA/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#659689f1-79b4-4791-a82a-83278449c882">(problems/070517_4group/eigen/eigen.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#5762cc72-ff2a-4c9b-92a2-1dfb2ee92357">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#14790d4f-0664-40ce-9dfb-76a9b81c646d">(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-unit-cell.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#c0668b1c-feb7-4583-bba8-d5200cfe6c1f">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_monotone_interp.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b93b372f-5c55-4511-b277-ba6009d89327">(problems/060717_dimension_testing/test_case.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#f3d4a51a-edc8-467f-bb96-a1c1721ef1f3">(problems/publication_level_cases/transient_single_channel_blockage/3d_ss.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#755609fb-6672-4b8d-9ff4-6c6c61a29b8a">(problems/033117_nts_temp_pre_parsed_mat/controlled_neutronics_only.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#4f2b7c16-7fdc-46f7-9939-823665830c1d">(problems/publication_level_cases/LOSCA/HXFail/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#793704ee-2c0c-4e66-81e1-2ea9bd1f3d2c">(tests/coupled/auto_diff_rho_serpent.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#990e2679-ea4b-4f5f-925e-14dd9b41ee3c">(problems/single_msre_channel_velocity_heat_nts/unit-cell-heat-and-nts.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#af49e46e-3fcb-424f-bd92-f26d9590ca3c">(problems/033117_nts_temp_pre_parsed_mat/2d_axi_function_cross_sections_eigen.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6cde8166-d024-47c6-b80c-8055e853e724">(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-mod-heat-PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#201c8f36-0fad-4bdc-b8cd-ef8209784905">(problems/060717_dimension_testing/one_group_nts_only.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#af315562-cd70-4a8a-9713-7a6af3b1f685">(problems/picard/nts_no_pres.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#02657681-8a09-4d2a-be61-eb8672c40bc0">(problems/033117_nts_temp_pre_parsed_mat/2d_axi_function_cross_sections.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#94e5f4c6-3e3e-4fa0-9665-ecb269f769a6">(problems/033117_nts_temp_pre_parsed_mat/3d_eigen_function_materials.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#a43e66fa-529a-4c0a-a9c0-b9906270f77a">(problems/060717_dimension_testing/one_group.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#5ab83f37-e33c-4ee1-b8dc-6b9fbcfcd7c3">(problems/022317_test_critical_neutronics_only_reactor/k-eig-1022.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#363142dc-bfc5-49a3-9320-3f76b0fd2cb5">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#7d5b0470-a63d-427f-8594-6786279466d6">(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-scale-two-mat-inverted-file-msh.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#88c60534-2aef-4e4d-8340-775e3926caf6">(tests/bcs/vacuum_bc.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#bd270469-d2d8-4850-8939-84f9ca062753">(problems/publication_level_cases/dilute_absorber_controlled_by_peak_power_density/in.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6d42d3d0-ef6c-4c1d-b712-95ea09138267">(problems/constant_inlet_outlet_temp_no_heat_flux_at_walls/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#07d02e44-b2d5-4167-9e3b-6dd1992e331f">(problems/single_msre_channel_velocity_heat_nts/unit-cell-nts-eigenvalue.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#f2ca3260-ee00-4f46-9dd7-5e406dfbcd05">(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function_moderator_heating.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#71cb4d26-0835-4f63-a879-a699a64d7ec7">(problems/picard/nts.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#7ef67d12-3b20-44ca-b584-e28e2f6c81c6">(problems/022317_test_critical_neutronics_only_reactor/k-eig-msre-file-mesh-two-grp-two-mat.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#15cb69c7-d625-4878-8860-dc67d8bc1551">(problems/033117_nts_temp_pre_parsed_mat/3d_nts_only.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#7ad92aa0-c81d-4913-aa7f-01da66c1047e">(problems/022317_test_critical_neutronics_only_reactor/k-eigen-problem.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#f5822756-d516-4e8c-a636-4e0b6196a51b">(problems/033117_nts_temp_pre_parsed_mat/meigen.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#3d97f55e-7f23-4bf1-b1a2-cefbae2f7619">(tests/nts/nts_no_action.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#f0446f6c-4ede-4fbc-9123-cab7e97a17b1">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#24f2f305-3347-4b73-89eb-45cd515556e5">(problems/022317_test_critical_neutronics_only_reactor/k-eig-inverted-file-mesh-two-grp-two-mat.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#2163b12c-5bb6-4a7b-8348-e7d321293bed">(problems/022317_test_critical_neutronics_only_reactor/k-eigen-gen-mesh.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#a57e4bf3-f44c-4b54-b102-dc5f98c1e469">(problems/022317_test_critical_neutronics_only_reactor/k-eig-gen-msh-inf-one-grp.i)</a></li></ul></section><section class="scrollspy" id="7dd6bde3-ac51-46b7-af45-1bda93d9727e" data-section-level="2" data-section-text="References"><h2 id="references">References</h2><div class="moose-bibliography"><ol><li id="placzek_milnes_1947">G.&nbsp;Placzek and W.&nbsp;Seidel.
Milne's <span class="bibtex-protected">Problem</span> in <span class="bibtex-protected">Transport</span> <span class="bibtex-protected">Theory</span>.
<em>Physical Review</em>, 72(7):550–555, October 1947.
Publisher: American Physical Society.
URL: <a href="https://link.aps.org/doi/10.1103/PhysRev.72.550">https://link.aps.org/doi/10.1103/PhysRev.72.550</a> (visited on 2024-05-31), <a href="https://doi.org/10.1103/PhysRev.72.550">doi:10.1103/PhysRev.72.550</a>.<a href="#e74c2360-f0d6-4fb1-9858-71d0878ba8d9" class="modal-trigger moose-bibtex-modal" style="padding-left:10px;">[BibTeX]</a><div class="modal" id="e74c2360-f0d6-4fb1-9858-71d0878ba8d9"><div class="modal-content"><pre style="line-height:1.25;"><code class="language-latex">@article{placzek_milnes_1947,
    author = "Placzek, G. and Seidel, W.",
    title = "Milne's {Problem} in {Transport} {Theory}",
    volume = "72",
    url = "https://link.aps.org/doi/10.1103/PhysRev.72.550",
    doi = "10.1103/PhysRev.72.550",
    abstract = "A modified derivation of the Wiener-Hopf solution of Milne's problem is given in a form suitable for application to problems in the theory of neutron diffusion.",
    number = "7",
    urldate = "2024-05-31",
    journal = "Physical Review",
    month = "October",
    year = "1947",
    note = "Publisher: American Physical Society",
    pages = "550--555",
    file = "APS Snapshot:C\:\\Users\\Sun Myung\\Zotero\\storage\\IJVWPMDS\\PhysRev.72.html:text/html;Full Text PDF:C\:\\Users\\Sun Myung\\Zotero\\storage\\TVUWZQ6J\\Placzek and Seidel - 1947 - Milne's Problem in Transport Theory.pdf:application/pdf"
}
</code></pre></div></div></li><li id="rulko_variational_1995">Robert&nbsp;P. Rulko, Djordje Tomašević, and Edward&nbsp;W. Larsen.
Variational <span class="bibtex-protected">P1</span> <span class="bibtex-protected">Approximations</span> of <span class="bibtex-protected">General</span>-<span class="bibtex-protected">Geometry</span> <span class="bibtex-protected">Multigroup</span> <span class="bibtex-protected">Transport</span> <span class="bibtex-protected">Problems</span>.
<em>Nuclear Science and Engineering</em>, 121(3):393–404, December 1995.
Publisher: Taylor &amp; Francis _eprint: https://doi.org/10.13182/NSE121-393.
URL: <a href="https://doi.org/10.13182/NSE121-393">https://doi.org/10.13182/NSE121-393</a> (visited on 2024-05-31), <a href="https://doi.org/10.13182/NSE121-393">doi:10.13182/NSE121-393</a>.<a href="#b18f4f75-0fb0-4400-a043-8e4b5e9bdde6" class="modal-trigger moose-bibtex-modal" style="padding-left:10px;">[BibTeX]</a><div class="modal" id="b18f4f75-0fb0-4400-a043-8e4b5e9bdde6"><div class="modal-content"><pre style="line-height:1.25;"><code class="language-latex">@article{rulko_variational_1995,
    author = "Rulko, Robert P. and Tomašević, Djordje and Larsen, Edward W.",
    title = "Variational {P1} {Approximations} of {General}-{Geometry} {Multigroup} {Transport} {Problems}",
    volume = "121",
    issn = "0029-5639",
    url = "https://doi.org/10.13182/NSE121-393",
    doi = "10.13182/NSE121-393",
    abstract = "A variational approximation is developed for general-geometry multigroup transport problems with arbitrary anisotropic scattering. The variational principle is based on a functional that approximates a reaction rate in a subdomain of the system. In principle, approximations that result from this functional “optimally”determine such reaction rates. The functional contains an arbitrary parameter α and requires the approximate solutions of a forward and an adjoint transport problem. If the basis functions for the forward and adjoint solutions are chosen to be linear functions of the angular variable Ω, the functional yields the familiar multigroup P1 equations for all values of α. However, the boundary conditions that result from the functional depend on α. In particular, for problems with vacuum boundaries, one obtains the conventional mixed boundary condition, but with an extrapolation distance that depends continuously on α. The choice α = 0 yields a generalization of boundary conditions derived earlier by Federighi and Pomraning for a more limited class of problems. The choice α = 1 yields a generalization of boundary conditions derived previously by Davis for mono-energetic problems. Other boundary conditions are obtained by choosing different values of α. We discuss this indeterminancy of a in conjunction with numerical experiments.",
    number = "3",
    urldate = "2024-05-31",
    journal = "Nuclear Science and Engineering",
    month = "December",
    year = "1995",
    note = "Publisher: Taylor \\& Francis \\_eprint: https://doi.org/10.13182/NSE121-393",
    pages = "393--404",
    file = "Full Text PDF:C\:\\Users\\Sun Myung\\Zotero\\storage\\8NHDX7DM\\Rulko et al. - 1995 - Variational P1 Approximations of General-Geometry .pdf:application/pdf"
}
</code></pre></div></div></li></ol></div></section></section><div class="moose-modal modal" id="af9bca88-645d-464b-b8d8-b2505bcad361"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eig-922.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[]

[Mesh]
  file = &#x27;inverted_29x29_h_133.msh&#x27;
  # file = &#x27;inverted_3x3_h_15.msh&#x27;
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6b10b024-ac3a-442f-9a0c-8a584bd99360"><div class="modal-content"><h4>(problems/publication_level_cases/3d_steady_state/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
  [./group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  [../]
  [./group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e1f5218e-22cd-4392-b8a0-56f1091eca00"><div class="modal-content"><h4>(problems/LOSCA/HXFailure/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
  loop_precursors = true
  multi_app = loopApp
  is_loopapp = false
  inlet_boundaries = &#x27;fuel_bottoms&#x27;
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-pc_type&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="2eab468c-b6f2-4422-b41a-8953183b75b3"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_restart.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_auto_diff_rho_out.e&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
    scaling = 1e4
  []
  [temp]
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
  init_from_file = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9a046e7e-709e-47ae-9c9c-cf2d2f7e8b43"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_control.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
  [peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  # nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9e490a82-7e13-4d8f-8033-d28b2bdee153"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eig-msre-file-mesh-two-grp.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
[]

[Mesh]
  file = &#x27;msre_22x22_correct_vol_fraction.msh&#x27;
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group2
  []
[]

[Materials]
  [homo_reactor]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_&#x27;
    interp_type = &#x27;none&#x27;
    temperature = ${global_temperature}
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b8589726-847b-408a-9565-5f7b800a5730"><div class="modal-content"><h4>(problems/LOFA/steady/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose"># walk the reactor into steady state with an attached primary loop

flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../2d_lattice_structured.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[PrecursorKernel]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_postpr_inlet]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    variable = temp
    postprocessor = inlet_mean_temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

#[Materials]
#  [./fuel]
#    type = GenericMoltresMaterial
#    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
#    interp_type = &#x27;spline&#x27;
#    block = &#x27;fuel&#x27;
#  [../]
#  [./rho_fuel]
#    type = DerivativeParsedMaterial
#    f_name = rho
#    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  # fuel cp function
#  [./cp_fuel]
#    type = DerivativeParsedMaterial
#    f_name = cp
#    function = &#x27;1967 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  # fuel k function
#  [./k_fuel]
#    type = DerivativeParsedMaterial
#    f_name = k
#    function = &#x27;0.0553 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  [./moder]
#    type = GenericMoltresMaterial
#    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
#    interp_type = &#x27;spline&#x27;
#    block = &#x27;moder&#x27;
#  [../]
#  [./rho_moder]
#    type = DerivativeParsedMaterial
#    f_name = rho
#    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#  # moder cp fcn
#  [./cp_moder]
#    type = DerivativeParsedMaterial
#    f_name = cp
#    function = &#x27;1760 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#  # moder k fcn
#  [./k_moder]
#    type = DerivativeParsedMaterial
#    f_name = k
#    function = &#x27;.312 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#[]
[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 100

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  dtmax = 100
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  #multiapp
  [./inlet_mean_temp]
    type = Receiver
    execute_on = &#x27;timestep_begin&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = &#x27;initial timestep_begin&#x27;
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = average
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6aa4d8ce-700c-4cd7-a772-a8fb2b35a4c3"><div class="modal-content"><h4>(problems/picard/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="88350f30-ae54-4935-a2a9-c8fe86be99e6"><div class="modal-content"><h4>(tutorial/transient/transient.i)</h4><pre style="max-height:350px;"><code class="language-moose">[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  temperature = temp
  sss2_input = true
  account_delayed = true
[]

[Mesh]
  coord_type = RZ
  [mesh]
    type = FileMeshGenerator
    file = &#x27;../eigenvalue/mesh.e&#x27;
  []
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
  [temp]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1000
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    family = MONOMIAL
    order = CONSTANT
    block = 0
    outlet_boundaries = &#x27;fuel_top&#x27;
    velocity_type = constant
    u_def = 0
    v_def = 18.085
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    transient = true
  []
[]

[Kernels]
  #---------------------------------------------------------------------
  # Group 1 Neutronics
  #---------------------------------------------------------------------
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;0&#x27;
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;0&#x27;
    group_number = 1
  []

  #---------------------------------------------------------------------
  # Group 2 Neutronics
  #---------------------------------------------------------------------
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;0&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  #---------------------------------------------------------------------
  # Temperature
  #---------------------------------------------------------------------
  [temp_time_derivative]
    type = INSTemperatureTimeDerivative
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    variable = temp
    velocity_variable = &#x27;0 18.085 0&#x27;
    block = &#x27;0&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    variable = temp
    diffusivity = &#x27;k&#x27;
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;0&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top mod_bottom mod_top right&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top mod_bottom mod_top right&#x27;
    variable = group2
  []
  [temp_inlet_bc]
    type = FunctionDirichletBC
    variable = temp
    boundary = &#x27;fuel_bottom mod_bottom right&#x27;
    function = &#x27;temp_bc_func&#x27;
  []
  [temp_outlet_bc]
    type = TemperatureOutflowBC
    variable = temp
    boundary = &#x27;fuel_top&#x27;
    velocity = &#x27;0 18.085 0&#x27;
  []
[]

[ICs]
  [group1_ic]
    type = FunctionIC
    variable = group1
    function = ic_func
  []
  [group2_ic]
    type = FunctionIC
    variable = group2
    function = ic_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;1000 - (1000-965) * tanh(t/1)&#x27;
  []
  [dt_func]
    type = ParsedFunction
    expression = &#x27;if(t&lt;50, if(t&lt;30, .4, 5), 10)&#x27;
  []
  [ic_func]
    type = ParsedFunction
    expression = &#x27;1e5 * (-x^2+70^2) * (-y * (y-150))&#x27;
  []
[]

[Materials]
  [fuel]
    type = MoltresJsonMaterial
    block = &#x27;0&#x27;
    base_file = &#x27;../eigenvalue/xsdata.json&#x27;
    material_key = &#x27;fuel&#x27;
    interp_type = LINEAR
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27;
  []
  [graphite]
    type = MoltresJsonMaterial
    block = &#x27;1&#x27;
    base_file = &#x27;../eigenvalue/xsdata.json&#x27;
    material_key = &#x27;graphite&#x27;
    interp_type = LINEAR
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.86e-3 .312 1760&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 200

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-1

  automatic_scaling = true
  compute_scaling_once = false
  resid_vs_jac_scaling_param = 0.1
  scaling_group_variables = &#x27;group1 group2; pre1 pre2 pre3 pre4 pre5 pre6; temp&#x27;

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu       NONZERO               superlu_dist&#x27;

  line_search = none

  dtmin = 1e-3
  dtmax = 10
  [TimeStepper]
    type = FunctionDT
    function = dt_func
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [powernorm]
    type = ElmIntegTotFissHeatPostprocessor
    execute_on = linear
  []
  [average_temp]
    type = ElementAverageValue
    variable = temp
    execute_on = linear
  []
  [inlet_temp]
    type = SideAverageValue
    variable = temp
    boundary = fuel_bottom
  []
  [outlet_temp]
    type = SideAverageValue
    variable = temp
    boundary = fuel_top
  []
[]

[VectorPostprocessors]
  [centerline_flux]
    type = LineValueSampler
    variable = &#x27;group1 group2&#x27;
    start_point = &#x27;0 0 0&#x27;
    end_point = &#x27;0 150 0&#x27;
    num_points = 151
    sort_by = y
    execute_on = FINAL
  []
  [midplane_flux]
    type = LineValueSampler
    variable = &#x27;group1 group2&#x27;
    start_point = &#x27;0 75 0&#x27;
    end_point = &#x27;69.375 75 0&#x27;
    num_points = 100
    sort_by = x
    execute_on = FINAL
  []
[]

[Outputs]
  perf_graph = true
  [exodus]
    type = Exodus
  []
  [csv]
    type = CSV
    execute_on = FINAL
  []
[]

[Debug]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="96c35d85-3b49-4686-a6e7-b4b4f32a5ed2"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function.i)</h4><pre style="max-height:350px;"><code class="language-moose"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 33.28
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_func = vel_x_func
  v_func = vel_y_func
  w_func = vel_z_func
  constant_velocity_values = false
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = VelocityFunctionTemperatureAdvection
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [vel_x_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_y_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_z_func]
    type = ParsedFunction
    expression = &#x27;${fuel_velocity_max_inlet} * cos(pi * x / (2 * ${fuel_sq_rad})) * cos(pi * y / (2 * ${fuel_sq_rad}))&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="55bcbbbc-31e9-47fd-b01d-42ab19b31c1d"><div class="modal-content"><h4>(problems/072017_dg_temperature/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
sigma_val=.6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
    order = FIRST
    family = MONOMIAL
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    type = DGDiffusionPostprocessorDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diffusivity = &#x27;k&#x27;
    postprocessor = coreEndTemp
    offset = -50
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    type = PostprocessorTemperatureInflowBC
    variable = temp
    uu = 0
    vv = ${flow_velocity}
    ww = 0
    postprocessor = coreEndTemp
    offset = -50
  [../]
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  [../]
[]

[VectorPostprocessors]
  [./outlet_temps]
    type = LineValueSampler
    start_point = &#x27;0 153 0&#x27;
    end_point = &#x27;72.5 153 0&#x27;
    num_points = 1000
    variable = temp
    sort_by = &#x27;x&#x27;
    outputs = &#x27;csv&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./csv]
    type = CSV
    execute_on = &#x27;final&#x27;
  [../]
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="43441bff-d242-430f-bae3-aad9f8b241bc"><div class="modal-content"><h4>(tutorial/eigenvalue/nts.i)</h4><pre style="max-height:350px;"><code class="language-moose">[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  temperature = 900
  sss2_input = true
  account_delayed = true
[]

[Mesh]
  coord_type = RZ
  [mesh]
    type = FileMeshGenerator
    file = &#x27;mesh.e&#x27;
  []
[]

[Problem]
  type = EigenProblem
  bx_norm = bnorm
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    family = MONOMIAL
    order = CONSTANT
    block = 0
    outlet_boundaries = &#x27;fuel_top&#x27;
    velocity_type = constant
    u_def = 0
    v_def = 18.085
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    transient = false
    eigen = true
  []
[]

[Kernels]
  #---------------------------------------------------------------------
  # Group 1 Neutronics
  #---------------------------------------------------------------------
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;0&#x27;
    extra_vector_tags = &#x27;eigen&#x27;
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;0&#x27;
    group_number = 1
  []

  #---------------------------------------------------------------------
  # Group 2 Neutronics
  #---------------------------------------------------------------------
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;0&#x27;
    extra_vector_tags = &#x27;eigen&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top mod_bottom mod_top right&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top mod_bottom mod_top right&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = MoltresJsonMaterial
    block = &#x27;0&#x27;
    base_file = &#x27;xsdata.json&#x27;
    material_key = &#x27;fuel&#x27;
    interp_type = LINEAR
    prop_names = &#x27;&#x27;
    prop_values = &#x27;&#x27;
  []
  [graphite]
    type = MoltresJsonMaterial
    block = &#x27;1&#x27;
    base_file = &#x27;xsdata.json&#x27;
    material_key = &#x27;graphite&#x27;
    interp_type = LINEAR
    prop_names = &#x27;&#x27;
    prop_values = &#x27;&#x27;
  []
[]

[Executioner]
  type = Eigenvalue
  initial_eigenvalue = 1
  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_hypre_type&#x27;
  petsc_options_value = &#x27;hypre boomeramg&#x27;

  automatic_scaling = true
  compute_scaling_once = false
  resid_vs_jac_scaling_param = 0.1

  line_search = none
[]

[Postprocessors]
  [k_eff]
    type = VectorPostprocessorComponent
    index = 0
    vectorpostprocessor = k_vpp
    vector_name = eigen_values_real
  []
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    block = 0
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [powernorm]
    type = ElmIntegTotFissHeatPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[VectorPostprocessors]
  [k_vpp]
    type = Eigenvalues
    inverse_eigenvalue = true
  []
  [centerline_flux]
    type = LineValueSampler
    variable = &#x27;group1 group2&#x27;
    start_point = &#x27;0 0 0&#x27;
    end_point = &#x27;0 150 0&#x27;
    num_points = 151
    sort_by = y
    execute_on = FINAL
  []
  [midplane_flux]
    type = LineValueSampler
    variable = &#x27;group1 group2&#x27;
    start_point = &#x27;0 75 0&#x27;
    end_point = &#x27;69.375 75 0&#x27;
    num_points = 100
    sort_by = x
    execute_on = FINAL
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
  []
  [csv]
    type = CSV
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="ba7ab5d7-a293-4a03-9b0e-21ac231ea336"><div class="modal-content"><h4>(problems/LOFA/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose"># take in steady state variable from the other core, and run a pump coastdown transient
# here, flow_velocity is only the initial flow velocity
flow_velocity=21.7 # cm/s. See MSRE-properties.ods
tau = 5 # pump coastdown time constant
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;steady/auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    constant_velocity_values = false
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    u_func = nullFunc
    v_func = coastDownFunc
    w_func = nullFunc
    init_from_file = true
  [../]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]


[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
     type = GammaHeatSource
     variable = temp
     gamma = .0144 # Cammi .0144
     block = &#x27;moder&#x27;
     average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = CtrlConservativeTemperatureAdvection
    u_val = 0
    v_val = ${flow_velocity} # this will be changed in ctrls block
    w_val = 0
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_postpr_inlet]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    variable = temp
    postprocessor = inlet_mean_temp
  [../]
  #[./temp_postpr_inlet]
  #  boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #  type = DirichletBC
  #  variable = temp
  #  value = 922
  #[../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = nullFunc
    vel_y_func = coastDownFunc
    vel_z_func = nullFunc
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nullFunc]
    type = ParsedFunction
    value = &#x27;0&#x27;
  [../]
  [./coastDownFunc]
    type = ParsedFunction
    value = &#x27;${flow_velocity} * exp(-t / ${tau})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  # fuel cp function
  [./cp_fuel]
    type = DerivativeParsedMaterial
    f_name = cp
    function = &#x27;1967 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  # fuel k function
  [./k_fuel]
    type = DerivativeParsedMaterial
    f_name = k
    function = &#x27;0.0553 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  # moder cp fcn
  [./cp_moder]
    type = DerivativeParsedMaterial
    f_name = cp
    function = &#x27;1760 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  # moder k fcn
  [./k_moder]
    type = DerivativeParsedMaterial
    f_name = k
    function = &#x27;.312 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
  nl_abs_tol = 3e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27; #  -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu&#x27; #       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.04
    optimal_iterations = 5
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    # ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
  #multiapp
  [./inlet_mean_temp]
    type = Receiver
    execute_on = &#x27;initial timestep_begin&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Controls]
  [./flowControl]
    type = RealFunctionControl
    parameter = &#x27;*/*/v_val&#x27;
    function = coastDownFunc
    execute_on = &#x27;initial timestep_begin&#x27;
  [../]
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = &#x27;initial timestep_begin&#x27;
    positions = &#x27;100.0 100.0 0.0&#x27;
    input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
 [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="543d0686-e4ac-4f56-b2e2-6257c6fd8323"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/transient-msre-file-mesh-two-grp-two-b1-mat.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = true
[]

[Mesh]
  # file = &#x27;msre_23x23.msh&#x27;
  file = &#x27;msre_cuboid_3x3.msh&#x27;
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_fuel_&#x27;
    interp_type = &#x27;none&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_moder_&#x27;
    interp_type = &#x27;none&#x27;
    temperature = ${global_temperature}
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  num_steps = 100

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor -snes_test_display&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    outputs = &#x27;console csv&#x27;
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    outputs = &#x27;console csv&#x27;
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    outputs = &#x27;console csv&#x27;
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    outputs = &#x27;console csv&#x27;
  []
[]

[Outputs]
  perf_graph = true
  [out]
    type = Exodus
  []
  [csv]
    type = CSV
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="3ebffb70-2e94-46ec-b1f7-e0c0b5bb31de"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;NEWTON&#x27;
  # solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  # exodus = true
  nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9dbcdc3e-5e2a-4c1e-9cda-f65187503f8d"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eigen-gen-mesh-should-be-crit-one-group.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 1
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1&#x27;
  temperature = ${global_temperature}
[]

[Mesh]
  type = GeneratedMesh
  dim = 2
  xmax = 73.86
  ymax = 180
  nx = 100
  ny = 100
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
[]

[BCs]
  [vacuum1]
    type = VacuumConcBC
    boundary = &#x27;right top bottom&#x27;
    variable = group1
  []
[]

[Materials]
  [homo_reactor]
    type = GenericMoltresMaterial
    block = 0
    property_tables_root = &#x27;../property_file_dir/homo_critical_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  []
[]

[Executioner]
  # type = NonlinearEigen
  # free_power_iterations = 4
  # source_abs_tol = 1e-12
  # source_rel_tol = 1e-8
  # output_after_power_iterations = true

  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.0
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    group_fluxes = &#x27;group1&#x27;
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6a0eebea-b028-4536-a7b3-13ee076f37e1"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;cylinder_structured_for_msre_comp.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;graphite_bottom fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="cec042bd-6e33-494f-a0a3-1d6761027e1e"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eigen-gen-mesh-rad-57-mc-gcs.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
[]

[Mesh]
  type = GeneratedMesh
  dim = 2
  xmax = 57
  ymax = 198.12
  nx = 100
  ny = 100
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
[]

[BCs]
  [vacuum1]
    type = VacuumConcBC
    boundary = &#x27;right top bottom&#x27;
    variable = group1
  []
  [vacuum2]
    type = VacuumConcBC
    boundary = &#x27;right top bottom&#x27;
    variable = group2
  []
[]

[Materials]
  [homo_reactor]
    type = GenericMoltresMaterial
    block = 0
    property_tables_root = &#x27;../property_file_dir/msre_homogeneous_critical_question_mark_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  []
[]

[Executioner]
  # type = NonlinearEigen
  # free_power_iterations = 4
  # source_abs_tol = 1e-12
  # source_rel_tol = 1e-8
  # output_after_power_iterations = true

  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.0
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    group_fluxes = &#x27;group1 group2&#x27;
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="88542fe4-ee15-4688-9d03-22332c57d5b9"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eigen-gen-mesh-rad-73-mc-gcs.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
[]

[Mesh]
  type = GeneratedMesh
  dim = 2
  xmax = 73.86
  ymax = 198.12
  nx = 100
  ny = 100
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
[]

[BCs]
  [vacuum1]
    type = VacuumConcBC
    boundary = &#x27;right top bottom&#x27;
    variable = group1
  []
  [vacuum2]
    type = VacuumConcBC
    boundary = &#x27;right top bottom&#x27;
    variable = group2
  []
[]

[Materials]
  [homo_reactor]
    type = GenericMoltresMaterial
    block = 0
    property_tables_root = &#x27;../property_file_dir/msre_homogeneous_critical_question_mark_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  []
[]

[Executioner]
  # type = NonlinearEigen
  # free_power_iterations = 4
  # source_abs_tol = 1e-12
  # source_rel_tol = 1e-8
  # output_after_power_iterations = true

  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.0
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    group_fluxes = &#x27;group1 group2&#x27;
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="63222f19-2f96-4e02-8461-120d142f957d"><div class="modal-content"><h4>(problems/publication_level_cases/transient_single_channel_blockage/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = 3d_ss_out.e
[]

[MeshModifiers]
  # [./scale]
  #   type = Transform
  #   transform = SCALE
  #   vector_value = &#x27;1 1 ${scale}&#x27;
  # [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    scaling = 1e4
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
  [../]
  [./group2]
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
  [./primary_fuel]
    var_name_base = pre
    block = &#x27;fuel blocked_fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    init_from_file = true
    kernel_block = &#x27;fuel&#x27;
  [../]
  [./blocked_fuel]
    var_name_base = pre
    kernel_block = &#x27;blocked_fuel&#x27;
    outlet_boundaries = &#x27;blocked_fuel_top&#x27;
    u_def = 0
    v_def = 0
    w_def = 0
    nt_exp_form = false
    create_vars = false
    object_suffix = blocked
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel blocked_fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 5e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  file_base = temp
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="eead7c16-4a5e-4f32-a163-b1c719b36877"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-b1-two-mat.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = true
[../]

[Mesh]
  file = &#x27;msre_26x26.msh&#x27;
  # file = &#x27;msre_cuboid_3x3.msh&#x27;
[../]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  [../]
  [./temp]
    initial_condition = ${diri_temp}
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;fuel_bottoms moder_bottoms fuel_sides&#x27;
    type = DirichletBC
    variable = temp
    value = ${diri_temp}
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_moder_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="994a29d0-215a-4362-b6fb-4145401fda24"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-channel-msre-dimensions.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = single_channel_msre_dimensions.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[AuxVariables]
  [./vel_x]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_y]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_z]
    block = &#x27;fuel&#x27;
  [../]
  [./p]
    block = &#x27;fuel&#x27;
  [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_fuel_transport]
    type = INSTemperature
    u = vel_x
    v = vel_y
    w = vel_z
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    solve_type = PJFNK
    ksp_norm = none
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

[MultiApps]
  [./sub]
    type = FullSolveMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = solution_aux_exodus.i
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Transfers]
  [./vel_x]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_x
    variable = vel_x
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_y]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_y
    variable = vel_y
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_z]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_z
    variable = vel_z
    execute_on = &#x27;initial&#x27;
  [../]
  [./p]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = p
    variable = p
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9cecf39d-ede1-4cf5-953b-ff01b330daea"><div class="modal-content"><h4>(problems/LOSCA/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  create_temperature_var = false
  scaling = 1e-4
  pre_blocks = &#x27;fuel&#x27;
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
  [../]
  [./temp]
    scaling = 1e-4
    initial_condition = 930
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  loop_precursors = true
  multi_app = loopApp
  is_loopapp = false
  inlet_boundaries = &#x27;fuel_bottoms&#x27;
 [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-5
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d3b63bb3-89b0-4a27-af12-5243fb72a567"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_direct.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  #   file = &#x27;3d_msre_29x29_136.msh&#x27;
  file = split_mesh/3d_auto_diff_rho_in.e
  nemesis = true
  skip_partioning = true
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  #   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  #   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly	  1e-3&#x27;
  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9085f8e0-5102-4bf7-a073-f2428773c2d1"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/nts-eigenvalue-msre-channel-dimensions.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = 922
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = single_channel_msre_dimensions.msh
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  []
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  # [./time_group1]
  #   type = NtTimeDerivative
  #   variable = group1
  #   group_number = 1
  # [../]
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
  # [./time_group2]
  #   type = NtTimeDerivative
  #   variable = group2
  #   group_number = 2
  # [../]
[]

# [BCs]
#   [./vacuum_group1]
#     type = VacuumConcBC
#     boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
#     # boundary = &#x27;fuel_bottom moderator_bottoms&#x27;
#     variable = group1
#   [../]
#   [./vacuum_group2]
#     type = VacuumConcBC
#     boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
#     # boundary = &#x27;fuel_bottom moderator_bottoms&#x27;
#     variable = group2
#   [../]
# []

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [SMP_PJFNK]
    type = SMP
    full = true
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 2.0
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  []
[]

[ICs]
  [group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  []
  [group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d653f4a2-48b6-47a0-ae4c-cac51ab2cadb"><div class="modal-content"><h4>(problems/picard/tmp_nts.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  account_delayed = false
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 3e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = PostprocessorDT
    postprocessor = &#x27;limit_k&#x27;
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./limit_k]
    type = LimitK
    growth_factor = 1.1
    cutback_factor = 0.4
    k_threshold = 1.25
    k_postprocessor = &#x27;multiplication&#x27;
  [../]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="cb84c6d5-55f0-4950-ba6d-1cd5bec33f49"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eig-one-channel-two-grp-two-mat-scale.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[]

[Problem]
  coord_type = RZ
[]

[Mesh]
  file = &#x27;cylinder_structured_for_msre_comp.msh&#x27;
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  eig_check_tol = 1e-9
  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="303e5532-3a72-499f-8a13-8ea9f7b6a416"><div class="modal-content"><h4>(tests/coupled/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
ini_temp = 922
diri_temp = 922
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
  []
[]

[Kernels]
  #---------------------------------------------------------------------
  # Group 1 Neutronics
  #---------------------------------------------------------------------
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  []

  #---------------------------------------------------------------------
  # Group 2 Neutronics
  #---------------------------------------------------------------------
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  #---------------------------------------------------------------------
  # Temperature
  #---------------------------------------------------------------------
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  num_steps = 80

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100
  steady_state_detection = true
  steady_state_tolerance = 1e-10

  dtmin = 1e-5
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 5
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="817d6749-f765-4d94-a2a9-fec8659f4a34"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-PJFNK.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;cylinder_structured_for_msre_comp.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;graphite_bottom fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6c6854fa-8d70-4cc9-92cc-4ee694dbc19e"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive_PJFNK.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # uniform_refine = 1
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    # off_diag_row = &#x27;temp pre1 pre2 pre3 pre4 pre5 pre6 temp pre1 pre2 pre3 pre4 pre5 pre6&#x27;
    # off_diag_column = &#x27;group1 group1 group1 group1 group1 group1 group1 group2 group2 group2 group2 group2 group2 group2&#x27;
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []

# [Adaptivity]
#   marker = errorfrac_temp
#   max_h_level = 1
#   [./Indicators]
#     [./error_temp]
#       type = GradientJumpIndicator
#       variable = temp
#       outputs = none
#     [../]
#   [../]
#   [./Markers]
#     [./errorfrac_temp]
#       type = ErrorFractionMarker
#       refine = 0.8
#       coarsen = 0.1
#       indicator = error_temp
#       outputs = none
#     [../]
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b26dd454-5b7d-4cd3-a564-fb5d3dffcfe0"><div class="modal-content"><h4>(problems/publication_level_cases/gamma_heating_3d_ss/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
  [./group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  [../]
  [./group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e61f5a5e-6799-4ea1-8935-7510d0b49889"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_condition = 1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_condition = 1
  [../]
  [./temp]
    scaling = 1e-4
    initial_condition = 930
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-5
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="659689f1-79b4-4791-a82a-83278449c882"><div class="modal-content"><h4>(problems/070517_4group/eigen/eigen.i)</h4><pre style="max-height:350px;"><code class="language-moose">ini_temp=922
diri_temp=922
nt_scale=1e13
temp = 922
[GlobalParams]
  num_groups = 4
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4&#x27;
  sss2_input = false
  account_delayed = false
  temperature = 922
  temp = 922
[]

flow_velocity = 21.7
[Mesh]
  file = &#x27;../../033117_nts_temp_pre_parsed_mat/3d_msre_29x29_136.msh&#x27;
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;moder_sides fuel_bottoms fuel_tops moder_bottoms moder_tops&#x27;
  create_temperature_var = false
  eigen = true
[]

#[Variables]
#  [./group1]
#  [../]
#  [./group2]
#  [../]
#  [./group3]
#  [../]
#  [./group4]
#  [../]
#  #[./temp]
#  #  initial_condition = ${ini_temp}
#  #  scaling = 1e-4
#  #[../]
#[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  jac_test = true
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  [../]
  [./vacuum_group3]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group3
  [../]
  [./vacuum_group4]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group4
  [../]

  #[./temp_diri_cg]
  #  boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
  #  type = FunctionDirichletBC
  #  function = &#x27;temp_bc_func&#x27;
  #  variable = temp
  #[../]
  #[./temp_advection_outlet]
  #  boundary = &#x27;fuel_tops&#x27;
  #  type = TemperatureOutflowBC
  #  variable = temp
  #  velocity = &#x27;0 0 ${flow_velocity}&#x27;
  #[../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root =&#x27;../../../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gfuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;
  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  [../]
  [./tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  [../]
  [./group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  [../]
  [./group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  [../]
  [./group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  [../]
  [./group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  [../]
  [./group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  [../]
  [./group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  [../]
[]


[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="5762cc72-ff2a-4c9b-92a2-1dfb2ee92357"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # uniform_refine = 1
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 100000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    # off_diag_row = &#x27;temp pre1 pre2 pre3 pre4 pre5 pre6 temp pre1 pre2 pre3 pre4 pre5 pre6&#x27;
    # off_diag_column = &#x27;group1 group1 group1 group1 group1 group1 group1 group2 group2 group2 group2 group2 group2 group2&#x27;
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [exodus]
    type = Exodus
    file_base = &#x27;&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []

# [Adaptivity]
#   marker = errorfrac_temp
#   max_h_level = 1
#   [./Indicators]
#     [./error_temp]
#       type = GradientJumpIndicator
#       variable = temp
#       outputs = none
#     [../]
#   [../]
#   [./Markers]
#     [./errorfrac_temp]
#       type = ErrorFractionMarker
#       refine = 0.8
#       coarsen = 0.1
#       indicator = error_temp
#       outputs = none
#     [../]
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="14790d4f-0664-40ce-9dfb-76a9b81c646d"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-unit-cell.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = msre_squares.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[AuxVariables]
  [./vel_x]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_y]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_z]
    block = &#x27;fuel&#x27;
  [../]
  [./p]
    block = &#x27;fuel&#x27;
  [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_fuel_transport]
    type = INSTemperature
    u = vel_x
    v = vel_y
    w = vel_z
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    solve_type = PJFNK
    ksp_norm = none
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

[MultiApps]
  [./sub]
    type = FullSolveMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = solution_aux_exodus.i
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Transfers]
  [./vel_x]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_x
    variable = vel_x
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_y]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_y
    variable = vel_y
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_z]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_z
    variable = vel_z
    execute_on = &#x27;initial&#x27;
  [../]
  [./p]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = p
    variable = p
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="c0668b1c-feb7-4583-bba8-d5200cfe6c1f"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_monotone_interp.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b93b372f-5c55-4511-b277-ba6009d89327"><div class="modal-content"><h4>(problems/060717_dimension_testing/test_case.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=1
nt_scale = ${/ 1E0 1.6E-13}
ini_temp=1
diri_temp=1

[GlobalParams]
  num_groups = 1
  num_precursor_groups = 1
  use_exp_form = false
  group_fluxes = &#x27;group1&#x27;
  temperature = temp
  sss2_input = false
  account_delayed = false
[]

[Mesh]
  type = GeneratedMesh
  nx = 10
  ny = 10
  dim = 2
  xmax = 2.42 # Bessel zero is 2.405
  ymax = 3.149
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    # order = CONSTANT
    # family = MONOMIAL
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
  [../]
[]

# [DGKernels]
#   [./temp]
#     type = DGConvection
#     variable = temp
#     velocity = &#x27;0 ${flow_velocity} 0&#x27;
#   [../]
# []

[BCs]
  # [./vacuum_group1]
  #   type = VacuumConcBC
  #   boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  #   variable = group1
  # [../]
  [./group1]
    type = DirichletBC
    value = 0
    boundary = &#x27;top right bottom&#x27;
    variable = &#x27;group1&#x27;
  [../]
  [./temp_diri_cg]
    boundary = &#x27;bottom right&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  # [./temp_advection_inlet]
  #   boundary = &#x27;bottom&#x27;
  #   type = TemperatureInflowBC
  #   velocity = &#x27;0 ${flow_velocity} 0&#x27;
  #   variable = temp
  #   inlet_conc = 1
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/dummy_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.1 1 1&#x27; # Robertson MSRE technical report @ 922 K
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  file_base = &#x27;&#x27;
  [./exodus]
    type = Exodus
  [../]
  [./csv]
    type = CSV
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="f3d4a51a-edc8-467f-bb96-a1c1721ef1f3"><div class="modal-content"><h4>(problems/publication_level_cases/transient_single_channel_blockage/3d_ss.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = msre_vol_frac_29x29_h_136.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    scaling = 1e4
    initial_condition = 1
  [../]
  [./group2]
    scaling = 1e4
    initial_condition = 1
  [../]
  [./temp]
    scaling = 1e-4
    initial_condition = ${ini_temp}
  [../]
[]

[Precursors]
  [./primary_fuel]
    var_name_base = pre
    block = &#x27;fuel blocked_fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops blocked_fuel_top&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    kernel_block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides blocked_fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops blocked_fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel blocked_fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  dtmin = 1e-7
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="755609fb-6672-4b8d-9ff4-6c6c61a29b8a"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/controlled_neutronics_only.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = 922
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-5
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  # solve_type = &#x27;NEWTON&#x27;
  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  line_search = none
  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [exodus]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="4f2b7c16-7fdc-46f7-9939-823665830c1d"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/HXFail/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-pc_type&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="793704ee-2c0c-4e66-81e1-2ea9bd1f3d2c"><div class="modal-content"><h4>(tests/coupled/auto_diff_rho_serpent.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
ini_temp = 922
diri_temp = 922
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
  []
[]

[Kernels]
  #---------------------------------------------------------------------
  # Group 1 Neutronics
  #---------------------------------------------------------------------
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  []

  #---------------------------------------------------------------------
  # Group 2 Neutronics
  #---------------------------------------------------------------------
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  #---------------------------------------------------------------------
  # Temperature
  #---------------------------------------------------------------------
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_converted_to_serpent/serpent_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_converted_to_serpent/serpent_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  num_steps = 80

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100
  steady_state_detection = true
  steady_state_tolerance = 1e-10

  dtmin = 1e-5
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 5
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho_serpent&#x27;
    execute_on = &#x27;final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="990e2679-ea4b-4f5f-925e-14dd9b41ee3c"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/unit-cell-heat-and-nts.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = msre_squares.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    scaling = 1e2
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    scaling = 1e2
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
    scaling = 1e-4
    # initial_condition = 900
  [../]
[]

[AuxVariables]
  # [./vel_x]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./vel_y]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./vel_z]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./p]
  #   block = &#x27;fuel&#x27;
  # [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_fuel_transport]
  #   type = INSTemperature
  #   u = vel_x
  #   v = vel_y
  #   w = vel_z
  #   variable = temp
  #   block = &#x27;fuel&#x27;
  # [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 21.73&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    # block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 21.73&#x27;
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;linear&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-2
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;linear&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    ksp_norm = &#x27;none&#x27;
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # line_search = &#x27;none&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-5
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

# [MultiApps]
#   [./sub]
#     type = FullSolveMultiApp
#     app_type = MoltresApp
#     positions = &#x27;0 0 0&#x27;
#     input_files = solution_aux_exodus.i
#     execute_on = &#x27;initial&#x27;
#   [../]
# []

# [Transfers]
#   [./vel_x]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_x
#     variable = vel_x
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./vel_y]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_y
#     variable = vel_y
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./vel_z]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_z
#     variable = vel_z
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./p]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = p
#     variable = p
#     execute_on = &#x27;initial&#x27;
#   [../]
# []

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    # outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    # outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="af49e46e-3fcb-424f-bd92-f26d9590ca3c"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/2d_axi_function_cross_sections_eigen.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = 922
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = false
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[]

[MeshModifiers]
  [scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;.369 .369 1&#x27;
  []
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    block = &#x27;moder&#x27;
  []
  # [./fuel]
  #   type = GenericMoltresMaterial
  #   property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
  #   interp_type = &#x27;spline&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./moder]
  #   type = GenericMoltresMaterial
  #   property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
  #   interp_type = &#x27;spline&#x27;
  #   block = &#x27;moder&#x27;
  # [../]
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
    execute_on = &#x27;timestep_end final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6cde8166-d024-47c6-b80c-8055e853e724"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-mod-heat-PJFNK.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;cylinder_structured_for_msre_comp.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;graphite_bottom fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="201c8f36-0fad-4bdc-b8cd-ef8209784905"><div class="modal-content"><h4>(problems/060717_dimension_testing/one_group_nts_only.i)</h4><pre style="max-height:350px;"><code class="language-moose">[GlobalParams]
  num_groups = 1
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1&#x27;
  temperature = 972
  sss2_input = false
  account_delayed = false
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  file_base = &#x27;&#x27;
  [exodus]
    type = Exodus
  []
  [csv]
    type = CSV
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="af315562-cd70-4a8a-9713-7a6af3b1f685"><div class="modal-content"><h4>(problems/picard/nts_no_pres.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = false
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
[]

[AuxVariables]
  [./temp]
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  picard_max_its = 1
  picard_rel_tol = 1e-6
  picard_abs_tol = 1e-4

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-4

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 10
  l_max_its = 100
  dtmin = 1e-3

  [./TimeStepper]
    type = PostprocessorDT
    postprocessor = &#x27;limit_k&#x27;
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus csv&#x27;
  [../]
  [./limit_k]
    type = LimitK
    growth_factor = 1.1
    cutback_factor = 0.4
    k_threshold = 1.1
    k_postprocessor = &#x27;multiplication&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
  csv = true
  execute_on = &#x27;final&#x27;
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./temp]
    type = TransientMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = &#x27;temp_no_pres.i&#x27;
  [../]
[]

[Transfers]
  [./temp_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp&#x27;
    source_variable = temp
    variable = temp
  [../]
  [./group1_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;temp&#x27;
    source_variable = group1
    variable = group1
  [../]
  [./group2_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;temp&#x27;
    source_variable = group2
    variable = group2
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="02657681-8a09-4d2a-be61-eb8672c40bc0"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/2d_axi_function_cross_sections.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[]

[MeshModifiers]
  [scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 1&#x27;
  []
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
  #  petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
    execute_on = &#x27;timestep_end final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="94e5f4c6-3e3e-4fa0-9665-ecb269f769a6"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_eigen_function_materials.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = 922
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[MeshModifiers]
  [scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 .99&#x27;
  []
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="a43e66fa-529a-4c0a-a9c0-b9906270f77a"><div class="modal-content"><h4>(problems/060717_dimension_testing/one_group.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 1
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  # coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-6
  [../]
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  scaling = 1
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  # [./temp_diffusion_outlet]
  #   boundary = &#x27;fuel_tops&#x27;
  #   type = DiffusiveFluxBC
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  file_base = &#x27;&#x27;
  [./exodus]
    type = Exodus
  [../]
  [./csv]
    type = CSV
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="5ab83f37-e33c-4ee1-b8dc-6b9fbcfcd7c3"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eig-1022.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 1022

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[]

[Mesh]
  file = &#x27;inverted_29x29_h_133.msh&#x27;
  # file = &#x27;inverted_3x3_h_15.msh&#x27;
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="363142dc-bfc5-49a3-9320-3f76b0fd2cb5"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922
base_height = 136
scale = .99
height = &#x27;${fparse base_height * scale}&#x27;
width = 145
offset = 2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  [file]
    type = FileMeshGenerator
    ## Default to jac_test.msh for quicker syntax check tests.
    ## Switch to 3D mesh for actual simulations.
    # file = &#x27;3d_msre_29x29_136.msh&#x27;
    file = jac_test.msh
  []
  [scale]
    type = TransformGenerator
    input = file
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  []
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    #     initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    #     initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity_variable = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [nt_ic_func]
    type = ParsedFunction
    expression = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  []
[]

[Materials]
  [fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
  #   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  #   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  #   [./temp_ic]
  #     type = RandomIC
  #     variable = temp
  #     min = 922
  #     max = 1022
  #   [../]
  #   [./group1_ic]
  #     type = RandomIC
  #     variable = group1
  #     min = .5
  #     max = 1.5
  #   [../]
  #   [./group2_ic]
  #     type = RandomIC
  #     variable = group2
  #     min = .5
  #     max = 1.5
  #   [../]
  [group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  []
  [group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="7d5b0470-a63d-427f-8594-6786279466d6"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-scale-two-mat-inverted-file-msh.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=1022
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;inverted_29x29_h_133.msh&#x27;
  # file = &#x27;inverted_3x3_h_15.msh&#x27;
[../]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="88c60534-2aef-4e4d-8340-775e3926caf6"><div class="modal-content"><h4>(tests/bcs/vacuum_bc.i)</h4><pre style="max-height:350px;"><code class="language-moose">[GlobalParams]
  use_exp_form = false
[]

[Mesh]
  [gmg]
    type = GeneratedMeshGenerator
    dim = 2
  []
[]

[Variables]
  [flux]
  []
[]

[Kernels]
  [diffusion]
    type = GroupDiffusion
    variable = flux
    group_number = 1
  []
[]

[BCs]
  [dirichlet]
    type = DirichletBC
    variable = flux
    boundary = &#x27;left&#x27;
    value = 1.002
  []
  [vacuum]
    type = VacuumConcBC
    variable = flux
    boundary = &#x27;right&#x27;
    vacuum_bc_type = marshak
  []
[]

[Materials]
  [mat]
    type = MoltresJsonMaterial
    base_file = &#x27;xsdata.json&#x27;
    material_key = 0
    interp_type = none
    num_groups = 1
    num_precursor_groups = 1
  []
[]

[Executioner]
  type = Steady
  solve_type = PJFNK
[]

[Postprocessors]
  [boundary_value]
    type = SideAverageValue
    variable = flux
    boundary = &#x27;right&#x27;
  []
[]

[Outputs]
  [out]
    type = Exodus
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="bd270469-d2d8-4850-8939-84f9ca062753"><div class="modal-content"><h4>(problems/publication_level_cases/dilute_absorber_controlled_by_peak_power_density/in.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  # nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6d42d3d0-ef6c-4c1d-b712-95ea09138267"><div class="modal-content"><h4>(problems/constant_inlet_outlet_temp_no_heat_flux_at_walls/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;fuel_bottoms&#x27;
    type = FlexiblePostprocessorDirichletBC
    postprocessor = coreEndTemp
    offset = -50
    variable = temp
  [../]
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  [../]
[]

[VectorPostprocessors]
  [./outlet_temps]
    type = LineValueSampler
    start_point = &#x27;0 153 0&#x27;
    end_point = &#x27;72.5 153 0&#x27;
    num_points = 1000
    variable = temp
    sort_by = &#x27;x&#x27;
    outputs = &#x27;csv&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
  [./csv]
    type = CSV
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="07d02e44-b2d5-4167-9e3b-6dd1992e331f"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/unit-cell-nts-eigenvalue.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = 922
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = msre_squares.msh
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  []
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  # [./time_group1]
  #   type = NtTimeDerivative
  #   variable = group1
  #   group_number = 1
  # [../]
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
  # [./time_group2]
  #   type = NtTimeDerivative
  #   variable = group2
  #   group_number = 2
  # [../]
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    # boundary = &#x27;fuel_bottom moderator_bottoms&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    # boundary = &#x27;fuel_bottom moderator_bottoms&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [SMP_PJFNK]
    type = SMP
    full = true
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 2.0
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  []
[]

[ICs]
  [group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  []
  [group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="f2ca3260-ee00-4f46-9dd7-5e406dfbcd05"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function_moderator_heating.i)</h4><pre style="max-height:350px;"><code class="language-moose"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 33.28
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_func = vel_x_func
  v_func = vel_y_func
  w_func = vel_z_func
  constant_velocity_values = false
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = VelocityFunctionTemperatureAdvection
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [vel_x_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_y_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_z_func]
    type = ParsedFunction
    expression = &#x27;${fuel_velocity_max_inlet} * cos(pi * x / (2 * ${fuel_sq_rad})) * cos(pi * y / (2 * ${fuel_sq_rad}))&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 100000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200
  line_search = none

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  []
  [peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="71cb4d26-0835-4f63-a879-a699a64d7ec7"><div class="modal-content"><h4>(problems/picard/nts.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
[]

[AuxVariables]
  [./temp]
  [../]
  [./pre1]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre2]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre3]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre4]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre5]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre6]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  picard_max_its = 10
  picard_rel_tol = 1e-7
  picard_abs_tol = 1e-10

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./temp_pres]
    type = TransientMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = &#x27;temp.i&#x27;
  [../]
[]

[Transfers]
  [./temp_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = temp
    variable = temp
  [../]
  [./pre1_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre1
    variable = pre1
  [../]
  [./pre2_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre2
    variable = pre2
  [../]
  [./pre3_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre3
    variable = pre3
  [../]
  [./pre4_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre4
    variable = pre4
  [../]
  [./pre5_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre5
    variable = pre5
  [../]
  [./pre6_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre6
    variable = pre6
  [../]
  [./group1_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = group1
    variable = group1
  [../]
  [./group2_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = group2
    variable = group2
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="7ef67d12-3b20-44ca-b584-e28e2f6c81c6"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eig-msre-file-mesh-two-grp-two-mat.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = true
[]

[Mesh]
  file = &#x27;msre_26x26.msh&#x27;
  # file = &#x27;msre_cuboid_3x3.msh&#x27;
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_fuel_&#x27;
    interp_type = &#x27;none&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_moder_&#x27;
    interp_type = &#x27;none&#x27;
    temperature = ${global_temperature}
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="15cb69c7-d625-4878-8860-dc67d8bc1551"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_nts_only.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
  []
  [group2]
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="7ad92aa0-c81d-4913-aa7f-01da66c1047e"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eigen-problem.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
[]

[Mesh]
  file = &#x27;cylinder_rad_57.msh&#x27;
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
[]

[BCs]
  [vacuum1]
    type = VacuumConcBC
    boundary = &#x27;boundaries&#x27;
    variable = group1
  []
  [vacuum2]
    type = VacuumConcBC
    boundary = &#x27;boundaries&#x27;
    variable = group2
  []
[]

[Materials]
  [homo_reactor]
    type = GenericMoltresMaterial
    block = &#x27;reactor&#x27;
    property_tables_root = &#x27;../property_file_dir/msre_homogeneous_critical_question_mark_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  []
[]

[Executioner]
  # type = NonlinearEigen
  # free_power_iterations = 4
  # source_abs_tol = 1e-12
  # source_rel_tol = 1e-8
  # output_after_power_iterations = true

  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.0
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    # full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    group_fluxes = &#x27;group1 group2&#x27;
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="f5822756-d516-4e8c-a636-4e0b6196a51b"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/meigen.i)</h4><pre style="max-height:350px;"><code class="language-moose">[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;moder_sides fuel_bottoms fuel_tops moder_bottoms moder_tops&#x27;
  create_temperature_var = false
  eigen = true
[]

#[Variables]
#  [./group1]
#    order = FIRST
#    family = LAGRANGE
#    initial_condition = 1
#    scaling = 1e4
#  [../]
#  [./group2]
#    order = FIRST
#    family = LAGRANGE
#    initial_condition = 1
#    scaling = 1e4
#  [../]
#  [./temp]
#    initial_condition = ${ini_temp}
#    scaling = 1e-4
#  [../]
#[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  jac_test = true
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  #petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm      lu &#x27; #1               preonly       1e-3&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

#[Postprocessors]
#  [./group1_current]
#    type = IntegralNewVariablePostprocessor
#    variable = group1
#    outputs = &#x27;console csv&#x27;
#  [../]
#  [./group1_old]
#    type = IntegralOldVariablePostprocessor
#    variable = group1
#    outputs = &#x27;console csv&#x27;
#  [../]
#  [./multiplication]
#    type = DivisionPostprocessor
#    value1 = group1_current
#    value2 = group1_old
#    outputs = &#x27;console csv&#x27;
#  [../]
#  [./temp_fuel]
#    type = ElementAverageValue
#    variable = temp
#    block = &#x27;fuel&#x27;
#    outputs = &#x27;csv console&#x27;
#  [../]
#  [./temp_moder]
#    type = ElementAverageValue
#    variable = temp
#    block = &#x27;moder&#x27;
#    outputs = &#x27;csv console&#x27;
#  [../]
#  # [./average_fission_heat]
#  #   type = AverageFissionHeat
#  #   nt_scale = ${nt_scale}
#  #   execute_on = &#x27;linear nonlinear&#x27;
#  #   outputs = &#x27;console&#x27;
#  #   block = &#x27;fuel&#x27;
#  # [../]
#[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  # csv = true
  [out]
    type = Exodus
    execute_on = &#x27;final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="3d97f55e-7f23-4bf1-b1a2-cefbae2f7619"><div class="modal-content"><h4>(tests/nts/nts_no_action.i)</h4><pre style="max-height:350px;"><code class="language-moose">[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = 922
  sss2_input = false
  account_delayed = false
[]

[Problem]
  type = EigenProblem
  bx_norm = fiss_neutrons
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured_smaller.msh&#x27;
[]

[Variables]
  [group1]
  []
  [group2]
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    extra_vector_tags = &#x27;eigen&#x27;
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    extra_vector_tags = &#x27;eigen&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Eigenvalue
  eigen_tol = 1e-6
  free_power_iterations = 2
  normalization = fiss_neutrons
  normal_factor = 1
  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [k_eff]
    type = VectorPostprocessorComponent
    index = 0
    vectorpostprocessor = k_vpp
    vector_name = eigen_values_real
  []
  [fiss_neutrons]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fiss]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
  []
[]

[VectorPostprocessors]
  [k_vpp]
    type = Eigenvalues
    inverse_eigenvalue = true
    contains_complete_history = true
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="f0446f6c-4ede-4fbc-9123-cab7e97a17b1"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin.i)</h4><pre style="max-height:350px;"><code class="language-moose"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 39.94
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="24f2f305-3347-4b73-89eb-45cd515556e5"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eig-inverted-file-mesh-two-grp-two-mat.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[]

[Mesh]
  # file = &#x27;inverted_29x29_h_143.msh&#x27;
  file = &#x27;inverted_3x3_h_15.msh&#x27;
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="2163b12c-5bb6-4a7b-8348-e7d321293bed"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eigen-gen-mesh.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
[]

[Mesh]
  type = GeneratedMesh
  dim = 2
  xmax = 73.86
  ymax = 198.12
  nx = 100
  ny = 100
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
[]

[BCs]
  [vacuum1]
    type = VacuumConcBC
    boundary = &#x27;right top bottom&#x27;
    variable = group1
  []
  [vacuum2]
    type = VacuumConcBC
    boundary = &#x27;right top bottom&#x27;
    variable = group2
  []
[]

[Materials]
  [homo_reactor]
    type = GenericMoltresMaterial
    block = 0
    property_tables_root = &#x27;../property_file_dir/msre_homogeneous_critical_question_mark_b1_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  []
[]

[Executioner]
  # type = NonlinearEigen
  # free_power_iterations = 4
  # source_abs_tol = 1e-12
  # source_rel_tol = 1e-8
  # output_after_power_iterations = true

  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.0
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    group_fluxes = &#x27;group1 group2&#x27;
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="a57e4bf3-f44c-4b54-b102-dc5f98c1e469"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/k-eig-gen-msh-inf-one-grp.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 1
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1&#x27;
  temperature = ${global_temperature}
[]

[Mesh]
  type = GeneratedMesh
  dim = 2
  xmax = 80
  ymax = 80
  nx = 100
  ny = 100
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
[]

[Kernels]
  # Neutronics
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
[]

# [BCs]
#   [./vacuum1]
#     type = VacuumConcBC
#     boundary = &#x27;right top bottom&#x27;
#     variable = group1
#   [../]
# []

[Materials]
  [homo_reactor]
    type = GenericMoltresMaterial
    block = 0
    property_tables_root = &#x27;../property_file_dir/inf_crit_small_&#x27;
    interp_type = &#x27;none&#x27;
    temperature = ${global_temperature}
  []
[]

[Executioner]
  # type = NonlinearEigen
  # free_power_iterations = 4
  # source_abs_tol = 1e-12
  # source_rel_tol = 1e-8
  # output_after_power_iterations = true

  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    group_fluxes = &#x27;group1&#x27;
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#535025e4-fcd3-40aa-93eb-1825b97b7c19" class="tooltipped" data-position="left" data-tooltip="Overview">Overview</a></li><li><a href="#ee37efc7-e98a-429a-8023-f57a69e05303" class="tooltipped" data-position="left" data-tooltip="Example Input File Syntax">Example Input File Syntax</a></li><li><a href="#225fa35f-b338-438c-938e-387ebc866e89" class="tooltipped" data-position="left" data-tooltip="Input Parameters">Input Parameters</a></li><li><a href="#5b11cf10-8b54-4ac7-8a9a-1c7900f95b0a" class="tooltipped" data-position="left" data-tooltip="Input Files">Input Files</a></li><li><a href="#7dd6bde3-ac51-46b7-af45-1bda93d9727e" class="tooltipped" data-position="left" data-tooltip="References">References</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>