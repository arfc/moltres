<!DOCTYPE html><head><meta charset="UTF-8"><title>MultiAppGeneralFieldTransfer | Moltres</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/moltres.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Moltres</a><a href="https://github.com/arfc/moltres" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="c623f3d3-d1ba-4142-8577-1c2592eb9bcf" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="b3110df3-fd7b-47b5-ae7f-c993e4ccb8a7" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="2e7dc1c6-fccd-4c76-91f6-df0539a0e898" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#" class="sidenav-trigger" data-target="559be3b7-6172-4504-a36b-a7da3e9bdaa5"><i class="material-icons">menu</i></a><ul class="sidenav" id="559be3b7-6172-4504-a36b-a7da3e9bdaa5"><li><a href="#!" class="dropdown-trigger" data-target="9d6d2e60-3109-4a50-9855-a44f582c7abe" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="d9f937b2-61d8-4809-9f2f-cf5e9ad28968" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="ebb52e87-297f-4ed5-9de5-ccc467a19dfd" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="c623f3d3-d1ba-4142-8577-1c2592eb9bcf"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="b3110df3-fd7b-47b5-ae7f-c993e4ccb8a7"><li><a href="../../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="2e7dc1c6-fccd-4c76-91f6-df0539a0e898"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul><ul class="dropdown-content" id="9d6d2e60-3109-4a50-9855-a44f582c7abe"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="d9f937b2-61d8-4809-9f2f-cf5e9ad28968"><li><a href="../../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="ebb52e87-297f-4ed5-9de5-ccc467a19dfd"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">source</a><span class="breadcrumb">transfers</span><a href="#" class="breadcrumb">MultiAppGeneralFieldTransfer</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="674fb3b9-c1f3-4f2d-b5ec-ead20345df2f" data-section-level="1" data-section-text="MultiAppGeneralFieldTransfer"><h1 id="multiappgeneralfieldtransfer">MultiAppGeneralFieldTransfer</h1><p>Base class for all <code>GeneralField</code> transfers. It holds most setup and communication routines, leaving to the derived classes the charge of computing the transferred values.</p><section class="scrollspy" id="4a0c67d3-c872-4ea5-b492-2c4d859d9448" data-section-level="2" data-section-text="General description"><h2 id="general-description">General description</h2><p>A <code>GeneralField</code> transfer proceeds as follows:</p><p>Each process first looks to find which source application it will be talking to. This is based on geometric proximity, leveraging bounding boxes enclosing each application&#x27;s domain. The bounding boxes may need to be extended using the <a href="#9cbe3305-0d0e-4688-8d50-e124bc9bfe60" class="moose-modal-link modal-trigger">&quot;bbox_factor&quot;</a> parameter to expand the domain considered for transfers with wider stencils.</p><p>Then each process shares the list of target points, locations it needs data for, with each of the processes owning the source applications of interest. These other processes then, using the behavior defined in the derived class, compute the local value of the source variable. They also share geometric information about where this evaluation of the source variable was located, which can be used for interpolation for example.</p><p>Finally, the data received is placed in the solution vector of the target variable(s). This is performed using a local projection with the shape function of the target variable(s) in order to support higher order variables.</p></section><section class="scrollspy" id="4262eb35-0a72-442d-b45b-a3e72e746ad5" data-section-level="2" data-section-text="Features supported"><h2 id="features-supported">Features supported</h2><p>All transfers derived from this base class should be able to support:</p><ul class="browser-default"><li><p>block restriction in both the source and target application </p></li><li><p>boundary restriction in both the source and target application </p></li><li><p>arbitrary number of parallel processes for both the source and target application </p></li><li><p>support for replicated and distributed meshes in both applications involved </p></li><li><p>transfers between parent and child applications </p></li><li><p>transfers between sibling applications (child to child) </p></li><li><p>transfers between parent and multiple child applications in different locations </p></li><li><p>transfers to and from a displaced mesh </p></li><li><p>transfers of nodal and elemental variables </p></li><li><p>transfers between variables of different finite element/volume family and type </p></li><li><p>transfers between regular and array variables </p></li><li><p>transfers from multiple variables to multiple variables </p></li><li><p>interpolation and extrapolation transfers, as defined by the derived class </p></li><li><p>detection of indetermination due to source points equidistant to a target point </p></li><li><p>limitation of transfer source to the nearest position (see <a href="../../syntax/Positions/index.html">Positions</a>) of target point</p></li></ul><div class="card moose-alert moose-alert-note"><div class="card-title moose-alert-title"><i class="material-icons moose-inline-icon">comment</i><span class="moose-alert-title-brand">note</span></div><div class="card-content"><div class="moose-alert-content"><p>Examine each derived object&#x27;s respective documentation for feature support.</p></div></div></div></section><section class="scrollspy" id="61d5763c-8c97-4a8a-ad8c-0cfa794ea049" data-section-level="2" data-section-text="Features not supported"><h2 id="features-not-supported">Features not supported</h2><p>The following features cannot be supported by general field transfers, as a limitation of the <code>MultiAppGeneralFieldTransfer</code> base class.</p><ul class="browser-default"><li><p>bi-directional transfer, a single transfer that send data to an app and from that same application </p></li><li><p>transfers between two sibling <code>MultiApps</code> with different numbers of child applications </p></li><li><p>reduction operations, sum/average/min/max, on data transferred from multiple child apps </p></li><li><p>transfers between vector variables</p></li></ul><p>These features are currently unsupported, but could be enabled if necessary with reasonable efforts:</p><ul class="browser-default"><li><p>general coordinate transformations. Only the positions of the child apps are supported. </p></li><li><p>caching optimizations for when both the target and origin mesh are constant</p></li></ul></section><section class="scrollspy" id="43b081dd-d4af-4e48-87bb-19e7d074266f" data-section-level="2" data-section-text="Use of bounding boxes"><h2 id="use-of-bounding-boxes">Use of bounding boxes</h2><p>Bounding boxes are used in general field transfers to perform very fast checks on whether a point could belong to an origin mesh. If the point is not inside the bounding box of an application&#x27;s mesh, then it clearly cannot be inside that mesh. This allows to disqualify a majority of origin meshes very fast in situations where the transfer obtains data from multiple applications.</p><p>This process fails in several situations. When seeking to extrapolate from a source application (or interpolate between non-overlapping source applications), the target points can naturally be outside the bounding box of the source applications. In order to resolve this, the <code>Transfer</code>&#x27;s <a href="#872a0599-6083-4cdb-869b-5df99d6123ab" class="moose-modal-link modal-trigger">&quot;bbox_factor&quot;</a> and <a href="#1ab6d176-9814-4b84-9e59-71406901f1a8" class="moose-modal-link modal-trigger">&quot;fixed_bounding_box_size&quot;</a> may be used to inflate the bounding boxes.</p><div class="card moose-alert moose-alert-note"><div class="card-title moose-alert-title"><i class="material-icons moose-inline-icon">comment</i><span class="moose-alert-title-brand">note</span></div><div class="card-content"><div class="moose-alert-content"><p><a href="#ec49530e-8b87-4bce-af3d-4b9c439edf04" class="moose-modal-link modal-trigger">&quot;bounding_box_inflation&quot;</a> and <a href="#b71f2713-6629-496a-b622-4828a31d1fea" class="moose-modal-link modal-trigger">&quot;bounding_box_padding&quot;</a> parameters of the origin <code>MultiApp</code> are ignored. Only the <code>MultiAppGeneralFieldTransfer</code> <a href="#0a2a8385-d1be-40da-8d4a-a02ab0a8d57e" class="moose-modal-link modal-trigger">&quot;bbox_factor&quot;</a> and <a href="#24b105cc-db42-4301-97fa-022cc141fd46" class="moose-modal-link modal-trigger">&quot;fixed_bounding_box_size&quot;</a> parameters are taken into account.</p></div></div></div></section><section class="scrollspy" id="5d9e9548-5bce-480d-bf9e-ac611b4f8469" data-section-level="2" data-section-text="Using the Positions system to restrict transfer sources"><h2 id="using-the-positions-system-to-restrict-transfer-sources">Using the Positions system to restrict transfer sources</h2><p>In addition to block and boundary restriction, the <a href="../../syntax/Positions/index.html">Positions system</a> may be used to match origin and target points. When specified with the <a href="#269c25c0-5382-4438-b88c-09183b5a4a9c" class="moose-modal-link modal-trigger">&quot;use_nearest_position&quot;</a> parameter, each target point of a transfer will only be matched with sources that are closest to the same <code>Position</code> as the target point. The sources are simply the applications for:</p><ul class="browser-default"><li><p><a href="MultiAppGeneralFieldUserObjectTransfer.html">MultiAppGeneralFieldUserObjectTransfer</a> </p></li><li><p><a href="MultiAppGeneralFieldShapeEvaluationTransfer.html">MultiAppGeneralFieldShapeEvaluationTransfer</a></p></li></ul><p>and nodes or centroids for:</p><ul class="browser-default"><li><p><a href="MultiAppGeneralFieldNearestNodeTransfer.html">MultiAppGeneralFieldNearestNodeTransfer</a></p></li></ul><div class="card moose-alert moose-alert-note"><div class="card-title moose-alert-title"><i class="material-icons moose-inline-icon">comment</i><span class="moose-alert-title-brand">note</span></div><div class="card-content"><div class="moose-alert-content"><p>Unlike block and boundary restriction which are inclusive (more origin blocks/boundaries specified means a larger source), specifiying more <code>Positions</code> further restricts the considered source for a given target point.</p></div></div></div><div class="card moose-alert moose-alert-note"><div class="card-title moose-alert-title"><i class="material-icons moose-inline-icon">comment</i><span class="moose-alert-title-brand">note</span></div><div class="card-content"><div class="moose-alert-content"><p>The &quot;nearest position&quot; criterion for the source of a transfer is obeyed strictly. If closer, an invalid value (triggering the use of the <a href="#3837abed-3e93-4a0d-b756-01d9ed1077d9" class="moose-modal-link modal-trigger">&quot;extrapolation_constant&quot;</a>) should and will be preferred over a valid value.</p></div></div></div></section><section class="scrollspy" id="e43067c8-083a-43ce-89ba-5f5d598b302f" data-section-level="2" data-section-text="Overlap and floating point precision indetermination detection"><h2 id="overlap-and-floating-point-precision-indetermination-detection">Overlap and floating point precision indetermination detection</h2><p>The derived classes of <code>MultiAppGeneralFieldTransfer</code> may keep track of indetermination in origin values. In the event of indetermination in origin values, a single value is still selected, usually the one from the process with the lowest rank. These indetermination occur when for example:</p><ul class="browser-default"><li><p>multiple points in the origin mesh(es) are equidistant to the target location, for nearest-node type transfers </p></li><li><p>multiple child apps have an equidistant point to the target location, for nearest-node type transfers </p></li><li><p>multiple child apps can compute a valid value for a target location because their meshes overlap</p></li></ul><p><code>MultiAppGeneralFieldTransfer</code> itself keeps track of indetermination by examining received values for each target point. This occurs when multiple values are received for a single target point. Some transfers examine the distance between origin and target points to select a value, but this can still lead to indetermination if the distances are the same.</p><p>Mesh, block or boundary restriction can sometimes be used to alleviate these indeterminations in the origin values. Other times, either remeshing one of the apps or using the <a href="#16e9657f-2103-460f-904f-bd7ba32b1ab8" class="moose-modal-link modal-trigger">&quot;positions&quot;</a> parameter to create a very small offset can help remove the indetermination. </p></section></section><div class="moose-modal modal" id="9cbe3305-0d0e-4688-8d50-e124bc9bfe60"><div class="modal-content"><h4>bbox_factor</h4><p class="moose-parameter-description-default"><span>Default:</span>1</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Factor to inflate or deflate the source app bounding boxes</p></div></div><div class="moose-modal modal" id="872a0599-6083-4cdb-869b-5df99d6123ab"><div class="modal-content"><h4>bbox_factor</h4><p class="moose-parameter-description-default"><span>Default:</span>1</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Factor to inflate or deflate the source app bounding boxes</p></div></div><div class="moose-modal modal" id="1ab6d176-9814-4b84-9e59-71406901f1a8"><div class="modal-content"><h4>fixed_bounding_box_size</h4><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;double&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Override source app bounding box size(s) for searches. App bounding boxes will still be  centered on the same coordinates. Only non-zero components passed will override.</p></div></div><div class="moose-modal modal" id="ec49530e-8b87-4bce-af3d-4b9c439edf04"><div class="modal-content"><h4>bounding_box_inflation</h4><p class="moose-parameter-description-default"><span>Default:</span>0.01</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Relative amount to 'inflate' the bounding box of this MultiApp.</p></div></div><div class="moose-modal modal" id="b71f2713-6629-496a-b622-4828a31d1fea"><div class="modal-content"><h4>bounding_box_padding</h4><p class="moose-parameter-description-default"><span>Default:</span>0 0 0</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>libMesh::Point</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Additional padding added to the dimensions of the bounding box. The values are added to the x, y and z dimension respectively.</p></div></div><div class="moose-modal modal" id="0a2a8385-d1be-40da-8d4a-a02ab0a8d57e"><div class="modal-content"><h4>bbox_factor</h4><p class="moose-parameter-description-default"><span>Default:</span>1</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Factor to inflate or deflate the source app bounding boxes</p></div></div><div class="moose-modal modal" id="24b105cc-db42-4301-97fa-022cc141fd46"><div class="modal-content"><h4>fixed_bounding_box_size</h4><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;double&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Override source app bounding box size(s) for searches. App bounding boxes will still be  centered on the same coordinates. Only non-zero components passed will override.</p></div></div><div class="moose-modal modal" id="269c25c0-5382-4438-b88c-09183b5a4a9c"><div class="modal-content"><h4>use_nearest_position</h4><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>PositionsName</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Name of the the Positions object (in main app) such that transfers to/from a child application will work by finding the nearest position to a target and query only the app / points closer to this position than any other position for the value to transfer.</p></div></div><div class="moose-modal modal" id="3837abed-3e93-4a0d-b756-01d9ed1077d9"><div class="modal-content"><h4>extrapolation_constant</h4><p class="moose-parameter-description-default"><span>Default:</span>0</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Constant to use when no source app can provide a valid value for a target location.</p></div></div><div class="moose-modal modal" id="16e9657f-2103-460f-904f-bd7ba32b1ab8"><div class="modal-content"><h4>positions</h4><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;libMesh::Point&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The positions of the App locations.  Each set of 3 values will represent a Point.  This and 'positions_file' cannot be both supplied. If this and 'positions_file'/'_objects' are not supplied, a single position (0,0,0) will be used</p></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#4a0c67d3-c872-4ea5-b492-2c4d859d9448" class="tooltipped" data-position="left" data-tooltip="General description">General description</a></li><li><a href="#4262eb35-0a72-442d-b45b-a3e72e746ad5" class="tooltipped" data-position="left" data-tooltip="Features supported">Features supported</a></li><li><a href="#61d5763c-8c97-4a8a-ad8c-0cfa794ea049" class="tooltipped" data-position="left" data-tooltip="Features not supported">Features not supported</a></li><li><a href="#43b081dd-d4af-4e48-87bb-19e7d074266f" class="tooltipped" data-position="left" data-tooltip="Use of bounding boxes">Use of bounding boxes</a></li><li><a href="#5d9e9548-5bce-480d-bf9e-ac611b4f8469" class="tooltipped" data-position="left" data-tooltip="Using the Positions system to restrict transfer sources">Using the Positions system to restrict transfer sources</a></li><li><a href="#e43067c8-083a-43ce-89ba-5f5d598b302f" class="tooltipped" data-position="left" data-tooltip="Overlap and floating point precision indetermination detection">Overlap and floating point precision indetermination detection</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>