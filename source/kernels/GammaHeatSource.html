<!DOCTYPE html><head><meta charset="UTF-8"><title>GammaHeatSource | Moltres</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/moltres.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../contrib/katex/katex.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Moltres</a><a href="https://github.com/arfc/moltres" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="a6baa361-8c3c-4032-8668-fd11c522a366" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="831106f0-8b7e-487e-b176-f090cdb37192" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="27a93af1-3124-4ed8-9a92-3bd78485e69d" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#" class="sidenav-trigger" data-target="4de34f91-f3ae-453a-a60d-cebfc91c8777"><i class="material-icons">menu</i></a><ul class="sidenav" id="4de34f91-f3ae-453a-a60d-cebfc91c8777"><li><a href="#!" class="dropdown-trigger" data-target="429e3699-3f3b-4b1f-8f20-0bb31ccfebc0" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="cd37b9ca-a520-4596-860a-20bb8bb58c15" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="a597e992-771a-4baa-918c-effd55a898e8" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="a6baa361-8c3c-4032-8668-fd11c522a366"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/theory.html">Theory</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="831106f0-8b7e-487e-b176-f090cdb37192"><li><a href="../../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="27a93af1-3124-4ed8-9a92-3bd78485e69d"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul><ul class="dropdown-content" id="429e3699-3f3b-4b1f-8f20-0bb31ccfebc0"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/theory.html">Theory</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="cd37b9ca-a520-4596-860a-20bb8bb58c15"><li><a href="../../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="a597e992-771a-4baa-918c-effd55a898e8"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><span class="breadcrumb">source</span><span class="breadcrumb">kernels</span><a href="#" class="breadcrumb">GammaHeatSource</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="0c2d87d1-d60f-4869-92cc-8ec60548b7e2" data-section-level="1" data-section-text="GammaHeatSource"><h1 id="gammaheatsource">GammaHeatSource</h1><p></p><section class="scrollspy" id="5dfacaaa-4914-4c69-88ec-1d15b49a6b5e" data-section-level="2" data-section-text="Overview"><h2 id="overview">Overview</h2><p>This object adds the <span class="moose-katex-inline-equation" id="moose-equation-fa65d279-2921-4535-80ed-d80632fd856f"><script>var element = document.getElementById("moose-equation-fa65d279-2921-4535-80ed-d80632fd856f");katex.render("\\gamma \\sum_{g=1}^G \\epsilon_g\\Sigma_{f,g}\\phi_g", element, {displayMode:false,throwOnError:false});</script></span> gamma heat source term of the temperature advection-diffusion equation where <span class="moose-katex-inline-equation" id="moose-equation-4b9a79f5-88a0-4e3b-b05f-81ad90e8f9bd"><script>var element = document.getElementById("moose-equation-4b9a79f5-88a0-4e3b-b05f-81ad90e8f9bd");katex.render("\\gamma", element, {displayMode:false,throwOnError:false});</script></span> is a factor represeting heat deposition by gamma and neutron irradiation in the moderator.</p></section><section class="scrollspy" id="db994bff-8431-409c-b38d-e1ab4e117f04" data-section-level="2" data-section-text="Example Input File Syntax"><h2 id="example-input-file-syntax">Example Input File Syntax</h2><p></p></section><section class="scrollspy" id="d7ab037f-21ec-4580-993a-add10b233589" data-section-level="2" data-section-text="Input Parameters"><h2 id="input-parameters">Input Parameters</h2><section id="60cd840d-f73c-4ed7-9587-4efc46977ead" data-section-level="3" data-section-text="Required Parameters" data-details-open="open"><details class="moose-section-content" open="open"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">average_fission_heat</span><span class="moose-parameter-header-description">The average fission heat being generated in the fuel portion of the reactor.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>PostprocessorName</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The average fission heat being generated in the fuel portion of the reactor.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">gamma</span><span class="moose-parameter-header-description">The ratio of power density generated in the moderator vs. the fuel.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>FunctionName</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The ratio of power density generated in the moderator vs. the fuel.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">variable</span><span class="moose-parameter-header-description">The name of the variable that this residual object operates on</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>NonlinearVariableName</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of the variable that this residual object operates on</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Required Parameters</h3></summary></details></section><section id="f9a35507-dadd-4249-abdd-6604268aca93" data-section-level="3" data-section-text="Optional Parameters" data-details-open="open"><details class="moose-section-content" open="open"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">block</span><span class="moose-parameter-header-description">The list of blocks (ids or names) that this object will be applied</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;SubdomainName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The list of blocks (ids or names) that this object will be applied</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">displacements</span><span class="moose-parameter-header-description">The displacements</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;VariableName&gt;</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The displacements</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">matrix_only</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether this object is only doing assembly to matrices (no vectors)</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether this object is only doing assembly to matrices (no vectors)</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Optional Parameters</h3></summary></details></section><section id="640007d3-9247-4979-9fb0-d7149e04b205" data-section-level="3" data-section-text="Contribution To Tagged Field Data Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">absolute_value_vector_tags</span><span class="moose-parameter-header-description">The tags for the vectors this residual object should fill with the absolute value of the residual contribution</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tags for the vectors this residual object should fill with the absolute value of the residual contribution</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">extra_matrix_tags</span><span class="moose-parameter-header-description">The extra tags for the matrices this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The extra tags for the matrices this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">extra_vector_tags</span><span class="moose-parameter-header-description">The extra tags for the vectors this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The extra tags for the vectors this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">matrix_tags</span><span class="moose-parameter-header-default">system</span><span class="moose-parameter-header-description">The tag for the matrices this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>system</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MultiMooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nontime, system</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tag for the matrices this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">vector_tags</span><span class="moose-parameter-header-default">nontime</span><span class="moose-parameter-header-description">The tag for the vectors this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>nontime</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MultiMooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nontime, time</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tag for the vectors this Kernel should fill</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Contribution To Tagged Field Data Parameters</h3></summary></details></section><section id="3c5f82b4-885f-4037-a50b-87fef46aee54" data-section-level="3" data-section-text="Advanced Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">control_tags</span><span class="moose-parameter-header-description">Adds user-defined labels for accessing object parameters via control logic.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;std::string&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Adds user-defined labels for accessing object parameters via control logic.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">diag_save_in</span><span class="moose-parameter-header-description">The name of auxiliary variables to save this Kernel's diagonal Jacobian contributions to. Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;AuxVariableName&gt;</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of auxiliary variables to save this Kernel's diagonal Jacobian contributions to. Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">enable</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Set the enabled status of the MooseObject.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>Yes</p><p class="moose-parameter-description"><span>Description:</span>Set the enabled status of the MooseObject.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">implicit</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Determines whether this object is calculated using an implicit or explicit form</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Determines whether this object is calculated using an implicit or explicit form</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">save_in</span><span class="moose-parameter-header-description">The name of auxiliary variables to save this Kernel's residual contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;AuxVariableName&gt;</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of auxiliary variables to save this Kernel's residual contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">search_method</span><span class="moose-parameter-header-default">nearest_node_connected_sides</span><span class="moose-parameter-header-description">Choice of search algorithm.  All options begin by finding the nearest node in the primary boundary to a query point in the secondary boundary.  In the default nearest_node_connected_sides algorithm, primary boundary elements are searched iff that nearest node is one of their nodes.  This is fast to determine via a pregenerated node-to-elem map and is robust on conforming meshes.  In the optional all_proximate_sides algorithm, primary boundary elements are searched iff they touch that nearest node, even if they are not topologically connected to it.  This is more CPU-intensive but is necessary for robustness on any boundary surfaces which has disconnections (such as Flex IGA meshes) or non-conformity (such as hanging nodes in adaptively h-refined meshes).</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>nearest_node_connected_sides</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nearest_node_connected_sides, all_proximate_sides</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Choice of search algorithm.  All options begin by finding the nearest node in the primary boundary to a query point in the secondary boundary.  In the default nearest_node_connected_sides algorithm, primary boundary elements are searched iff that nearest node is one of their nodes.  This is fast to determine via a pregenerated node-to-elem map and is robust on conforming meshes.  In the optional all_proximate_sides algorithm, primary boundary elements are searched iff they touch that nearest node, even if they are not topologically connected to it.  This is more CPU-intensive but is necessary for robustness on any boundary surfaces which has disconnections (such as Flex IGA meshes) or non-conformity (such as hanging nodes in adaptively h-refined meshes).</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">seed</span><span class="moose-parameter-header-default">0</span><span class="moose-parameter-header-description">The seed for the master random number generator</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>0</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The seed for the master random number generator</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">use_displaced_mesh</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether or not this object should use the displaced mesh for computation. Note that in the case this is true but no displacements are provided in the Mesh block the undisplaced mesh will still be used.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether or not this object should use the displaced mesh for computation. Note that in the case this is true but no displacements are provided in the Mesh block the undisplaced mesh will still be used.</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Advanced Parameters</h3></summary></details></section><section id="2c870856-cada-4fc3-8be9-cf48a4741cb9" data-section-level="3" data-section-text="Material Property Retrieval Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">prop_getter_suffix</span><span class="moose-parameter-header-description">An optional suffix parameter that can be appended to any attempt to retrieve/get material properties. The suffix will be prepended with a '_' character.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MaterialPropertyName</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>An optional suffix parameter that can be appended to any attempt to retrieve/get material properties. The suffix will be prepended with a '_' character.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">use_interpolated_state</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">For the old and older state use projected material properties interpolated at the quadrature points. To set up projection use the ProjectedStatefulMaterialStorageAction.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>For the old and older state use projected material properties interpolated at the quadrature points. To set up projection use the ProjectedStatefulMaterialStorageAction.</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Material Property Retrieval Parameters</h3></summary></details></section></section><section class="scrollspy" id="6e9a9443-ffb2-4bcf-aa8d-e957815e05ed" data-section-level="2" data-section-text="Input Files"><h2 id="input-files">Input Files</h2><ul class="moose-list-inputs browser-default"><li><a class="moose-source-filename tooltipped modal-trigger" href="#2dc30c2a-2bf2-4659-83de-4a105ba2f85b">(problems/publication_level_cases/gamma_heating_3d_ss/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#48365072-6757-492e-a840-c0956c6a6525">(problems/033117_nts_temp_pre_parsed_mat/2d_axi_function_cross_sections.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#30333ab6-8d6b-4c6b-8b49-41b580dcd520">(problems/picard/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#5af82b51-0d73-42d0-9d25-69ab483e60d4">(problems/publication_level_cases/twod_control_rod_yank/rodded.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#d6846e06-68d7-4d85-b7f1-91f47a59011d">(problems/021417_MSRE_materials/CG_temp.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9e10cb08-43fe-4e2d-80e4-cbb524d7a376">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_monotone_interp.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#815939d6-431f-4725-9de7-d93bfb0d5a28">(problems/2017_annals_pub_msre_compare/2group.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#2301aba9-07d1-4b9c-a0c8-8d5f09b34dac">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#bdfd5c9c-264b-4d2c-9d63-cd26996d5fde">(problems/LOSCA/HXFailure/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#2e0750f6-f420-4b79-93dd-e923b890ca7a">(problems/publication_level_cases/3d_steady_state/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#2fd6ec44-3c02-49ba-b195-0151487aeff8">(problems/LOFA/steady/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b14fd88d-0809-45f5-a3a4-c20fbcfe51cd">(problems/072017_dg_temperature/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#54747bb6-3d1b-48a9-acf5-32907203e549">(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-channel-msre-dimensions.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#2d39d2f2-4e94-4056-82f7-a0ff2036e228">(problems/020617_mod_heat_source_one_minus_beta_fission/Input_PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#558b1ebf-bd6f-49d3-b337-c8feb73f2c8a">(problems/single_msre_channel_velocity_heat_nts/unit-cell-heat-and-nts.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#c49d443a-a0cb-4e97-90c6-a40abde37070">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive_PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#80440e04-251a-465d-b609-3bd6e924a799">(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-mod-heat-PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#254c4cbd-179e-4eb8-9446-1f7ef6fc7cd8">(problems/publication_level_cases/LOSCA/sub.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#0dc5dd74-21ba-4f05-9b6e-8be47ea273d7">(problems/020617_mod_heat_source_one_minus_beta_fission/Input.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#1bffdc1a-9df4-4e2f-a601-f4b68b68e8e2">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b46bbd01-a23d-4e3a-9ae2-18b8951d0d45">(problems/constant_inlet_outlet_temp_no_heat_flux_at_walls/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#fb8367f0-aa00-421b-a7b2-58b314717f51">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#ccc3f7a7-8e62-4abf-922e-ba935ec6680c">(problems/publication_level_cases/LOSCA/HXFail/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#c114231b-8261-4400-a6e0-2da8efc73437">(problems/publication_level_cases/dilute_absorber_controlled_by_peak_power_density/in.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e88ecd53-f4d6-45cc-a12a-fbc018f04bec">(problems/publication_level_cases/LOSCA/HXFail/sub.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#637e5ad4-fc1d-4b2d-bfa8-d68679552951">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_control.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b95a1cdb-b3ba-423f-89a2-ce8c97c69510">(problems/rodMatchSerpentWorth/adjustAbsorb/rodded.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#db1ba034-56e2-4f14-b47b-85671f50f718">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_restart.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6cabb9f9-ba0a-44dd-83a1-657751149961">(problems/rodded2D/rodded.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#ab707a90-b3a3-464e-9ad2-80be890000a1">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_direct.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9c09473f-48c5-477b-a55b-50906eb57820">(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-unit-cell.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b3c70c11-5b1f-42f5-9842-b3c743afe11c">(problems/LOSCA/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#3a40d776-f524-493c-9724-35fa955fa5a9">(problems/LOSCA/HXFailure/sub.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#d5d6ec42-40a6-4b72-b76b-076c9d02b485">(problems/LOSCA/sub.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#72a5493d-0fa0-4e89-8a1b-1beede47b27e">(problems/2017_annals_pub_msre_compare/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#53339e59-ec17-4e29-8d7e-6247bcb494e9">(problems/publication_level_cases/transient_single_channel_blockage/3d_ss.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#005ee43c-861c-40cb-a186-48df2862eb3d">(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#819cd58c-a346-4f0e-bf15-225f9b75ae4d">(problems/rodMatchSerpentWorth/rodded.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6aaddb01-14f0-4884-a8e5-25978353649c">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6959024f-3c6c-45ab-98ad-2d35b05987de">(problems/publication_level_cases/transient_single_channel_blockage/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#47ad46a9-6763-45d3-9f54-30b605ed6a5a">(problems/020617_mod_heat_source_one_minus_beta_fission/gamma_source_check.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#845fe7bf-5752-4662-95b1-c67f9813b9b9">(problems/021417_MSRE_materials/mini_msre_cg_temp.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#80de8e27-fbba-4472-97e6-7a0f10c6f01e">(problems/publication_level_cases/LOSCA/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#389e813f-6101-4999-b3b8-574fa9c3451e">(problems/060717_dimension_testing/one_group.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#293f2adb-d8c8-4b3d-b25b-8ecfb09c9b3c">(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function_moderator_heating.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#22210b5f-8489-4986-98a6-5734a883226a">(problems/021417_MSRE_materials/Input.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#f863614e-ebc6-49fc-81fe-3c59527bf46e">(problems/picard/tmp_nts.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#8de8752f-0fbe-419a-abfe-5a64d17058ee">(problems/LOFA/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#744e8bb8-7dcc-4601-b48f-1294454bbc83">(problems/2017_annals_pub_msre_compare/4group.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#3f5d549d-c425-4d64-92cd-023b0149aaa9">(problems/picard/temp_no_pres.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#636836c0-ad58-44cc-b5e1-99ac47f131aa">(problems/picard/temp.i)</a></li></ul></section></section><div class="moose-modal modal" id="2dc30c2a-2bf2-4659-83de-4a105ba2f85b"><div class="modal-content"><h4>(problems/publication_level_cases/gamma_heating_3d_ss/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
  [./group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  [../]
  [./group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="48365072-6757-492e-a840-c0956c6a6525"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/2d_axi_function_cross_sections.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[]

[MeshModifiers]
  [scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 1&#x27;
  []
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
  #  petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
    execute_on = &#x27;timestep_end final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="30333ab6-8d6b-4c6b-8b49-41b580dcd520"><div class="modal-content"><h4>(problems/picard/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="5af82b51-0d73-42d0-9d25-69ab483e60d4"><div class="modal-content"><h4>(problems/publication_level_cases/twod_control_rod_yank/rodded.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 4
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_rodded_lattice.msh&#x27;
[../]

[Problem]
  coord_type = RZ
  kernel_coverage_check = false
[]

[Variables]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
  [./rodPosition]
    family = SCALAR
    order = FIRST
    initial_condition = 0.0
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall cRod_top cRod_bot&#x27;
  create_temperature_var = false
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[ScalarKernels]
  [./tdRodPos]
    type = ODETimeDerivative
    variable = rodPosition
  [../]
  [./rodposForce]
    type = ParsedODEKernel
    function = &#x27;rodPosition - 100&#x27;
    variable = rodPosition
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gfuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  [./cRod]
    type = RoddedMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;cRod&#x27;
    rodDimension = &#x27;y&#x27;
    rodPosition = rodPosition
    absorb_factor = 1e6 # how much more absorbing than usual in absorbing region?
  [../]
  [./rho_crod]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;cRod&#x27;
  [../]

[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  solve_type = &#x27;PJFNK&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100
  [./TimeStepper]
    type = PostprocessorDT
    postprocessor = limit_k
    dt = 0.1
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    # ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
     type = AverageFissionHeat
     nt_scale = ${nt_scale}
     execute_on = &#x27;linear nonlinear&#x27;
     outputs = &#x27;console&#x27;
     block = &#x27;fuel&#x27;
  [../]
  [./limit_k]
    type = LimitK
    execute_on = &#x27;timestep_end&#x27;
    k_postprocessor = multiplication
    growth_factor = 1.2
    cutback_factor = .4
    k_threshold = 1.5
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  execute_on = &#x27;timestep_end final&#x27;
  file_base = &#x27;out&#x27;
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d6846e06-68d7-4d85-b7f1-91f47a59011d"><div class="modal-content"><h4>(problems/021417_MSRE_materials/CG_temp.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
diri_temp=908
nt_scale=1e13
reactor_height=162.56
global_temperature=temp
# global_temperature=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
#   u_def = 0
#   v_def = 0
#   w_def = ${flow_velocity}
[../]

[Mesh]
  file = &#x27;msre_22x22_correct_vol_fraction.msh&#x27;
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  create_temperature_var = true
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = false
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[Materials]
  [./fuel]
    # type = CammiFuel
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_fuel_data_func_of_fuel_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    # type = CammiModerator
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_mod_data_func_of_mod_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;fuel_bottoms moder_bottoms fuel_sides&#x27;
    type = DirichletBC
    variable = temp
    value = ${diri_temp}
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

# [Problem]
#   type = FEProblem
#   coord_type = RZ
# [../]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  print_linear_residuals = true
  perf_graph = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./diri_temp_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
#   # [./average_fission_heat]
#   #   type = AverageFissionHeat
#   #   nt_scale = ${nt_scale}
#   #   execute_on = &#x27;linear nonlinear&#x27;
#   #   outputs = &#x27;csv console&#x27;
#   #   block = &#x27;fuel&#x27;
#   # [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9e10cb08-43fe-4e2d-80e4-cbb524d7a376"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_monotone_interp.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="815939d6-431f-4725-9de7-d93bfb0d5a28"><div class="modal-content"><h4>(problems/2017_annals_pub_msre_compare/2group.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922
gamma_frac = .075
R = 73
H = 162.56

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  nt_scale = ${nt_scale}
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Variables]
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  create_temperature_var = false
  scaling = 1e-4
  pre_blocks = &#x27;fuel&#x27;
[]

[Kernels]
  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
    gamma = gamma_func
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity_variable = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [temp_diri_cg]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = FlexiblePostprocessorDirichletBC
    postprocessor = coreEndTemp
    offset = -27.8
    variable = temp
  []
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
    gamma = gamma_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [gamma_func]
    type = ParsedFunction
    expression = &#x27;${gamma_frac} * pi^2 / 4 * cos(pi * x / (2. * ${R})) * sin(pi * y / ${H})&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/serp3d2group0.78eV/2g0.78eV_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/serp3d2group0.78eV/2g0.78eV_moder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [TimeStepper]
    type = PostprocessorDT
    postprocessor = limit_k
    dt = 1e-3
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
  [coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  []
  [limit_k]
    type = LimitK
    execute_on = &#x27;timestep_end&#x27;
    k_postprocessor = multiplication
    growth_factor = 1.2
    cutback_factor = .4
    k_threshold = 1.5
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="2301aba9-07d1-4b9c-a0c8-8d5f09b34dac"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin.i)</h4><pre style="max-height:350px;"><code class="language-moose"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 39.94
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="bdfd5c9c-264b-4d2c-9d63-cd26996d5fde"><div class="modal-content"><h4>(problems/LOSCA/HXFailure/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
  loop_precursors = true
  multi_app = loopApp
  is_loopapp = false
  inlet_boundaries = &#x27;fuel_bottoms&#x27;
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-pc_type&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="2e0750f6-f420-4b79-93dd-e923b890ca7a"><div class="modal-content"><h4>(problems/publication_level_cases/3d_steady_state/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
  [./group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  [../]
  [./group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="2fd6ec44-3c02-49ba-b195-0151487aeff8"><div class="modal-content"><h4>(problems/LOFA/steady/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose"># walk the reactor into steady state with an attached primary loop

flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../2d_lattice_structured.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[PrecursorKernel]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_postpr_inlet]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    variable = temp
    postprocessor = inlet_mean_temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

#[Materials]
#  [./fuel]
#    type = GenericMoltresMaterial
#    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
#    interp_type = &#x27;spline&#x27;
#    block = &#x27;fuel&#x27;
#  [../]
#  [./rho_fuel]
#    type = DerivativeParsedMaterial
#    f_name = rho
#    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  # fuel cp function
#  [./cp_fuel]
#    type = DerivativeParsedMaterial
#    f_name = cp
#    function = &#x27;1967 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  # fuel k function
#  [./k_fuel]
#    type = DerivativeParsedMaterial
#    f_name = k
#    function = &#x27;0.0553 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  [./moder]
#    type = GenericMoltresMaterial
#    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
#    interp_type = &#x27;spline&#x27;
#    block = &#x27;moder&#x27;
#  [../]
#  [./rho_moder]
#    type = DerivativeParsedMaterial
#    f_name = rho
#    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#  # moder cp fcn
#  [./cp_moder]
#    type = DerivativeParsedMaterial
#    f_name = cp
#    function = &#x27;1760 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#  # moder k fcn
#  [./k_moder]
#    type = DerivativeParsedMaterial
#    f_name = k
#    function = &#x27;.312 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#[]
[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 100

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  dtmax = 100
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  #multiapp
  [./inlet_mean_temp]
    type = Receiver
    execute_on = &#x27;timestep_begin&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = &#x27;initial timestep_begin&#x27;
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = average
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b14fd88d-0809-45f5-a3a4-c20fbcfe51cd"><div class="modal-content"><h4>(problems/072017_dg_temperature/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
sigma_val=.6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
    order = FIRST
    family = MONOMIAL
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    type = DGDiffusionPostprocessorDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diffusivity = &#x27;k&#x27;
    postprocessor = coreEndTemp
    offset = -50
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    type = PostprocessorTemperatureInflowBC
    variable = temp
    uu = 0
    vv = ${flow_velocity}
    ww = 0
    postprocessor = coreEndTemp
    offset = -50
  [../]
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  [../]
[]

[VectorPostprocessors]
  [./outlet_temps]
    type = LineValueSampler
    start_point = &#x27;0 153 0&#x27;
    end_point = &#x27;72.5 153 0&#x27;
    num_points = 1000
    variable = temp
    sort_by = &#x27;x&#x27;
    outputs = &#x27;csv&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./csv]
    type = CSV
    execute_on = &#x27;final&#x27;
  [../]
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="54747bb6-3d1b-48a9-acf5-32907203e549"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-channel-msre-dimensions.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = single_channel_msre_dimensions.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[AuxVariables]
  [./vel_x]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_y]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_z]
    block = &#x27;fuel&#x27;
  [../]
  [./p]
    block = &#x27;fuel&#x27;
  [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_fuel_transport]
    type = INSTemperature
    u = vel_x
    v = vel_y
    w = vel_z
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    solve_type = PJFNK
    ksp_norm = none
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

[MultiApps]
  [./sub]
    type = FullSolveMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = solution_aux_exodus.i
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Transfers]
  [./vel_x]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_x
    variable = vel_x
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_y]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_y
    variable = vel_y
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_z]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_z
    variable = vel_z
    execute_on = &#x27;initial&#x27;
  [../]
  [./p]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = p
    variable = p
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="2d39d2f2-4e94-4056-82f7-a0ff2036e228"><div class="modal-content"><h4>(problems/020617_mod_heat_source_one_minus_beta_fission/Input_PJFNK.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e16
reactor_height=115 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=temp
sigma_val=6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
[../]

[Mesh]
  file = &#x27;cylinder_structured.msh&#x27;
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  # create_temperature_var = false
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = true
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DGFunctionDiffusionDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
    function = &#x27;inlet_boundary_temp_func&#x27;
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    type = TemperatureInflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    inlet_conc = 824
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -ksp_gmres_restart&#x27;
  petsc_options_value = &#x27;asm      lu           2               preonly       31&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  print_linear_residuals = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./forcing_func]
    type = ParsedFunction
    value = &#x27;1000&#x27;
  [../]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./inlet_boundary_temp_func]
    type = ParsedFunction
    value = &#x27;${inlet_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="558b1ebf-bd6f-49d3-b337-c8feb73f2c8a"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/unit-cell-heat-and-nts.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = msre_squares.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    scaling = 1e2
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    scaling = 1e2
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
    scaling = 1e-4
    # initial_condition = 900
  [../]
[]

[AuxVariables]
  # [./vel_x]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./vel_y]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./vel_z]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./p]
  #   block = &#x27;fuel&#x27;
  # [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_fuel_transport]
  #   type = INSTemperature
  #   u = vel_x
  #   v = vel_y
  #   w = vel_z
  #   variable = temp
  #   block = &#x27;fuel&#x27;
  # [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 21.73&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    # block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 21.73&#x27;
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;linear&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-2
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;linear&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    ksp_norm = &#x27;none&#x27;
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # line_search = &#x27;none&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-5
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

# [MultiApps]
#   [./sub]
#     type = FullSolveMultiApp
#     app_type = MoltresApp
#     positions = &#x27;0 0 0&#x27;
#     input_files = solution_aux_exodus.i
#     execute_on = &#x27;initial&#x27;
#   [../]
# []

# [Transfers]
#   [./vel_x]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_x
#     variable = vel_x
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./vel_y]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_y
#     variable = vel_y
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./vel_z]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_z
#     variable = vel_z
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./p]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = p
#     variable = p
#     execute_on = &#x27;initial&#x27;
#   [../]
# []

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    # outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    # outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="c49d443a-a0cb-4e97-90c6-a40abde37070"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive_PJFNK.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # uniform_refine = 1
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    # off_diag_row = &#x27;temp pre1 pre2 pre3 pre4 pre5 pre6 temp pre1 pre2 pre3 pre4 pre5 pre6&#x27;
    # off_diag_column = &#x27;group1 group1 group1 group1 group1 group1 group1 group2 group2 group2 group2 group2 group2 group2&#x27;
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []

# [Adaptivity]
#   marker = errorfrac_temp
#   max_h_level = 1
#   [./Indicators]
#     [./error_temp]
#       type = GradientJumpIndicator
#       variable = temp
#       outputs = none
#     [../]
#   [../]
#   [./Markers]
#     [./errorfrac_temp]
#       type = ErrorFractionMarker
#       refine = 0.8
#       coarsen = 0.1
#       indicator = error_temp
#       outputs = none
#     [../]
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="80440e04-251a-465d-b609-3bd6e924a799"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-mod-heat-PJFNK.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;cylinder_structured_for_msre_comp.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;graphite_bottom fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="254c4cbd-179e-4eb8-9446-1f7ef6fc7cd8"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/sub.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 0
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  # account_delayed = true
[]

[Mesh]
  type = GeneratedMesh
  dim = 1
  nx = 600
  xmax = 500
  elem_type = EDGE2
[../]

[Variables]
  [./temp]
    initial_condition = 930 #approx steady outlet of other problem
    scaling = 1e-4
    family = MONOMIAL
    order = CONSTANT
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  outlet_boundaries = &#x27;right&#x27;
  u_def = ${flow_velocity}
  v_def = 0
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
 [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_source_fuel]
  #   type = TransientFissionHeatSource
  #   variable = temp
  #   nt_scale=${nt_scale}
  # [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  # [./temp_diffusion]
  #   type = MatDiffusion
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
  # [./temp_advection_fuel]
  #   type = ConservativeTemperatureAdvection
  #   velocity = &#x27;${flow_velocity} 0 0&#x27;
  #   variable = temp
  # [../]
[]

[DGKernels]
  [./temp_adv]
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]


[DiracKernels]
  [./heat_exchanger]
    type = DiracHX
    variable = temp
    power = 4e3 # see controls
    point = &#x27;250 0 0&#x27;
  [../]
[]


[BCs]
  [./fuel_bottoms_looped]
    boundary = &#x27;left&#x27;
    type = PostprocessorTemperatureInflowBC
    postprocessor = coreEndTemp
    variable = temp
    uu = ${flow_velocity}
  [../]
  # [./diri]
  #   boundary = &#x27;left&#x27;
  #   type = DirichletBC
  #   variable = temp
  #   value = 930
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;right&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    outputs = &#x27;exodus console&#x27;
  [../]
  [./loopEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;right&#x27;
  [../]
  [./coreEndTemp]
    type = Receiver
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;sub&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# connect inlet and outlet to multiapp
# [Transfers]
#   [./to_core]
#     type = MultiAppPostprocessorTransfer
#     multi_app = MoltresApp
#     from_postprocessor = loopEndTemp
#     to_postprocessor = inlet_mean_temp
#     direction = to_multiapp
#   [../]
#   [./from_core]
#     type = MultiAppPostprocessorTransfer
#     multi_app = MoltresApp
#     from_postprocessor = coreEndTemp
#     to_postprocessor = coreEndTemp
#     direction = to_multiapp
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="0dc5dd74-21ba-4f05-9b6e-8be47ea273d7"><div class="modal-content"><h4>(problems/020617_mod_heat_source_one_minus_beta_fission/Input.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e16
reactor_height=115 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=temp
sigma_val=6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
[../]

[Mesh]
  file = &#x27;cylinder_structured.msh&#x27;
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  # create_temperature_var = false
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = true
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DGFunctionDiffusionDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
    function = &#x27;inlet_boundary_temp_func&#x27;
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    type = TemperatureInflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    inlet_conc = 824
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./forcing_func]
    type = ParsedFunction
    value = &#x27;1000&#x27;
  [../]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./inlet_boundary_temp_func]
    type = ParsedFunction
    value = &#x27;${inlet_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="1bffdc1a-9df4-4e2f-a601-f4b68b68e8e2"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922
base_height = 136
scale = .99
height = &#x27;${fparse base_height * scale}&#x27;
width = 145
offset = 2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  [file]
    type = FileMeshGenerator
    ## Default to jac_test.msh for quicker syntax check tests.
    ## Switch to 3D mesh for actual simulations.
    # file = &#x27;3d_msre_29x29_136.msh&#x27;
    file = jac_test.msh
  []
  [scale]
    type = TransformGenerator
    input = file
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  []
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    #     initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    #     initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity_variable = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [nt_ic_func]
    type = ParsedFunction
    expression = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  []
[]

[Materials]
  [fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
  #   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  #   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  #   [./temp_ic]
  #     type = RandomIC
  #     variable = temp
  #     min = 922
  #     max = 1022
  #   [../]
  #   [./group1_ic]
  #     type = RandomIC
  #     variable = group1
  #     min = .5
  #     max = 1.5
  #   [../]
  #   [./group2_ic]
  #     type = RandomIC
  #     variable = group2
  #     min = .5
  #     max = 1.5
  #   [../]
  [group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  []
  [group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b46bbd01-a23d-4e3a-9ae2-18b8951d0d45"><div class="modal-content"><h4>(problems/constant_inlet_outlet_temp_no_heat_flux_at_walls/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;fuel_bottoms&#x27;
    type = FlexiblePostprocessorDirichletBC
    postprocessor = coreEndTemp
    offset = -50
    variable = temp
  [../]
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  [../]
[]

[VectorPostprocessors]
  [./outlet_temps]
    type = LineValueSampler
    start_point = &#x27;0 153 0&#x27;
    end_point = &#x27;72.5 153 0&#x27;
    num_points = 1000
    variable = temp
    sort_by = &#x27;x&#x27;
    outputs = &#x27;csv&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
  [./csv]
    type = CSV
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="fb8367f0-aa00-421b-a7b2-58b314717f51"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;NEWTON&#x27;
  # solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  # exodus = true
  nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="ccc3f7a7-8e62-4abf-922e-ba935ec6680c"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/HXFail/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-pc_type&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="c114231b-8261-4400-a6e0-2da8efc73437"><div class="modal-content"><h4>(problems/publication_level_cases/dilute_absorber_controlled_by_peak_power_density/in.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  # nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e88ecd53-f4d6-45cc-a12a-fbc018f04bec"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/HXFail/sub.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 0
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  # account_delayed = true
[]

[Mesh]
  file = &#x27;../sub.e&#x27;
[]


[Variables]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
    family = MONOMIAL
    order = CONSTANT
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  outlet_boundaries = &#x27;right&#x27;
  u_def = ${flow_velocity}
  v_def = 0
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
 [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_source_fuel]
  #   type = TransientFissionHeatSource
  #   variable = temp
  #   nt_scale=${nt_scale}
  # [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  # [./temp_diffusion]
  #   type = MatDiffusion
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
  # [./temp_advection_fuel]
  #   type = ConservativeTemperatureAdvection
  #   velocity = &#x27;${flow_velocity} 0 0&#x27;
  #   variable = temp
  # [../]
[]

[DGKernels]
  [./temp_adv]
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]


[DiracKernels]
  [./heat_exchanger]
    type = DiracHX
    variable = temp
    point = &#x27;250 0 0&#x27;
    power = 4e3
  [../]
[]


[BCs]
  [./fuel_bottoms_looped]
    boundary = &#x27;left&#x27;
    type = PostprocessorTemperatureInflowBC
    postprocessor = coreEndTemp
    variable = temp
    uu = ${flow_velocity}
  [../]
  # [./diri]
  #   boundary = &#x27;left&#x27;
  #   type = DirichletBC
  #   variable = temp
  #   value = 930
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;right&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]

[Functions]
  [./heatRemovalFcn]
    type = ParsedFunction
    value = &#x27;4e3 * ( 1 - tanh( (t-5) ) )&#x27; # start losing cooling at t=5s
  [../]
[]

[Controls]
  [./hxFuncCtrl]
    type = RealFunctionControl
    parameter = &#x27;*/*/power&#x27;
    function = &#x27;heatRemovalFcn&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    outputs = &#x27;exodus console&#x27;
  [../]
  [./loopEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;right&#x27;
  [../]
  [./coreEndTemp]
    type = Receiver
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;sub&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="637e5ad4-fc1d-4b2d-bfa8-d68679552951"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_control.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
  [peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  # nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b95a1cdb-b3ba-423f-89a2-ce8c97c69510"><div class="modal-content"><h4>(problems/rodMatchSerpentWorth/adjustAbsorb/rodded.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 4
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = false
[]

[Mesh]
  file = &#x27;2d_rodded_lattice.msh&#x27;
[]

[Problem]
  coord_type = RZ
  kernel_coverage_check = false
[]

[Variables]
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall cRod_top cRod_bot&#x27;
  create_temperature_var = false
  eigen = true
[]

[Kernels]
  [temp_source_fuel]
    type = FissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
    power = 7.5e6
    tot_fissions = tot_fissions
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;tot_fissions&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = DirichletBC
    variable = temp
    value = ${diri_temp}
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gfuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
  [cRod]
    type = RoddedMaterial
    property_tables_root = &#x27;../../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;cRod&#x27;
    rodDimension = &#x27;y&#x27;
    rodPosition = 23.622
    absorb_factor = 14.22 # how much more absorbing than usual in absorbing region?
  []
  [rho_crod]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;cRod&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_factor_shift_type -pc_factor_shift_amount&#x27;
  petsc_options_value = &#x27;asm lu NONZERO 1e-10&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  execute_on = &#x27;final&#x27;
  file_base = &#x27;out&#x27;
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="db1ba034-56e2-4f14-b47b-85671f50f718"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_restart.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_auto_diff_rho_out.e&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
    scaling = 1e4
  []
  [temp]
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
  init_from_file = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6cabb9f9-ba0a-44dd-83a1-657751149961"><div class="modal-content"><h4>(problems/rodded2D/rodded.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 4
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_rodded_lattice.msh&#x27;
[../]

[Problem]
  coord_type = RZ
  kernel_coverage_check = false
[]

[Variables]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
  [./rodPosition]
    family = SCALAR
    order = FIRST
    initial_condition = 0.0
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall cRod_top cRod_bot&#x27;
  create_temperature_var = false
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[ScalarKernels]
  [./tdRodPos]
    type = ODETimeDerivative
    variable = rodPosition
  [../]
  [./rodposForce]
    type = ParsedODEKernel
    function = &#x27;rodPosition - 100&#x27;
    variable = rodPosition
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gfuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  [./cRod]
    type = RoddedMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;cRod&#x27;
    rodDimension = &#x27;y&#x27;
    rodPosition = rodPosition
    absorb_factor = 1e6 # how much more absorbing than usual in absorbing region?
  [../]
  [./rho_crod]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;cRod&#x27;
  [../]

[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  solve_type = &#x27;PJFNK&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100
  [./TimeStepper]
    type = PostprocessorDT
    postprocessor = limit_k
    dt = 0.1
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    # ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
     type = AverageFissionHeat
     nt_scale = ${nt_scale}
     execute_on = &#x27;linear nonlinear&#x27;
     outputs = &#x27;console&#x27;
     block = &#x27;fuel&#x27;
  [../]
  [./limit_k]
    type = LimitK
    execute_on = &#x27;timestep_end&#x27;
    k_postprocessor = multiplication
    growth_factor = 1.2
    cutback_factor = .4
    k_threshold = 1.5
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  execute_on = &#x27;timestep_end final&#x27;
  file_base = &#x27;out&#x27;
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="ab707a90-b3a3-464e-9ad2-80be890000a1"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_direct.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  #   file = &#x27;3d_msre_29x29_136.msh&#x27;
  file = split_mesh/3d_auto_diff_rho_in.e
  nemesis = true
  skip_partioning = true
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  #   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  #   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly	  1e-3&#x27;
  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9c09473f-48c5-477b-a55b-50906eb57820"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-unit-cell.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = msre_squares.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[AuxVariables]
  [./vel_x]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_y]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_z]
    block = &#x27;fuel&#x27;
  [../]
  [./p]
    block = &#x27;fuel&#x27;
  [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_fuel_transport]
    type = INSTemperature
    u = vel_x
    v = vel_y
    w = vel_z
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    solve_type = PJFNK
    ksp_norm = none
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

[MultiApps]
  [./sub]
    type = FullSolveMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = solution_aux_exodus.i
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Transfers]
  [./vel_x]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_x
    variable = vel_x
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_y]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_y
    variable = vel_y
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_z]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_z
    variable = vel_z
    execute_on = &#x27;initial&#x27;
  [../]
  [./p]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = p
    variable = p
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b3c70c11-5b1f-42f5-9842-b3c743afe11c"><div class="modal-content"><h4>(problems/LOSCA/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  create_temperature_var = false
  scaling = 1e-4
  pre_blocks = &#x27;fuel&#x27;
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
  [../]
  [./temp]
    scaling = 1e-4
    initial_condition = 930
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  loop_precursors = true
  multi_app = loopApp
  is_loopapp = false
  inlet_boundaries = &#x27;fuel_bottoms&#x27;
 [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-5
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="3a40d776-f524-493c-9724-35fa955fa5a9"><div class="modal-content"><h4>(problems/LOSCA/HXFailure/sub.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 0
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  # account_delayed = true
[]

[Mesh]
  file = &#x27;../sub.e&#x27;
[]


[Variables]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
    family = MONOMIAL
    order = CONSTANT
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  outlet_boundaries = &#x27;right&#x27;
  u_def = ${flow_velocity}
  v_def = 0
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
  loop_precursors = true
  multi_app = loopApp
  is_loopapp = true
  inlet_boundaries = left
 [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_source_fuel]
  #   type = TransientFissionHeatSource
  #   variable = temp
  #   nt_scale=${nt_scale}
  # [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  # [./temp_diffusion]
  #   type = MatDiffusion
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
  # [./temp_advection_fuel]
  #   type = ConservativeTemperatureAdvection
  #   velocity = &#x27;${flow_velocity} 0 0&#x27;
  #   variable = temp
  # [../]
[]

[DGKernels]
  [./temp_adv]
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]


[DiracKernels]
  [./heat_exchanger]
    type = DiracHX
    variable = temp
    point = &#x27;250 0 0&#x27;
    power = 4e3
  [../]
[]


[BCs]
  [./fuel_bottoms_looped]
    boundary = &#x27;left&#x27;
    type = PostprocessorTemperatureInflowBC
    postprocessor = coreEndTemp
    variable = temp
    uu = ${flow_velocity}
  [../]
  # [./diri]
  #   boundary = &#x27;left&#x27;
  #   type = DirichletBC
  #   variable = temp
  #   value = 930
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;right&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]

[Functions]
  [./heatRemovalFcn]
    type = ParsedFunction
    value = &#x27;4e3 * ( 1 - tanh( (t-5) ) )&#x27; # start losing cooling at t=5s
  [../]
[]

[Controls]
  [./hxFuncCtrl]
    type = RealFunctionControl
    parameter = &#x27;*/*/power&#x27;
    function = &#x27;heatRemovalFcn&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    outputs = &#x27;exodus console&#x27;
  [../]
  [./loopEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;right&#x27;
  [../]
  [./coreEndTemp]
    type = Receiver
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;sub&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d5d6ec42-40a6-4b72-b76b-076c9d02b485"><div class="modal-content"><h4>(problems/LOSCA/sub.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 0
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  # account_delayed = true
[]

[Mesh]
  type = GeneratedMesh
  dim = 1
  nx = 600
  xmax = 500
  elem_type = EDGE2
[../]

[Variables]
  [./temp]
    initial_condition = 930 #approx steady outlet of other problem
    scaling = 1e-4
    family = MONOMIAL
    order = CONSTANT
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  outlet_boundaries = &#x27;right&#x27;
  u_def = ${flow_velocity}
  v_def = 0
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  loop_precursors = true
  multi_app = loopApp
  is_loopapp = true
  inlet_boundaries = left

 [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_source_fuel]
  #   type = TransientFissionHeatSource
  #   variable = temp
  #   nt_scale=${nt_scale}
  # [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  # [./temp_diffusion]
  #   type = MatDiffusion
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
  # [./temp_advection_fuel]
  #   type = ConservativeTemperatureAdvection
  #   velocity = &#x27;${flow_velocity} 0 0&#x27;
  #   variable = temp
  # [../]
[]

[DGKernels]
  [./temp_adv]
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]


[DiracKernels]
  [./heat_exchanger]
    type = DiracHX
    variable = temp
    power = 4e3 # see controls
    point = &#x27;250 0 0&#x27;
  [../]
[]


[BCs]
  [./fuel_bottoms_looped]
    boundary = &#x27;left&#x27;
    type = PostprocessorTemperatureInflowBC
    postprocessor = coreEndTemp
    variable = temp
    uu = ${flow_velocity}
  [../]
  # [./diri]
  #   boundary = &#x27;left&#x27;
  #   type = DirichletBC
  #   variable = temp
  #   value = 930
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;right&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    outputs = &#x27;exodus console&#x27;
  [../]
  [./loopEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;right&#x27;
  [../]
  [./coreEndTemp]
    type = Receiver
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;sub&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# connect inlet and outlet to multiapp
# [Transfers]
#   [./to_core]
#     type = MultiAppPostprocessorTransfer
#     multi_app = MoltresApp
#     from_postprocessor = loopEndTemp
#     to_postprocessor = inlet_mean_temp
#     direction = to_multiapp
#   [../]
#   [./from_core]
#     type = MultiAppPostprocessorTransfer
#     multi_app = MoltresApp
#     from_postprocessor = coreEndTemp
#     to_postprocessor = coreEndTemp
#     direction = to_multiapp
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="72a5493d-0fa0-4e89-8a1b-1beede47b27e"><div class="modal-content"><h4>(problems/2017_annals_pub_msre_compare/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922
gamma_frac = .075
R = 70.1675
H = 162.56

[GlobalParams]
  num_groups = 4
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  nt_scale = ${nt_scale}
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Variables]
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  create_temperature_var = false
  scaling = 1e-4
  pre_blocks = &#x27;fuel&#x27;
[]

[Kernels]
  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
    gamma = gamma_func
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity_variable = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [temp_diri_cg]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = FlexiblePostprocessorDirichletBC
    postprocessor = coreEndTemp
    offset = -27.8
    variable = temp
  []
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
    gamma = gamma_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [gamma_func]
    type = ParsedFunction
    expression = &#x27;${gamma_frac} * pi^2 / 4 * cos(pi * x / (2. * ${R})) * sin(pi * y / ${H})&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4g_fuel_rod0_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4g_moder_rod0_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [TimeStepper]
    type = PostprocessorDT
    postprocessor = limit_k
    dt = 1e-3
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
  [coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  []
  [limit_k]
    type = LimitK
    execute_on = &#x27;timestep_end&#x27;
    k_postprocessor = multiplication
    growth_factor = 1.2
    cutback_factor = .4
    k_threshold = 1.5
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="53339e59-ec17-4e29-8d7e-6247bcb494e9"><div class="modal-content"><h4>(problems/publication_level_cases/transient_single_channel_blockage/3d_ss.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = msre_vol_frac_29x29_h_136.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    scaling = 1e4
    initial_condition = 1
  [../]
  [./group2]
    scaling = 1e4
    initial_condition = 1
  [../]
  [./temp]
    scaling = 1e-4
    initial_condition = ${ini_temp}
  [../]
[]

[Precursors]
  [./primary_fuel]
    var_name_base = pre
    block = &#x27;fuel blocked_fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops blocked_fuel_top&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    kernel_block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides blocked_fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops blocked_fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel blocked_fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  dtmin = 1e-7
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="005ee43c-861c-40cb-a186-48df2862eb3d"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function.i)</h4><pre style="max-height:350px;"><code class="language-moose"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 33.28
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_func = vel_x_func
  v_func = vel_y_func
  w_func = vel_z_func
  constant_velocity_values = false
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = VelocityFunctionTemperatureAdvection
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [vel_x_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_y_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_z_func]
    type = ParsedFunction
    expression = &#x27;${fuel_velocity_max_inlet} * cos(pi * x / (2 * ${fuel_sq_rad})) * cos(pi * y / (2 * ${fuel_sq_rad}))&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="819cd58c-a346-4f0e-bf15-225f9b75ae4d"><div class="modal-content"><h4>(problems/rodMatchSerpentWorth/rodded.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 4
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = false
[]

[Mesh]
  file = &#x27;2d_rodded_lattice.msh&#x27;
[]

[Problem]
  coord_type = RZ
  kernel_coverage_check = false
[]

[Variables]
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall cRod_top cRod_bot&#x27;
  create_temperature_var = false
  eigen = true
[]

[Kernels]
  [temp_source_fuel]
    type = FissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
    power = 7.5e6
    tot_fissions = tot_fissions
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;tot_fissions&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = DirichletBC
    variable = temp
    value = ${diri_temp}
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gfuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
  [cRod]
    type = RoddedMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;cRod&#x27;
    rodDimension = &#x27;y&#x27;
    rodPosition = 200.0
    absorb_factor = 1e6 # how much more absorbing than usual in absorbing region?
  []
  [rho_crod]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;cRod&#x27;
  []

[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_factor_shift_type -pc_factor_shift_amount&#x27;
  petsc_options_value = &#x27;asm lu NONZERO 1e-10&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  execute_on = &#x27;final&#x27;
  file_base = &#x27;out&#x27;
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6aaddb01-14f0-4884-a8e5-25978353649c"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # uniform_refine = 1
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 100000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    # off_diag_row = &#x27;temp pre1 pre2 pre3 pre4 pre5 pre6 temp pre1 pre2 pre3 pre4 pre5 pre6&#x27;
    # off_diag_column = &#x27;group1 group1 group1 group1 group1 group1 group1 group2 group2 group2 group2 group2 group2 group2&#x27;
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [exodus]
    type = Exodus
    file_base = &#x27;&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []

# [Adaptivity]
#   marker = errorfrac_temp
#   max_h_level = 1
#   [./Indicators]
#     [./error_temp]
#       type = GradientJumpIndicator
#       variable = temp
#       outputs = none
#     [../]
#   [../]
#   [./Markers]
#     [./errorfrac_temp]
#       type = ErrorFractionMarker
#       refine = 0.8
#       coarsen = 0.1
#       indicator = error_temp
#       outputs = none
#     [../]
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6959024f-3c6c-45ab-98ad-2d35b05987de"><div class="modal-content"><h4>(problems/publication_level_cases/transient_single_channel_blockage/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = 3d_ss_out.e
[]

[MeshModifiers]
  # [./scale]
  #   type = Transform
  #   transform = SCALE
  #   vector_value = &#x27;1 1 ${scale}&#x27;
  # [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    scaling = 1e4
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
  [../]
  [./group2]
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
  [./primary_fuel]
    var_name_base = pre
    block = &#x27;fuel blocked_fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    init_from_file = true
    kernel_block = &#x27;fuel&#x27;
  [../]
  [./blocked_fuel]
    var_name_base = pre
    kernel_block = &#x27;blocked_fuel&#x27;
    outlet_boundaries = &#x27;blocked_fuel_top&#x27;
    u_def = 0
    v_def = 0
    w_def = 0
    nt_exp_form = false
    create_vars = false
    object_suffix = blocked
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel blocked_fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 5e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  file_base = temp
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="47ad46a9-6763-45d3-9f54-30b605ed6a5a"><div class="modal-content"><h4>(problems/020617_mod_heat_source_one_minus_beta_fission/gamma_source_check.i)</h4><pre style="max-height:350px;"><code class="language-moose">[Mesh]
  type = GeneratedMesh
  dim = 2
  nx = 10
  ny = 10
[../]


[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = 1
    group_fluxes = &#x27;1 1&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = 1 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
[]

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;0&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = temp
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;1&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = temp
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = ConstantIC
    variable = temp
    value = 824
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;0&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;0&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;0&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="845fe7bf-5752-4662-95b1-c67f9813b9b9"><div class="modal-content"><h4>(problems/021417_MSRE_materials/mini_msre_cg_temp.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
diri_temp=908
nt_scale=1e13
reactor_height=162.56
global_temperature=temp
# global_temperature=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
#   u_def = 0
#   v_def = 0
#   w_def = ${flow_velocity}
[../]

[Mesh]
  file = &#x27;mini_msre_cuboid.msh&#x27;
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  create_temperature_var = true
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = false
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[Materials]
  [./fuel]
    # type = CammiFuel
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_fuel_data_func_of_fuel_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    # type = CammiModerator
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_mod_data_func_of_mod_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;fuel_bottoms moder_bottoms fuel_sides&#x27;
    type = DirichletBC
    variable = temp
    value = ${diri_temp}
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

# [Problem]
#   type = FEProblem
#   coord_type = RZ
# [../]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  print_linear_residuals = true
  perf_graph = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./diri_temp_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
#   # [./average_fission_heat]
#   #   type = AverageFissionHeat
#   #   nt_scale = ${nt_scale}
#   #   execute_on = &#x27;linear nonlinear&#x27;
#   #   outputs = &#x27;csv console&#x27;
#   #   block = &#x27;fuel&#x27;
#   # [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="80de8e27-fbba-4472-97e6-7a0f10c6f01e"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_condition = 1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_condition = 1
  [../]
  [./temp]
    scaling = 1e-4
    initial_condition = 930
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-5
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="389e813f-6101-4999-b3b8-574fa9c3451e"><div class="modal-content"><h4>(problems/060717_dimension_testing/one_group.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 1
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  # coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-6
  [../]
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  scaling = 1
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  # [./temp_diffusion_outlet]
  #   boundary = &#x27;fuel_tops&#x27;
  #   type = DiffusiveFluxBC
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  file_base = &#x27;&#x27;
  [./exodus]
    type = Exodus
  [../]
  [./csv]
    type = CSV
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="293f2adb-d8c8-4b3d-b25b-8ecfb09c9b3c"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function_moderator_heating.i)</h4><pre style="max-height:350px;"><code class="language-moose"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 33.28
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_func = vel_x_func
  v_func = vel_y_func
  w_func = vel_z_func
  constant_velocity_values = false
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = VelocityFunctionTemperatureAdvection
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [vel_x_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_y_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_z_func]
    type = ParsedFunction
    expression = &#x27;${fuel_velocity_max_inlet} * cos(pi * x / (2 * ${fuel_sq_rad})) * cos(pi * y / (2 * ${fuel_sq_rad}))&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 100000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200
  line_search = none

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  []
  [peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="22210b5f-8489-4986-98a6-5734a883226a"><div class="modal-content"><h4>(problems/021417_MSRE_materials/Input.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
diri_temp=908
nt_scale=1e13
reactor_height=162.56
global_temperature=temp
# global_temperature=922
sigma_val=6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
#   u_def = 0
#   v_def = 0
#   w_def = ${flow_velocity}
[../]

[Mesh]
  # file = &#x27;msre_22x22_correct_vol_fraction.msh&#x27;
  file = msre_cuboid_3x3.msh
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;boundary&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  create_temperature_var = true
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = true
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[Materials]
  [./fuel]
    # type = CammiFuel
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_fuel_data_func_of_fuel_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    # type = CammiModerator
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_mod_data_func_of_mod_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;temp_diri_bnd&#x27;
    type = DGFunctionDiffusionDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
    function = &#x27;diri_temp_func&#x27;
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;temp_inflow_bnd&#x27;
    type = TemperatureInflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    inlet_conc = ${diri_temp}
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;temp_outflow_bnd&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

# [Problem]
#   type = FEProblem
#   coord_type = RZ
# [../]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type&#x27; # -ksp_gmres_restart&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly&#x27;      # 31&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  print_linear_residuals = true
  perf_graph = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./diri_temp_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
#   # [./average_fission_heat]
#   #   type = AverageFissionHeat
#   #   nt_scale = ${nt_scale}
#   #   execute_on = &#x27;linear nonlinear&#x27;
#   #   outputs = &#x27;csv console&#x27;
#   #   block = &#x27;fuel&#x27;
#   # [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="f863614e-ebc6-49fc-81fe-3c59527bf46e"><div class="modal-content"><h4>(problems/picard/tmp_nts.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  account_delayed = false
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 3e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = PostprocessorDT
    postprocessor = &#x27;limit_k&#x27;
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./limit_k]
    type = LimitK
    growth_factor = 1.1
    cutback_factor = 0.4
    k_threshold = 1.25
    k_postprocessor = &#x27;multiplication&#x27;
  [../]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="8de8752f-0fbe-419a-abfe-5a64d17058ee"><div class="modal-content"><h4>(problems/LOFA/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose"># take in steady state variable from the other core, and run a pump coastdown transient
# here, flow_velocity is only the initial flow velocity
flow_velocity=21.7 # cm/s. See MSRE-properties.ods
tau = 5 # pump coastdown time constant
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;steady/auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    constant_velocity_values = false
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    u_func = nullFunc
    v_func = coastDownFunc
    w_func = nullFunc
    init_from_file = true
  [../]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]


[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
     type = GammaHeatSource
     variable = temp
     gamma = .0144 # Cammi .0144
     block = &#x27;moder&#x27;
     average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = CtrlConservativeTemperatureAdvection
    u_val = 0
    v_val = ${flow_velocity} # this will be changed in ctrls block
    w_val = 0
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_postpr_inlet]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    variable = temp
    postprocessor = inlet_mean_temp
  [../]
  #[./temp_postpr_inlet]
  #  boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #  type = DirichletBC
  #  variable = temp
  #  value = 922
  #[../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = nullFunc
    vel_y_func = coastDownFunc
    vel_z_func = nullFunc
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nullFunc]
    type = ParsedFunction
    value = &#x27;0&#x27;
  [../]
  [./coastDownFunc]
    type = ParsedFunction
    value = &#x27;${flow_velocity} * exp(-t / ${tau})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  # fuel cp function
  [./cp_fuel]
    type = DerivativeParsedMaterial
    f_name = cp
    function = &#x27;1967 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  # fuel k function
  [./k_fuel]
    type = DerivativeParsedMaterial
    f_name = k
    function = &#x27;0.0553 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  # moder cp fcn
  [./cp_moder]
    type = DerivativeParsedMaterial
    f_name = cp
    function = &#x27;1760 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  # moder k fcn
  [./k_moder]
    type = DerivativeParsedMaterial
    f_name = k
    function = &#x27;.312 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
  nl_abs_tol = 3e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27; #  -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu&#x27; #       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.04
    optimal_iterations = 5
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    # ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
  #multiapp
  [./inlet_mean_temp]
    type = Receiver
    execute_on = &#x27;initial timestep_begin&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Controls]
  [./flowControl]
    type = RealFunctionControl
    parameter = &#x27;*/*/v_val&#x27;
    function = coastDownFunc
    execute_on = &#x27;initial timestep_begin&#x27;
  [../]
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = &#x27;initial timestep_begin&#x27;
    positions = &#x27;100.0 100.0 0.0&#x27;
    input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
 [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="744e8bb8-7dcc-4601-b48f-1294454bbc83"><div class="modal-content"><h4>(problems/2017_annals_pub_msre_compare/4group.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922
gamma_frac = .075
R = 73
H = 162.56

[GlobalParams]
  num_groups = 4
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  nt_scale = ${nt_scale}
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Variables]
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  create_temperature_var = false
  scaling = 1e-4
  pre_blocks = &#x27;fuel&#x27;
[]

[Kernels]
  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
    gamma = gamma_func
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity_variable = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [temp_diri_cg]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = FlexiblePostprocessorDirichletBC
    postprocessor = coreEndTemp
    offset = -27.8
    variable = temp
  []
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
    gamma = gamma_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [gamma_func]
    type = ParsedFunction
    expression = &#x27;${gamma_frac} * pi^2 / 4 * cos(pi * x / (2. * ${R})) * sin(pi * y / ${H})&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4g_fuel_rod0_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4g_moder_rod0_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [TimeStepper]
    type = PostprocessorDT
    postprocessor = limit_k
    dt = 1e-3
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
  [coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  []
  [limit_k]
    type = LimitK
    execute_on = &#x27;timestep_end&#x27;
    k_postprocessor = multiplication
    growth_factor = 1.2
    cutback_factor = .4
    k_threshold = 1.5
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="3f5d549d-c425-4d64-92cd-023b0149aaa9"><div class="modal-content"><h4>(problems/picard/temp_no_pres.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./temp]
    initial_condition = ${ini_temp}
  [../]
[]

[AuxVariables]
  [./group1]
  [../]
  [./group2]
  [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 10
  l_max_its = 100
  dtmin = 1e-3

  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 6
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console csv&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console csv&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
  csv = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="636836c0-ad58-44cc-b5e1-99ac47f131aa"><div class="modal-content"><h4>(problems/picard/temp.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./temp]
    initial_condition = ${ini_temp}
  [../]
[]

[AuxVariables]
  [./group1]
  [../]
  [./group2]
  [../]
  [./pre1]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre2]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre3]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre4]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre5]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre6]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./pres]
    type = TransientMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = &#x27;pres.i&#x27;
  [../]
[]

[Transfers]
  [./temp_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = temp
    variable = temp
  [../]
  [./pre1_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre1
    variable = pre1
  [../]
  [./pre2_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre2
    variable = pre2
  [../]
  [./pre3_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre3
    variable = pre3
  [../]
  [./pre4_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre4
    variable = pre4
  [../]
  [./pre5_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre5
    variable = pre5
  [../]
  [./pre6_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre6
    variable = pre6
  [../]
  [./group1_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = group1
    variable = group1
  [../]
  [./group2_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = group2
    variable = group2
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#5dfacaaa-4914-4c69-88ec-1d15b49a6b5e" class="tooltipped" data-position="left" data-tooltip="Overview">Overview</a></li><li><a href="#db994bff-8431-409c-b38d-e1ab4e117f04" class="tooltipped" data-position="left" data-tooltip="Example Input File Syntax">Example Input File Syntax</a></li><li><a href="#d7ab037f-21ec-4580-993a-add10b233589" class="tooltipped" data-position="left" data-tooltip="Input Parameters">Input Parameters</a></li><li><a href="#6e9a9443-ffb2-4bcf-aa8d-e957815e05ed" class="tooltipped" data-position="left" data-tooltip="Input Files">Input Files</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>