<!DOCTYPE html><head><meta charset="UTF-8"><title>NtTimeDerivative | Moltres</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/moltres.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../contrib/katex/katex.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Moltres</a><a href="https://github.com/arfc/moltres" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="94e14c6f-f598-4fe4-bbc7-703799d7b58f" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="9eb760d8-54d0-4d5a-a9d5-4e4ef8ce02ed" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="3938a49d-56e5-40ea-8ed4-51707e1abc31" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#" class="sidenav-trigger" data-target="b09245e2-e76f-4a34-ab13-36c369bfc554"><i class="material-icons">menu</i></a><ul class="sidenav" id="b09245e2-e76f-4a34-ab13-36c369bfc554"><li><a href="#!" class="dropdown-trigger" data-target="261f6d03-5a96-42bf-8f5d-235082b06878" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="be103392-8e3e-45d9-9ca3-40ce40c3abea" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="8ab1378a-adb4-4f61-8cef-65f9422952ff" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="94e14c6f-f598-4fe4-bbc7-703799d7b58f"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/theory.html">Theory</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="9eb760d8-54d0-4d5a-a9d5-4e4ef8ce02ed"><li><a href="../../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="3938a49d-56e5-40ea-8ed4-51707e1abc31"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul><ul class="dropdown-content" id="261f6d03-5a96-42bf-8f5d-235082b06878"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/theory.html">Theory</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="be103392-8e3e-45d9-9ca3-40ce40c3abea"><li><a href="../../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="8ab1378a-adb4-4f61-8cef-65f9422952ff"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><span class="breadcrumb">source</span><span class="breadcrumb">kernels</span><a href="#" class="breadcrumb">NtTimeDerivative</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="88f80d14-095c-49c2-832b-16e35b866b51" data-section-level="1" data-section-text="NtTimeDerivative"><h1 id="nttimederivative">NtTimeDerivative</h1><p></p><section class="scrollspy" id="f0640bb3-6691-4522-ba32-fd3c404566ba" data-section-level="2" data-section-text="Overview"><h2 id="overview">Overview</h2><p>This object adds the <span class="moose-katex-inline-equation" id="moose-equation-fabb94d0-ac9b-48f8-8988-2c2bff2cab1b"><script>var element = document.getElementById("moose-equation-fabb94d0-ac9b-48f8-8988-2c2bff2cab1b");katex.render("\\frac{1}{v_g}\\frac{\\partial \\phi_g}{\\partial t}", element, {displayMode:false,throwOnError:false});</script></span> time derivative term of the multigroup neutron diffusion equations.</p></section><section class="scrollspy" id="af240f2a-169d-4389-910d-9f1e3e29bd72" data-section-level="2" data-section-text="Example Input File Syntax"><h2 id="example-input-file-syntax">Example Input File Syntax</h2><p></p></section><section class="scrollspy" id="a95ff443-f85a-489e-b0fc-4c25c88793ee" data-section-level="2" data-section-text="Input Parameters"><h2 id="input-parameters">Input Parameters</h2><section id="72ade74f-f9d7-460d-abe5-a86689b7ee56" data-section-level="3" data-section-text="Required Parameters" data-details-open="open"><details class="moose-section-content" open="open"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">group_number</span><span class="moose-parameter-header-description">The group for which this kernel controls diffusion</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The group for which this kernel controls diffusion</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">variable</span><span class="moose-parameter-header-description">The name of the variable that this residual object operates on</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>NonlinearVariableName</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of the variable that this residual object operates on</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Required Parameters</h3></summary></details></section><section id="d9faed76-eaf0-4cac-8b94-c13fe00ec7bd" data-section-level="3" data-section-text="Optional Parameters" data-details-open="open"><details class="moose-section-content" open="open"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">block</span><span class="moose-parameter-header-description">The list of blocks (ids or names) that this object will be applied</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;SubdomainName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The list of blocks (ids or names) that this object will be applied</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">conc_scaling</span><span class="moose-parameter-header-default">1</span><span class="moose-parameter-header-description">The amount by which to scale the concentration variable.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>1</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The amount by which to scale the concentration variable.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">displacements</span><span class="moose-parameter-header-description">The displacements</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;VariableName&gt;</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The displacements</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">lumping</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">True for mass matrix lumping, false otherwise</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>True for mass matrix lumping, false otherwise</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">matrix_only</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether this object is only doing assembly to matrices (no vectors)</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether this object is only doing assembly to matrices (no vectors)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">temperature</span><span class="moose-parameter-header-description">The temperature used to interpolate the diffusion coefficient</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;VariableName&gt;</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The temperature used to interpolate the diffusion coefficient</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">use_exp_form</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether concentrations should be in an expotential/logarithmic format.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether concentrations should be in an expotential/logarithmic format.</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Optional Parameters</h3></summary></details></section><section id="6384658b-6172-4001-b191-16da18b77e3f" data-section-level="3" data-section-text="Contribution To Tagged Field Data Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">absolute_value_vector_tags</span><span class="moose-parameter-header-description">The tags for the vectors this residual object should fill with the absolute value of the residual contribution</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tags for the vectors this residual object should fill with the absolute value of the residual contribution</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">extra_matrix_tags</span><span class="moose-parameter-header-description">The extra tags for the matrices this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The extra tags for the matrices this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">extra_vector_tags</span><span class="moose-parameter-header-description">The extra tags for the vectors this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The extra tags for the vectors this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">matrix_tags</span><span class="moose-parameter-header-default">system time</span><span class="moose-parameter-header-description">The tag for the matrices this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>system time</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MultiMooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nontime, system, time</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tag for the matrices this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">vector_tags</span><span class="moose-parameter-header-default">time</span><span class="moose-parameter-header-description">The tag for the vectors this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>time</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MultiMooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nontime, time</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tag for the vectors this Kernel should fill</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Contribution To Tagged Field Data Parameters</h3></summary></details></section><section id="68d40041-3317-4033-8881-c043b28deffc" data-section-level="3" data-section-text="Advanced Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">control_tags</span><span class="moose-parameter-header-description">Adds user-defined labels for accessing object parameters via control logic.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;std::string&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Adds user-defined labels for accessing object parameters via control logic.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">diag_save_in</span><span class="moose-parameter-header-description">The name of auxiliary variables to save this Kernel's diagonal Jacobian contributions to. Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;AuxVariableName&gt;</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of auxiliary variables to save this Kernel's diagonal Jacobian contributions to. Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">enable</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Set the enabled status of the MooseObject.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>Yes</p><p class="moose-parameter-description"><span>Description:</span>Set the enabled status of the MooseObject.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">implicit</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Determines whether this object is calculated using an implicit or explicit form</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Determines whether this object is calculated using an implicit or explicit form</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">save_in</span><span class="moose-parameter-header-description">The name of auxiliary variables to save this Kernel's residual contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;AuxVariableName&gt;</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of auxiliary variables to save this Kernel's residual contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">search_method</span><span class="moose-parameter-header-default">nearest_node_connected_sides</span><span class="moose-parameter-header-description">Choice of search algorithm.  All options begin by finding the nearest node in the primary boundary to a query point in the secondary boundary.  In the default nearest_node_connected_sides algorithm, primary boundary elements are searched iff that nearest node is one of their nodes.  This is fast to determine via a pregenerated node-to-elem map and is robust on conforming meshes.  In the optional all_proximate_sides algorithm, primary boundary elements are searched iff they touch that nearest node, even if they are not topologically connected to it.  This is more CPU-intensive but is necessary for robustness on any boundary surfaces which has disconnections (such as Flex IGA meshes) or non-conformity (such as hanging nodes in adaptively h-refined meshes).</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>nearest_node_connected_sides</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nearest_node_connected_sides, all_proximate_sides</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Choice of search algorithm.  All options begin by finding the nearest node in the primary boundary to a query point in the secondary boundary.  In the default nearest_node_connected_sides algorithm, primary boundary elements are searched iff that nearest node is one of their nodes.  This is fast to determine via a pregenerated node-to-elem map and is robust on conforming meshes.  In the optional all_proximate_sides algorithm, primary boundary elements are searched iff they touch that nearest node, even if they are not topologically connected to it.  This is more CPU-intensive but is necessary for robustness on any boundary surfaces which has disconnections (such as Flex IGA meshes) or non-conformity (such as hanging nodes in adaptively h-refined meshes).</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">seed</span><span class="moose-parameter-header-default">0</span><span class="moose-parameter-header-description">The seed for the master random number generator</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>0</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The seed for the master random number generator</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">use_displaced_mesh</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether or not this object should use the displaced mesh for computation. Note that in the case this is true but no displacements are provided in the Mesh block the undisplaced mesh will still be used.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether or not this object should use the displaced mesh for computation. Note that in the case this is true but no displacements are provided in the Mesh block the undisplaced mesh will still be used.</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Advanced Parameters</h3></summary></details></section><section id="84e06a8d-3276-491e-8698-28c190fcbbe1" data-section-level="3" data-section-text="Material Property Retrieval Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">prop_getter_suffix</span><span class="moose-parameter-header-description">An optional suffix parameter that can be appended to any attempt to retrieve/get material properties. The suffix will be prepended with a '_' character.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MaterialPropertyName</p><p class="moose-parameter-description-doc-unit"><span>Unit:</span>(no unit assumed)</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>An optional suffix parameter that can be appended to any attempt to retrieve/get material properties. The suffix will be prepended with a '_' character.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">use_interpolated_state</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">For the old and older state use projected material properties interpolated at the quadrature points. To set up projection use the ProjectedStatefulMaterialStorageAction.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>For the old and older state use projected material properties interpolated at the quadrature points. To set up projection use the ProjectedStatefulMaterialStorageAction.</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Material Property Retrieval Parameters</h3></summary></details></section></section><section class="scrollspy" id="10f5b447-3601-4c0e-bd4d-155dcf5f4973" data-section-level="2" data-section-text="Input Files"><h2 id="input-files">Input Files</h2><ul class="moose-list-inputs browser-default"><li><a class="moose-source-filename tooltipped modal-trigger" href="#6ebe3334-1222-4609-b0fd-f733d20c930a">(problems/publication_level_cases/gamma_heating_3d_ss/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#8832d190-b398-47c4-b1c3-9ed67564e94e">(problems/033117_nts_temp_pre_parsed_mat/2d_axi_function_cross_sections.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#33a76d04-4258-4427-81bc-e644e9971a7b">(problems/picard/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#da6b3d39-046a-4068-85e1-e7825d76d7d1">(problems/nts-temp-delayed.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#1032b7a9-d1d4-4e44-a816-fc2f8a3f52f1">(tutorial/transient/transient.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#db0f3bde-35a2-42d7-92e8-fc405a5691cf">(problems/022317_test_critical_neutronics_only_reactor/transient-msre-file-mesh-two-grp-two-b1-mat.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e86f4754-9d36-467f-8d3c-1094fd59018b">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_monotone_interp.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#aee986f4-9ba7-4773-975f-42bd3ed25a67">(tests/coupled/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#91870f4e-4149-4ae8-8213-baff4a34aca8">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#bd2c616c-6315-4738-8b1d-af2b9c34202d">(problems/033117_nts_temp_pre_parsed_mat/3d_nts_only.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#f1b78e29-48b9-4d09-9adf-5781a68f19d2">(problems/LOSCA/HXFailure/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#f7a05bd3-f092-4ec4-99c2-a1c55111c921">(problems/publication_level_cases/3d_steady_state/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#d97752f4-d1fb-4100-b105-4a338a06fa74">(problems/LOFA/steady/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#f1468e62-8420-40b8-b790-86b849cc0d39">(problems/072017_dg_temperature/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#4b598cd0-e193-47ae-8ca5-3cbc58c676cc">(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-channel-msre-dimensions.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e4709f58-263e-4650-996a-f18948ce02e9">(problems/single_msre_channel_velocity_heat_nts/unit-cell-heat-and-nts.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#632e0910-03d5-4f5f-9f78-a95cd0c3736f">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive_PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#c7fe33fc-7cd3-4a19-a9b3-5b1ffc567d35">(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-scale-two-mat-inverted-file-msh.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#3ff43dff-46ed-4d13-ad50-fa7a60e5aaac">(problems/060717_dimension_testing/test_case.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#8ea5d584-5ea0-4e54-93b9-d59161bd951d">(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-mod-heat-PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#00b682cc-b92b-4157-885d-7412fd55a846">(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b5eb2f76-c15d-415a-98ae-2c1d4322fd37">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#aa4b1887-f06d-4de4-a6b3-3f1218429373">(problems/constant_inlet_outlet_temp_no_heat_flux_at_walls/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6aa7b7a1-23a6-4725-82aa-0ae33a2d4a45">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#d0b0007c-324c-4495-ad33-f0589808b629">(problems/060717_dimension_testing/one_group_nts_only.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b5329403-ee01-4e55-b334-e788ae578b3f">(problems/publication_level_cases/LOSCA/HXFail/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9b3c05a2-4cf2-4f55-8ba2-d0661da8f373">(problems/single_msre_channel_velocity_heat_nts/nts-eigenvalue-msre-channel-dimensions.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#be3455c9-ccf5-4adb-95bc-969d29504e23">(problems/publication_level_cases/dilute_absorber_controlled_by_peak_power_density/in.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6252717b-a0c6-4a5b-b0ea-36a79f36ec29">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_control.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e8ebe5d2-4151-4f62-bf1a-3f39c67021e0">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_restart.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#268d24da-1064-44b0-ba2d-8b41864f7d12">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_direct.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e88bc1d2-d77e-4c24-8758-59b3c13910cf">(problems/033117_nts_temp_pre_parsed_mat/controlled_neutronics_only.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#fd66eceb-88fe-485b-9acf-49b221ed5282">(problems/transient-jac-test.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#8456886f-ea8b-487e-b72c-25728a2c40d2">(problems/picard/nts_no_pres.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e191a5f7-a4ee-4acf-897c-b41411cff456">(problems/transient-axi-nts-temp-delayed.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#090b9769-4251-4979-b231-ec0ec6c2a21a">(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-unit-cell.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#eeadeedd-8234-492d-8c5b-9c9f0c04e7be">(problems/picard/nts.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#8c389d0b-e1f8-43da-b0c9-cdc2ad6d7b19">(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9c6858b9-c118-457c-8eaf-f03eb14c2925">(problems/publication_level_cases/transient_single_channel_blockage/3d_ss.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#7907fe24-2894-4cd4-b287-cbd7b73b0913">(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b893026e-997f-4f19-a082-a9e42bf20c8c">(tests/coupled/auto_diff_rho_serpent.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b960d5eb-6560-404b-b670-f74a912fe9e3">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#d978ea73-51b3-4fed-9f85-96ef3a9dde20">(problems/publication_level_cases/transient_single_channel_blockage/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#2ab4bdb8-cfcb-444a-b9fc-80a46b9ccbcf">(problems/publication_level_cases/LOSCA/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e1442bf4-23a7-4dc7-8225-0368a85c91d1">(problems/debug-precursor-action.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#5bc62a40-a634-475d-8585-0981f231b7b4">(problems/060717_dimension_testing/one_group.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#c0f11832-e310-4658-9b73-c08befe5430e">(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function_moderator_heating.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#5d20370f-7317-43f4-9f11-b6c4b8778784">(problems/picard/tmp_nts.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9bc185f3-dba8-4022-aed5-8b18c62de403">(problems/LOFA/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9782c7b0-8627-4390-8b72-132acd1132e0">(problems/axi-nts-temp-delayed.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#124f45fb-ce81-4ebf-8a61-71cd88c3c19f">(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-b1-two-mat.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#55fb9c74-d817-4ef1-b1fc-6e4e8f4a285f">(problems/single_msre_channel_velocity_heat_nts/unit-cell-nts-eigenvalue.i)</a></li></ul></section></section><div class="moose-modal modal" id="6ebe3334-1222-4609-b0fd-f733d20c930a"><div class="modal-content"><h4>(problems/publication_level_cases/gamma_heating_3d_ss/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
  [./group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  [../]
  [./group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="8832d190-b398-47c4-b1c3-9ed67564e94e"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/2d_axi_function_cross_sections.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[]

[MeshModifiers]
  [scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 1&#x27;
  []
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
  #  petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
    execute_on = &#x27;timestep_end final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="33a76d04-4258-4427-81bc-e644e9971a7b"><div class="modal-content"><h4>(problems/picard/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="da6b3d39-046a-4068-85e1-e7825d76d7d1"><div class="modal-content"><h4>(problems/nts-temp-delayed.i)</h4><pre style="max-height:350px;"><code class="language-moose">[GlobalParams]
  num_groups = 2
  # temperature = temp
  group_fluxes = &#x27;group1 group2&#x27;
  # MSRE full power = 10 MW; core volume 90 ft3
  # power = 20
[]

[Mesh]
  file = &#x27;cylinder.msh&#x27;
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
  # [./temp]
  #   order = FIRST
  #   family = LAGRANGE
  #   # scaling = 1e-3
  # [../]
[]

[Kernels]
  # Neutronics
  # [./time_group1]
  #   type = NtTimeDerivative
  #   grou_number = 1
  #   variable = group1
  # [../]
  # [./time_group2]
  #   type = NtTimeDerivative
  #   grou_number = 2
  #   variable = group2
  # [../]
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  # [./fission_source_group1]
  #   type = CoupledFissionKernel
  #   variable = group1
  #   group_number = 1
  #   num_groups = 2
  #   group_fluxes = &#x27;group1 group2&#x27;
  # [../]
  # [./fission_source_group2]
  #   type = CoupledFissionKernel
  #   variable = group2
  #   group_number = 2
  #   num_groups = 2
  #   group_fluxes = &#x27;group1 group2&#x27;
  # [../]

  # # Temperature
  # [./temp_cond]
  #   type = MatDiffusion
  #   variable = temp
  #   prop_name = &#x27;k&#x27;
  #   save_in = &#x27;diffus_resid tot_resid&#x27;
  # [../]
  # [./temp_source]
  #   type = FissionHeatSource
  #   tot_fissions = tot_fissions
  #   variable = temp
  #   save_in = &#x27;src_resid tot_resid&#x27;
  # [../]
[]

[AuxVariables]
  # [./Qf]
  #   family = MONOMIAL
  #   order = CONSTANT
  # [../]
  # [./diffus_temp]
  #   family = MONOMIAL
  #   order = CONSTANT
  # [../]
  # [./diffus_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
  # [./src_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
  # [./bc_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
  # [./tot_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
[]

[AuxKernels]
  # [./Qf]
  #   type = FissionHeatSourceAux
  #   variable = Qf
  #   tot_fissions = tot_fissions
  # [../]
  # [./diffus_temp]
  #   type = MatDiffusionAux
  #   variable = diffus_temp
  #   diffuse_var = temp
  #   prop_name = &#x27;k&#x27;
  # [../]
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;msr2g_enrU_mod_953_fuel_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k&#x27;
    prop_values = &#x27;.0123&#x27; # Cammi 2011 at 908 K
    # prop_names = &#x27;k d_k_d_temp&#x27;
    # prop_values = &#x27;.0123 0&#x27; # Cammi 2011 at 908 K
  []
  [moder]
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;msr2g_enrU_fuel_922_mod_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k&#x27;
    prop_values = &#x27;.312&#x27; # Cammi 2011 at 908 K
    # prop_names = &#x27;k d_k_d_temp&#x27;
    # prop_values = &#x27;.312 0&#x27; # Cammi 2011 at 908 K
  []
[]

[BCs]
  # [./temp]
  #   boundary = boundary
  #   type = DirichletBC
  #   variable = temp
  #   value = 900
  #   save_in = &#x27;bc_resid tot_resid&#x27;
  # [../]
  [group1_vacuum]
    type = VacuumBC
    variable = group1
    boundary = &#x27;all_top all_bottom&#x27;
  []
  [group2_vacuum]
    type = VacuumBC
    variable = group2
    boundary = &#x27;all_top all_bottom&#x27;
  []
[]

[Executioner]
  # type = NonlinearEigen
  # free_power_iterations = 2
  # source_abs_tol = 1e-12
  # source_rel_tol = 1e-8
  # output_after_power_iterations = false

  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 2
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    group_fluxes = &#x27;group1 group2&#x27;
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = ConstantIC
#     variable = temp
#     value = 900
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="1032b7a9-d1d4-4e44-a816-fc2f8a3f52f1"><div class="modal-content"><h4>(tutorial/transient/transient.i)</h4><pre style="max-height:350px;"><code class="language-moose">[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  temperature = temp
  sss2_input = true
  account_delayed = true
[]

[Mesh]
  coord_type = RZ
  [mesh]
    type = FileMeshGenerator
    file = &#x27;../eigenvalue/mesh.e&#x27;
  []
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
  [temp]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1000
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    family = MONOMIAL
    order = CONSTANT
    block = 0
    outlet_boundaries = &#x27;fuel_top&#x27;
    velocity_type = constant
    u_def = 0
    v_def = 18.085
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    transient = true
  []
[]

[Kernels]
  #---------------------------------------------------------------------
  # Group 1 Neutronics
  #---------------------------------------------------------------------
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;0&#x27;
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;0&#x27;
    group_number = 1
  []

  #---------------------------------------------------------------------
  # Group 2 Neutronics
  #---------------------------------------------------------------------
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;0&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  #---------------------------------------------------------------------
  # Temperature
  #---------------------------------------------------------------------
  [temp_time_derivative]
    type = INSTemperatureTimeDerivative
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    variable = temp
    velocity_variable = &#x27;0 18.085 0&#x27;
    block = &#x27;0&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    variable = temp
    diffusivity = &#x27;k&#x27;
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;0&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top mod_bottom mod_top right&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top mod_bottom mod_top right&#x27;
    variable = group2
  []
  [temp_inlet_bc]
    type = FunctionDirichletBC
    variable = temp
    boundary = &#x27;fuel_bottom mod_bottom right&#x27;
    function = &#x27;temp_bc_func&#x27;
  []
  [temp_outlet_bc]
    type = TemperatureOutflowBC
    variable = temp
    boundary = &#x27;fuel_top&#x27;
    velocity = &#x27;0 18.085 0&#x27;
  []
[]

[ICs]
  [group1_ic]
    type = FunctionIC
    variable = group1
    function = ic_func
  []
  [group2_ic]
    type = FunctionIC
    variable = group2
    function = ic_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;1000 - (1000-965) * tanh(t/1)&#x27;
  []
  [dt_func]
    type = ParsedFunction
    expression = &#x27;if(t&lt;50, if(t&lt;30, .4, 5), 10)&#x27;
  []
  [ic_func]
    type = ParsedFunction
    expression = &#x27;1e5 * (-x^2+70^2) * (-y * (y-150))&#x27;
  []
[]

[Materials]
  [fuel]
    type = MoltresJsonMaterial
    block = &#x27;0&#x27;
    base_file = &#x27;../eigenvalue/xsdata.json&#x27;
    material_key = &#x27;fuel&#x27;
    interp_type = LINEAR
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27;
  []
  [graphite]
    type = MoltresJsonMaterial
    block = &#x27;1&#x27;
    base_file = &#x27;../eigenvalue/xsdata.json&#x27;
    material_key = &#x27;graphite&#x27;
    interp_type = LINEAR
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.86e-3 .312 1760&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 200

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-1

  automatic_scaling = true
  compute_scaling_once = false
  resid_vs_jac_scaling_param = 0.1
  scaling_group_variables = &#x27;group1 group2; pre1 pre2 pre3 pre4 pre5 pre6; temp&#x27;

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu       NONZERO               superlu_dist&#x27;

  line_search = none

  dtmin = 1e-3
  dtmax = 10
  [TimeStepper]
    type = FunctionDT
    function = dt_func
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [powernorm]
    type = ElmIntegTotFissHeatPostprocessor
    execute_on = linear
  []
  [average_temp]
    type = ElementAverageValue
    variable = temp
    execute_on = linear
  []
  [inlet_temp]
    type = SideAverageValue
    variable = temp
    boundary = fuel_bottom
  []
  [outlet_temp]
    type = SideAverageValue
    variable = temp
    boundary = fuel_top
  []
[]

[VectorPostprocessors]
  [centerline_flux]
    type = LineValueSampler
    variable = &#x27;group1 group2&#x27;
    start_point = &#x27;0 0 0&#x27;
    end_point = &#x27;0 150 0&#x27;
    num_points = 151
    sort_by = y
    execute_on = FINAL
  []
  [midplane_flux]
    type = LineValueSampler
    variable = &#x27;group1 group2&#x27;
    start_point = &#x27;0 75 0&#x27;
    end_point = &#x27;69.375 75 0&#x27;
    num_points = 100
    sort_by = x
    execute_on = FINAL
  []
[]

[Outputs]
  perf_graph = true
  [exodus]
    type = Exodus
  []
  [csv]
    type = CSV
    execute_on = FINAL
  []
[]

[Debug]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="db0f3bde-35a2-42d7-92e8-fc405a5691cf"><div class="modal-content"><h4>(problems/022317_test_critical_neutronics_only_reactor/transient-msre-file-mesh-two-grp-two-b1-mat.i)</h4><pre style="max-height:350px;"><code class="language-moose">global_temperature = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = true
[]

[Mesh]
  # file = &#x27;msre_23x23.msh&#x27;
  file = &#x27;msre_cuboid_3x3.msh&#x27;
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_fuel_&#x27;
    interp_type = &#x27;none&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_moder_&#x27;
    interp_type = &#x27;none&#x27;
    temperature = ${global_temperature}
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  num_steps = 100

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor -snes_test_display&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    outputs = &#x27;console csv&#x27;
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    outputs = &#x27;console csv&#x27;
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    outputs = &#x27;console csv&#x27;
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    outputs = &#x27;console csv&#x27;
  []
[]

[Outputs]
  perf_graph = true
  [out]
    type = Exodus
  []
  [csv]
    type = CSV
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e86f4754-9d36-467f-8d3c-1094fd59018b"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_monotone_interp.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="aee986f4-9ba7-4773-975f-42bd3ed25a67"><div class="modal-content"><h4>(tests/coupled/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
ini_temp = 922
diri_temp = 922
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
  []
[]

[Kernels]
  #---------------------------------------------------------------------
  # Group 1 Neutronics
  #---------------------------------------------------------------------
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  []

  #---------------------------------------------------------------------
  # Group 2 Neutronics
  #---------------------------------------------------------------------
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  #---------------------------------------------------------------------
  # Temperature
  #---------------------------------------------------------------------
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  num_steps = 80

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100
  steady_state_detection = true
  steady_state_tolerance = 1e-10

  dtmin = 1e-5
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 5
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="91870f4e-4149-4ae8-8213-baff4a34aca8"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin.i)</h4><pre style="max-height:350px;"><code class="language-moose"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 39.94
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="bd2c616c-6315-4738-8b1d-af2b9c34202d"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_nts_only.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
  []
  [group2]
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="f1b78e29-48b9-4d09-9adf-5781a68f19d2"><div class="modal-content"><h4>(problems/LOSCA/HXFailure/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
  loop_precursors = true
  multi_app = loopApp
  is_loopapp = false
  inlet_boundaries = &#x27;fuel_bottoms&#x27;
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-pc_type&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="f7a05bd3-f092-4ec4-99c2-a1c55111c921"><div class="modal-content"><h4>(problems/publication_level_cases/3d_steady_state/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
  [./group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  [../]
  [./group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d97752f4-d1fb-4100-b105-4a338a06fa74"><div class="modal-content"><h4>(problems/LOFA/steady/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose"># walk the reactor into steady state with an attached primary loop

flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../2d_lattice_structured.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[PrecursorKernel]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_postpr_inlet]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    variable = temp
    postprocessor = inlet_mean_temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

#[Materials]
#  [./fuel]
#    type = GenericMoltresMaterial
#    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
#    interp_type = &#x27;spline&#x27;
#    block = &#x27;fuel&#x27;
#  [../]
#  [./rho_fuel]
#    type = DerivativeParsedMaterial
#    f_name = rho
#    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  # fuel cp function
#  [./cp_fuel]
#    type = DerivativeParsedMaterial
#    f_name = cp
#    function = &#x27;1967 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  # fuel k function
#  [./k_fuel]
#    type = DerivativeParsedMaterial
#    f_name = k
#    function = &#x27;0.0553 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  [./moder]
#    type = GenericMoltresMaterial
#    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
#    interp_type = &#x27;spline&#x27;
#    block = &#x27;moder&#x27;
#  [../]
#  [./rho_moder]
#    type = DerivativeParsedMaterial
#    f_name = rho
#    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#  # moder cp fcn
#  [./cp_moder]
#    type = DerivativeParsedMaterial
#    f_name = cp
#    function = &#x27;1760 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#  # moder k fcn
#  [./k_moder]
#    type = DerivativeParsedMaterial
#    f_name = k
#    function = &#x27;.312 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#[]
[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 100

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  dtmax = 100
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  #multiapp
  [./inlet_mean_temp]
    type = Receiver
    execute_on = &#x27;timestep_begin&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = &#x27;initial timestep_begin&#x27;
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = average
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="f1468e62-8420-40b8-b790-86b849cc0d39"><div class="modal-content"><h4>(problems/072017_dg_temperature/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
sigma_val=.6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
    order = FIRST
    family = MONOMIAL
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    type = DGDiffusionPostprocessorDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diffusivity = &#x27;k&#x27;
    postprocessor = coreEndTemp
    offset = -50
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    type = PostprocessorTemperatureInflowBC
    variable = temp
    uu = 0
    vv = ${flow_velocity}
    ww = 0
    postprocessor = coreEndTemp
    offset = -50
  [../]
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  [../]
[]

[VectorPostprocessors]
  [./outlet_temps]
    type = LineValueSampler
    start_point = &#x27;0 153 0&#x27;
    end_point = &#x27;72.5 153 0&#x27;
    num_points = 1000
    variable = temp
    sort_by = &#x27;x&#x27;
    outputs = &#x27;csv&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./csv]
    type = CSV
    execute_on = &#x27;final&#x27;
  [../]
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="4b598cd0-e193-47ae-8ca5-3cbc58c676cc"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-channel-msre-dimensions.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = single_channel_msre_dimensions.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[AuxVariables]
  [./vel_x]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_y]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_z]
    block = &#x27;fuel&#x27;
  [../]
  [./p]
    block = &#x27;fuel&#x27;
  [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_fuel_transport]
    type = INSTemperature
    u = vel_x
    v = vel_y
    w = vel_z
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    solve_type = PJFNK
    ksp_norm = none
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

[MultiApps]
  [./sub]
    type = FullSolveMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = solution_aux_exodus.i
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Transfers]
  [./vel_x]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_x
    variable = vel_x
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_y]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_y
    variable = vel_y
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_z]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_z
    variable = vel_z
    execute_on = &#x27;initial&#x27;
  [../]
  [./p]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = p
    variable = p
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e4709f58-263e-4650-996a-f18948ce02e9"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/unit-cell-heat-and-nts.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = msre_squares.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    scaling = 1e2
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    scaling = 1e2
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
    scaling = 1e-4
    # initial_condition = 900
  [../]
[]

[AuxVariables]
  # [./vel_x]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./vel_y]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./vel_z]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./p]
  #   block = &#x27;fuel&#x27;
  # [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_fuel_transport]
  #   type = INSTemperature
  #   u = vel_x
  #   v = vel_y
  #   w = vel_z
  #   variable = temp
  #   block = &#x27;fuel&#x27;
  # [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 21.73&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    # block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 21.73&#x27;
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;linear&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-2
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;linear&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    ksp_norm = &#x27;none&#x27;
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # line_search = &#x27;none&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-5
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

# [MultiApps]
#   [./sub]
#     type = FullSolveMultiApp
#     app_type = MoltresApp
#     positions = &#x27;0 0 0&#x27;
#     input_files = solution_aux_exodus.i
#     execute_on = &#x27;initial&#x27;
#   [../]
# []

# [Transfers]
#   [./vel_x]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_x
#     variable = vel_x
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./vel_y]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_y
#     variable = vel_y
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./vel_z]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_z
#     variable = vel_z
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./p]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = p
#     variable = p
#     execute_on = &#x27;initial&#x27;
#   [../]
# []

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    # outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    # outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="632e0910-03d5-4f5f-9f78-a95cd0c3736f"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive_PJFNK.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # uniform_refine = 1
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    # off_diag_row = &#x27;temp pre1 pre2 pre3 pre4 pre5 pre6 temp pre1 pre2 pre3 pre4 pre5 pre6&#x27;
    # off_diag_column = &#x27;group1 group1 group1 group1 group1 group1 group1 group2 group2 group2 group2 group2 group2 group2&#x27;
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []

# [Adaptivity]
#   marker = errorfrac_temp
#   max_h_level = 1
#   [./Indicators]
#     [./error_temp]
#       type = GradientJumpIndicator
#       variable = temp
#       outputs = none
#     [../]
#   [../]
#   [./Markers]
#     [./errorfrac_temp]
#       type = ErrorFractionMarker
#       refine = 0.8
#       coarsen = 0.1
#       indicator = error_temp
#       outputs = none
#     [../]
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="c7fe33fc-7cd3-4a19-a9b3-5b1ffc567d35"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-scale-two-mat-inverted-file-msh.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=1022
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;inverted_29x29_h_133.msh&#x27;
  # file = &#x27;inverted_3x3_h_15.msh&#x27;
[../]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="3ff43dff-46ed-4d13-ad50-fa7a60e5aaac"><div class="modal-content"><h4>(problems/060717_dimension_testing/test_case.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=1
nt_scale = ${/ 1E0 1.6E-13}
ini_temp=1
diri_temp=1

[GlobalParams]
  num_groups = 1
  num_precursor_groups = 1
  use_exp_form = false
  group_fluxes = &#x27;group1&#x27;
  temperature = temp
  sss2_input = false
  account_delayed = false
[]

[Mesh]
  type = GeneratedMesh
  nx = 10
  ny = 10
  dim = 2
  xmax = 2.42 # Bessel zero is 2.405
  ymax = 3.149
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    # order = CONSTANT
    # family = MONOMIAL
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
  [../]
[]

# [DGKernels]
#   [./temp]
#     type = DGConvection
#     variable = temp
#     velocity = &#x27;0 ${flow_velocity} 0&#x27;
#   [../]
# []

[BCs]
  # [./vacuum_group1]
  #   type = VacuumConcBC
  #   boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  #   variable = group1
  # [../]
  [./group1]
    type = DirichletBC
    value = 0
    boundary = &#x27;top right bottom&#x27;
    variable = &#x27;group1&#x27;
  [../]
  [./temp_diri_cg]
    boundary = &#x27;bottom right&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  # [./temp_advection_inlet]
  #   boundary = &#x27;bottom&#x27;
  #   type = TemperatureInflowBC
  #   velocity = &#x27;0 ${flow_velocity} 0&#x27;
  #   variable = temp
  #   inlet_conc = 1
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/dummy_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.1 1 1&#x27; # Robertson MSRE technical report @ 922 K
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  file_base = &#x27;&#x27;
  [./exodus]
    type = Exodus
  [../]
  [./csv]
    type = CSV
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="8ea5d584-5ea0-4e54-93b9-d59161bd951d"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-mod-heat-PJFNK.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;cylinder_structured_for_msre_comp.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;graphite_bottom fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="00b682cc-b92b-4157-885d-7412fd55a846"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-PJFNK.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;cylinder_structured_for_msre_comp.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;graphite_bottom fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b5eb2f76-c15d-415a-98ae-2c1d4322fd37"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922
base_height = 136
scale = .99
height = &#x27;${fparse base_height * scale}&#x27;
width = 145
offset = 2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  [file]
    type = FileMeshGenerator
    ## Default to jac_test.msh for quicker syntax check tests.
    ## Switch to 3D mesh for actual simulations.
    # file = &#x27;3d_msre_29x29_136.msh&#x27;
    file = jac_test.msh
  []
  [scale]
    type = TransformGenerator
    input = file
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  []
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    #     initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    #     initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity_variable = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [nt_ic_func]
    type = ParsedFunction
    expression = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  []
[]

[Materials]
  [fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
  #   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  #   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  #   [./temp_ic]
  #     type = RandomIC
  #     variable = temp
  #     min = 922
  #     max = 1022
  #   [../]
  #   [./group1_ic]
  #     type = RandomIC
  #     variable = group1
  #     min = .5
  #     max = 1.5
  #   [../]
  #   [./group2_ic]
  #     type = RandomIC
  #     variable = group2
  #     min = .5
  #     max = 1.5
  #   [../]
  [group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  []
  [group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="aa4b1887-f06d-4de4-a6b3-3f1218429373"><div class="modal-content"><h4>(problems/constant_inlet_outlet_temp_no_heat_flux_at_walls/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;fuel_bottoms&#x27;
    type = FlexiblePostprocessorDirichletBC
    postprocessor = coreEndTemp
    offset = -50
    variable = temp
  [../]
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  [../]
[]

[VectorPostprocessors]
  [./outlet_temps]
    type = LineValueSampler
    start_point = &#x27;0 153 0&#x27;
    end_point = &#x27;72.5 153 0&#x27;
    num_points = 1000
    variable = temp
    sort_by = &#x27;x&#x27;
    outputs = &#x27;csv&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
  [./csv]
    type = CSV
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6aa7b7a1-23a6-4725-82aa-0ae33a2d4a45"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;NEWTON&#x27;
  # solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  # exodus = true
  nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d0b0007c-324c-4495-ad33-f0589808b629"><div class="modal-content"><h4>(problems/060717_dimension_testing/one_group_nts_only.i)</h4><pre style="max-height:350px;"><code class="language-moose">[GlobalParams]
  num_groups = 1
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1&#x27;
  temperature = 972
  sss2_input = false
  account_delayed = false
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.5
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type&#x27;
  petsc_options_value = &#x27;asm lu&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  file_base = &#x27;&#x27;
  [exodus]
    type = Exodus
  []
  [csv]
    type = CSV
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b5329403-ee01-4e55-b334-e788ae578b3f"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/HXFail/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-pc_type&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9b3c05a2-4cf2-4f55-8ba2-d0661da8f373"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/nts-eigenvalue-msre-channel-dimensions.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = 922
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = single_channel_msre_dimensions.msh
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  []
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  # [./time_group1]
  #   type = NtTimeDerivative
  #   variable = group1
  #   group_number = 1
  # [../]
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
  # [./time_group2]
  #   type = NtTimeDerivative
  #   variable = group2
  #   group_number = 2
  # [../]
[]

# [BCs]
#   [./vacuum_group1]
#     type = VacuumConcBC
#     boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
#     # boundary = &#x27;fuel_bottom moderator_bottoms&#x27;
#     variable = group1
#   [../]
#   [./vacuum_group2]
#     type = VacuumConcBC
#     boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
#     # boundary = &#x27;fuel_bottom moderator_bottoms&#x27;
#     variable = group2
#   [../]
# []

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [SMP_PJFNK]
    type = SMP
    full = true
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 2.0
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  []
[]

[ICs]
  [group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  []
  [group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="be3455c9-ccf5-4adb-95bc-969d29504e23"><div class="modal-content"><h4>(problems/publication_level_cases/dilute_absorber_controlled_by_peak_power_density/in.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  # nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6252717b-a0c6-4a5b-b0ea-36a79f36ec29"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_control.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
  [peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  # nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e8ebe5d2-4151-4f62-bf1a-3f39c67021e0"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_restart.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_auto_diff_rho_out.e&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
    scaling = 1e4
  []
  [temp]
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
  init_from_file = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="268d24da-1064-44b0-ba2d-8b41864f7d12"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_direct.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  #   file = &#x27;3d_msre_29x29_136.msh&#x27;
  file = split_mesh/3d_auto_diff_rho_in.e
  nemesis = true
  skip_partioning = true
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  #   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  #   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly	  1e-3&#x27;
  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e88bc1d2-d77e-4c24-8758-59b3c13910cf"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/controlled_neutronics_only.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = 922
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-5
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  # solve_type = &#x27;NEWTON&#x27;
  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  line_search = none
  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [exodus]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="fd66eceb-88fe-485b-9acf-49b221ed5282"><div class="modal-content"><h4>(problems/transient-jac-test.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 147 # Cammi 147 cm/s

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  group_fluxes = &#x27;group1 group2&#x27;
  # MSRE full power = 10 MW; core volume 90 ft3
  # power = 200000
  temperature = temp
[]

[Mesh]
  type = GeneratedMesh
  dim = 2
  nx = 2
  ny = 1
  block_id = &#x27;0&#x27;
  block_name = &#x27;fuel&#x27;
[]

[MeshModifiers]
  [bounding_box]
    type = SubdomainBoundingBox
    bottom_left = &#x27;0.5 0 0&#x27;
    top_right = &#x27;1 1 0&#x27;
    block_id = &#x27;1&#x27;
    block_name = &#x27;moder&#x27;
  []
[]

[Variables]
  # [./pre1]
  # [../]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
  [temp]
    order = FIRST
    family = LAGRANGE
    scaling = 1e-3
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    group_number = 1
    variable = group1
  []
  [time_group2]
    type = NtTimeDerivative
    group_number = 2
    variable = group2
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []

  # Temperature
  [temp_flow_fuel]
    block = &#x27;fuel&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
    uz = ${flow_velocity}
  []
  [temp_flow_moder]
    block = &#x27;moder&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
  []
  [temp_source]
    type = TransientFissionHeatSource
    variable = temp
  []
[]

# Delayed neutron precursors

[Precursors]
  var_name_base = pre
  v_def = ${flow_velocity}
  # block = &#x27;fuel&#x27;
  inlet_boundary = &#x27;bottom&#x27;
  inlet_boundary_condition = &#x27;NeumannBC&#x27;
  inlet_bc_value = 1.1
  outlet_boundary = &#x27;top&#x27;
  temperature = temp
  incompressible_flow = false
  transient_simulation = true
  use_exp_form = false
  jac_test = true
  # initial_condition = -20
[]

# [AuxVariables]
#   [./pre1_lin]
#     family = MONOMIAL
#     order = CONSTANT
#   [../]

#   [./Qf]
#     family = MONOMIAL
#     order = CONSTANT
#   [../]
# [./diffus_temp]
#   family = MONOMIAL
#   order = CONSTANT
# [../]
# [./diffus_resid]
#   family = LAGRANGE
#   order = FIRST
# [../]
# [./src_resid]
#   family = LAGRANGE
#   order = FIRST
# [../]
# [./bc_resid]
#   family = LAGRANGE
#   order = FIRST
# [../]
# [./tot_resid]
#   family = LAGRANGE
#   order = FIRST
# [../]
# [../]

# [AuxKernels]
#   [./pre1_lin]
#     variable = pre1_lin
#     density_log = pre1
#     type = Density
#   [../]

#   [./Qf]
#     type = FissionHeatSourceAux
#     variable = Qf
#     tot_fissions = tot_fissions
#   [../]
# [./diffus_temp]
#   type = MatDiffusionAux
#   variable = diffus_temp
#   diffuse_var = temp
#   prop_name = &#x27;k&#x27;
# [../]
# []

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;msr2g_enrU_mod_953_fuel_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.0123 3.327e-3 1357&#x27; # Cammi 2011 at 908 K
  []
  [moder]
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;msr2g_enrU_fuel_922_mod_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.312 1.843e-3 1760&#x27; # Cammi 2011 at 908 K
  []
[]

[BCs]
  # [./temp_inlet]
  #   boundary = &#x27;fuel_bottom graphite_bottom&#x27;
  #   type = DirichletBC
  #   variable = temp
  #   value = 900
  # [../]
  # [./temp_outlet]
  #   boundary = &#x27;fuel_top&#x27;
  #   type = MatINSTemperatureNoBCBC
  #   variable = temp
  #   k = &#x27;k&#x27;
  # [../]
  # [./group1_vacuum]
  #   type = VacuumBC
  #   variable = group1
  #   boundary = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  # [../]
  # [./group2_vacuum]
  #   type = VacuumBC
  #   variable = group2
  #   boundary = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  # [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
  kernel_coverage_check = false
[]

[Executioner]
  type = Transient
  end_time = 10

  nl_abs_tol = 1e-11

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor -snes_test_display&#x27;
  # This system will not converge with default preconditioning; need to use asm
  petsc_options_iname = &#x27;-snes_type&#x27;
  petsc_options_value = &#x27;test&#x27;

  dtmin = 1e-7
  [TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-4
    growth_factor = 1.2
    optimal_iterations = 20
    nl_max_its = 50
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

# [Postprocessors]
#   [./bnorm]
#     type = ElmIntegTotFissNtsPostprocessor
#     group_fluxes = &#x27;group1 group2&#x27;
#     execute_on = linear
#   [../]
#   [./tot_fissions]
#     type = ElmIntegTotFissPostprocessor
#     execute_on = linear
#   [../]
#   [./group1norm]
#     type = ElementIntegralVariablePostprocessor
#     variable = group1
#     execute_on = linear
#   [../]
#   [./group2norm]
#     type = ElementIntegralVariablePostprocessor
#     variable = group2
#     execute_on = linear
#   [../]
#   [./group1max]
#     type = NodalExtremeValue
value_type = max
#     variable = group1
#     execute_on = timestep_end
#   [../]
#   [./group2max]
#     type = NodalExtremeValue
value_type = max
#     variable = group2
#     execute_on = timestep_end
#   [../]
#   [./group1diff]
#     type = ElementL2Diff
#     variable = group1
#     execute_on = &#x27;linear timestep_end&#x27;
#     use_displaced_mesh = false
#   [../]
# []

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  []
  [dof_map]
    type = DOFMap
  []

[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [temp_ic]
    type = RandomIC
    variable = temp
    min = 900
    max = 1400
  []
  [group1_ic]
    type = RandomIC
    variable = group1
    min = 0
    max = 600
  []
  [group2_ic]
    type = RandomIC
    variable = group2
    min = 0
    max = 600
  []
  # [./pre1_ic]
  #   type = ConstantIC
  #   variable = pre1
  #   value = -20
  # [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="8456886f-ea8b-487e-b72c-25728a2c40d2"><div class="modal-content"><h4>(problems/picard/nts_no_pres.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = false
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
[]

[AuxVariables]
  [./temp]
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  picard_max_its = 1
  picard_rel_tol = 1e-6
  picard_abs_tol = 1e-4

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-4

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 10
  l_max_its = 100
  dtmin = 1e-3

  [./TimeStepper]
    type = PostprocessorDT
    postprocessor = &#x27;limit_k&#x27;
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus csv&#x27;
  [../]
  [./limit_k]
    type = LimitK
    growth_factor = 1.1
    cutback_factor = 0.4
    k_threshold = 1.1
    k_postprocessor = &#x27;multiplication&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
  csv = true
  execute_on = &#x27;final&#x27;
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./temp]
    type = TransientMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = &#x27;temp_no_pres.i&#x27;
  [../]
[]

[Transfers]
  [./temp_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp&#x27;
    source_variable = temp
    variable = temp
  [../]
  [./group1_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;temp&#x27;
    source_variable = group1
    variable = group1
  [../]
  [./group2_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;temp&#x27;
    source_variable = group2
    variable = group2
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e191a5f7-a4ee-4acf-897c-b41411cff456"><div class="modal-content"><h4>(problems/transient-axi-nts-temp-delayed.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
nt_scale=1e18

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  group_fluxes = &#x27;group1 group2&#x27;
[../]

[Mesh]
  file = &#x27;axisymm_cylinder.msh&#x27;
[../]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
    # scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    group_number = 1
    variable = group1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    group_number = 2
    variable = group2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
    temperature = temp
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
    temperature = temp
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
    temperature = temp
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
    temperature = temp
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  [../]

  # Temperature
  [./temp_flow_fuel]
    block = &#x27;fuel&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
    uz = ${flow_velocity}
  [../]
  [./temp_flow_moder]
    block = &#x27;moder&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
  [../]
  [./temp_source]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
    rho = &#x27;rho&#x27;
    cp = &#x27;cp&#x27;
  [../]
[]

# Delayed neutron precursors

# [Precursors]
#   var_name_base = pre
#   v_def = ${flow_velocity}
#   block = &#x27;fuel&#x27;
#   inlet_boundary = &#x27;fuel_bottom&#x27;
#   inlet_boundary_condition = &#x27;DirichletBC&#x27;
#   inlet_bc_value = -20
#   outlet_boundary = &#x27;fuel_top&#x27;
#   temperature = temp
#   incompressible_flow = false
#   transient_simulation = true
#   use_exp_form = true
#   initial_condition = -20
# []

# [AuxVariables]
# []

# [AuxKernels]
# []

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;msr2g_enrU_mod_953_fuel_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.0123 3.327e-3 1357&#x27; # Cammi 2011 at 908 K
    # prop_values = &#x27;.123 3.327e-3 1357&#x27;
    temperature = temp
  [../]
  [./moder]
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;msr2g_enrU_fuel_922_mod_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.312 1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    # prop_values = &#x27;3.12 1.843e-3 1760&#x27;
    temperature = temp
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DirichletBC
    variable = temp
    value = ${inlet_temp}
  [../]
  [./temp_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = MatINSTemperatureNoBCBC
    variable = temp
    k = &#x27;k&#x27;
  [../]
  [./group1_vacuum]
    type = VacuumBC
    variable = group1
    boundary = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  [../]
  [./group2_vacuum]
    type = VacuumBC
    variable = group2
    boundary = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  nl_abs_tol = 4e-9
  trans_ss_check = true
  ss_check_tol = 4e-9
  nl_rel_tol = 1e-6

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # This system will not converge with default preconditioning; need to use asm
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -sub_ksp_type -pc_asm_overlap -ksp_gmres_restart -snes_linesearch_mindlambda&#x27;
  # petsc_options_value = &#x27;asm lu preonly 2 31 1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 superlu_dist&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-6
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-6
    growth_factor = 1.2
    optimal_iterations = 10
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_ic]
    type = ConstantIC
    variable = temp
    value = ${inlet_temp}
  [../]
  [./group1_ic]
    type = ConstantIC
    variable = group1
    value = 1
  [../]
  [./group2_ic]
    type = ConstantIC
    variable = group2
    value = 1
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
    # outputs = &#x27;csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
    # outputs = &#x27;csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
    # outputs = &#x27;csv&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="090b9769-4251-4979-b231-ec0ec6c2a21a"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-unit-cell.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = msre_squares.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[AuxVariables]
  [./vel_x]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_y]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_z]
    block = &#x27;fuel&#x27;
  [../]
  [./p]
    block = &#x27;fuel&#x27;
  [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_fuel_transport]
    type = INSTemperature
    u = vel_x
    v = vel_y
    w = vel_z
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    solve_type = PJFNK
    ksp_norm = none
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

[MultiApps]
  [./sub]
    type = FullSolveMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = solution_aux_exodus.i
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Transfers]
  [./vel_x]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_x
    variable = vel_x
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_y]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_y
    variable = vel_y
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_z]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_z
    variable = vel_z
    execute_on = &#x27;initial&#x27;
  [../]
  [./p]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = p
    variable = p
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="eeadeedd-8234-492d-8c5b-9c9f0c04e7be"><div class="modal-content"><h4>(problems/picard/nts.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
[]

[AuxVariables]
  [./temp]
  [../]
  [./pre1]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre2]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre3]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre4]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre5]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre6]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  picard_max_its = 10
  picard_rel_tol = 1e-7
  picard_abs_tol = 1e-10

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./temp_pres]
    type = TransientMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = &#x27;temp.i&#x27;
  [../]
[]

[Transfers]
  [./temp_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = temp
    variable = temp
  [../]
  [./pre1_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre1
    variable = pre1
  [../]
  [./pre2_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre2
    variable = pre2
  [../]
  [./pre3_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre3
    variable = pre3
  [../]
  [./pre4_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre4
    variable = pre4
  [../]
  [./pre5_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre5
    variable = pre5
  [../]
  [./pre6_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = pre6
    variable = pre6
  [../]
  [./group1_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = group1
    variable = group1
  [../]
  [./group2_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;temp_pres&#x27;
    source_variable = group2
    variable = group2
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="8c389d0b-e1f8-43da-b0c9-cdc2ad6d7b19"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;cylinder_structured_for_msre_comp.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;graphite_bottom fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9c6858b9-c118-457c-8eaf-f03eb14c2925"><div class="modal-content"><h4>(problems/publication_level_cases/transient_single_channel_blockage/3d_ss.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = msre_vol_frac_29x29_h_136.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    scaling = 1e4
    initial_condition = 1
  [../]
  [./group2]
    scaling = 1e4
    initial_condition = 1
  [../]
  [./temp]
    scaling = 1e-4
    initial_condition = ${ini_temp}
  [../]
[]

[Precursors]
  [./primary_fuel]
    var_name_base = pre
    block = &#x27;fuel blocked_fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops blocked_fuel_top&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    kernel_block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides blocked_fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops blocked_fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel blocked_fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  dtmin = 1e-7
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="7907fe24-2894-4cd4-b287-cbd7b73b0913"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function.i)</h4><pre style="max-height:350px;"><code class="language-moose"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 33.28
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_func = vel_x_func
  v_func = vel_y_func
  w_func = vel_z_func
  constant_velocity_values = false
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = VelocityFunctionTemperatureAdvection
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [vel_x_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_y_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_z_func]
    type = ParsedFunction
    expression = &#x27;${fuel_velocity_max_inlet} * cos(pi * x / (2 * ${fuel_sq_rad})) * cos(pi * y / (2 * ${fuel_sq_rad}))&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b893026e-997f-4f19-a082-a9e42bf20c8c"><div class="modal-content"><h4>(tests/coupled/auto_diff_rho_serpent.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
ini_temp = 922
diri_temp = 922
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
  []
[]

[Kernels]
  #---------------------------------------------------------------------
  # Group 1 Neutronics
  #---------------------------------------------------------------------
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  []

  #---------------------------------------------------------------------
  # Group 2 Neutronics
  #---------------------------------------------------------------------
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  #---------------------------------------------------------------------
  # Temperature
  #---------------------------------------------------------------------
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_converted_to_serpent/serpent_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_converted_to_serpent/serpent_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  num_steps = 80

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100
  steady_state_detection = true
  steady_state_tolerance = 1e-10

  dtmin = 1e-5
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 5
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho_serpent&#x27;
    execute_on = &#x27;final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b960d5eb-6560-404b-b670-f74a912fe9e3"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # uniform_refine = 1
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 100000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    # off_diag_row = &#x27;temp pre1 pre2 pre3 pre4 pre5 pre6 temp pre1 pre2 pre3 pre4 pre5 pre6&#x27;
    # off_diag_column = &#x27;group1 group1 group1 group1 group1 group1 group1 group2 group2 group2 group2 group2 group2 group2&#x27;
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [exodus]
    type = Exodus
    file_base = &#x27;&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []

# [Adaptivity]
#   marker = errorfrac_temp
#   max_h_level = 1
#   [./Indicators]
#     [./error_temp]
#       type = GradientJumpIndicator
#       variable = temp
#       outputs = none
#     [../]
#   [../]
#   [./Markers]
#     [./errorfrac_temp]
#       type = ErrorFractionMarker
#       refine = 0.8
#       coarsen = 0.1
#       indicator = error_temp
#       outputs = none
#     [../]
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d978ea73-51b3-4fed-9f85-96ef3a9dde20"><div class="modal-content"><h4>(problems/publication_level_cases/transient_single_channel_blockage/3d_auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = 3d_ss_out.e
[]

[MeshModifiers]
  # [./scale]
  #   type = Transform
  #   transform = SCALE
  #   vector_value = &#x27;1 1 ${scale}&#x27;
  # [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    scaling = 1e4
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
  [../]
  [./group2]
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
  [./primary_fuel]
    var_name_base = pre
    block = &#x27;fuel blocked_fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    init_from_file = true
    kernel_block = &#x27;fuel&#x27;
  [../]
  [./blocked_fuel]
    var_name_base = pre
    kernel_block = &#x27;blocked_fuel&#x27;
    outlet_boundaries = &#x27;blocked_fuel_top&#x27;
    u_def = 0
    v_def = 0
    w_def = 0
    nt_exp_form = false
    create_vars = false
    object_suffix = blocked
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel blocked_fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 5e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  file_base = temp
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="2ab4bdb8-cfcb-444a-b9fc-80a46b9ccbcf"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_condition = 1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_condition = 1
  [../]
  [./temp]
    scaling = 1e-4
    initial_condition = 930
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-5
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e1442bf4-23a7-4dc7-8225-0368a85c91d1"><div class="modal-content"><h4>(problems/debug-precursor-action.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 147 # Cammi 147 cm/s

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 1
  group_fluxes = &#x27;group1 group2&#x27;
  # MSRE full power = 10 MW; core volume 90 ft3
  power = 200000
[]

[Mesh]
  type = GeneratedMesh
  dim = 2
  nx = 2
  ny = 2
  block_id = 0
  block_name = &#x27;fuel&#x27;
[]

[MeshModifiers]
  [mod]
    type = SubdomainBoundingBox
    bottom_left = &#x27;0.5 0 0&#x27;
    top_right = &#x27;1 1 0&#x27;
    block_id = 1
    block_name = &#x27;moder&#x27;
  []
[]

[Variables]
  # [./pre1]
  # [../]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
  [temp]
    order = FIRST
    family = LAGRANGE
    scaling = 1e-3
  []
[]

[Kernels]
  # Neutronics
  # [./time_group1]
  #   type = NtTimeDerivative
  #   grou_number = 1
  #   variable = group1
  # [../]
  # [./time_group2]
  #   type = NtTimeDerivative
  #   grou_number = 2
  #   variable = group2
  # [../]
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
    temperature = temp
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
    temperature = temp
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
    temperature = temp
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
    temperature = temp
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  []
  # [./fission_source_group1]
  #   type = CoupledFissionKernel
  #   variable = group1
  #   group_number = 1
  #   num_groups = 2
  #   group_fluxes = &#x27;group1 group2&#x27;
  # temperature = temp
  # [../]
  # [./fission_source_group2]
  #   type = CoupledFissionKernel
  #   variable = group2
  #   group_number = 2
  #   num_groups = 2
  #   group_fluxes = &#x27;group1 group2&#x27;
  # temperature = temp
  # [../]

  # Temperature
  # [./temp_cond]
  #   type = MatDiffusion
  #   variable = temp
  #   prop_name = &#x27;k&#x27;
  # [../]
  [temp_flow_fuel]
    block = &#x27;fuel&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
    uz = ${flow_velocity}
  []
  [temp_flow_moder]
    block = &#x27;moder&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
  []
  [temp_source]
    type = FissionHeatSource
    tot_fissions = tot_fissions
    variable = temp
  []

  #   # Delayed neutron precursors
  # [./pre1_source]
  #   type = PrecursorSource
  #   variable = pre1
  #   precursor_group_number = 1
  #   temperature = temp
  # [../]
  # [./pre1_decay]
  #   type = PrecursorDecay
  #   variable = pre1
  #   precursor_group_number = 2
  #   temperature = temp
  # [../]
[]

[Precursors]
  var_name_base = pre
  # v_def = ${flow_velocity}
  # block = &#x27;fuel&#x27;
  inlet_boundary = &#x27;bottom&#x27;
  inlet_boundary_condition = &#x27;DirichletBC&#x27;
  inlet_dirichlet_value = 0
  outlet_boundary = &#x27;top&#x27;
  T = temp
[]

[AuxVariables]
  [Qf]
    family = MONOMIAL
    order = CONSTANT
  []
  # [./diffus_temp]
  #   family = MONOMIAL
  #   order = CONSTANT
  # [../]
  # [./diffus_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
  # [./src_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
  # [./bc_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
  # [./tot_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
[]

[AuxKernels]
  [Qf]
    type = FissionHeatSourceAux
    variable = Qf
    tot_fissions = tot_fissions
  []
  # [./diffus_temp]
  #   type = MatDiffusionAux
  #   variable = diffus_temp
  #   diffuse_var = temp
  #   prop_name = &#x27;k&#x27;
  # [../]
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;msr2g_enrU_mod_953_fuel_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.0123 3.327e-3 1357&#x27; # Cammi 2011 at 908 K
    temperature = temp
  []
  [moder]
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;msr2g_enrU_fuel_922_mod_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.312 1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    temperature = temp
  []
[]

[BCs]
  [temp_inlet]
    boundary = &#x27;bottom&#x27;
    type = DirichletBC
    variable = temp
    value = 900
  []
  [temp_outlet]
    boundary = &#x27;top&#x27;
    type = MatINSTemperatureNoBCBC
    variable = temp
    k = &#x27;k&#x27;
  []
  [group1_vacuum]
    type = VacuumBC
    variable = group1
    boundary = &#x27;top bottom&#x27;
  []
  [group2_vacuum]
    type = VacuumBC
    variable = group2
    boundary = &#x27;top bottom&#x27;
  []
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[]

[Executioner]
  type = NonlinearEigen
  free_power_iterations = 2
  source_abs_tol = 1e-12
  source_rel_tol = 1e-8
  output_after_power_iterations = false

  # type = InversePowerMethod
  # max_power_iterations = 50
  # xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.7
  pfactor = 1e-2
  l_max_its = 100

  line_search = none
  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor -snes_test_display&#x27;
  # This system will not converge with default preconditioning; need to use asm
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -sub_ksp_type -pc_asm_overlap -ksp_gmres_restart&#x27;
  petsc_options_value = &#x27;asm lu preonly 2 31&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    group_fluxes = &#x27;group1 group2&#x27;
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [temp_ic]
    type = ConstantIC
    variable = temp
    value = 900
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="5bc62a40-a634-475d-8585-0981f231b7b4"><div class="modal-content"><h4>(problems/060717_dimension_testing/one_group.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 1
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  # coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-6
  [../]
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  scaling = 1
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  # [./temp_diffusion_outlet]
  #   boundary = &#x27;fuel_tops&#x27;
  #   type = DiffusiveFluxBC
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  file_base = &#x27;&#x27;
  [./exodus]
    type = Exodus
  [../]
  [./csv]
    type = CSV
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="c0f11832-e310-4658-9b73-c08befe5430e"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function_moderator_heating.i)</h4><pre style="max-height:350px;"><code class="language-moose"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 33.28
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_func = vel_x_func
  v_func = vel_y_func
  w_func = vel_z_func
  constant_velocity_values = false
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = VelocityFunctionTemperatureAdvection
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [vel_x_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_y_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_z_func]
    type = ParsedFunction
    expression = &#x27;${fuel_velocity_max_inlet} * cos(pi * x / (2 * ${fuel_sq_rad})) * cos(pi * y / (2 * ${fuel_sq_rad}))&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 100000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200
  line_search = none

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  []
  [peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="5d20370f-7317-43f4-9f11-b6c4b8778784"><div class="modal-content"><h4>(problems/picard/tmp_nts.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  account_delayed = false
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 3e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = PostprocessorDT
    postprocessor = &#x27;limit_k&#x27;
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./limit_k]
    type = LimitK
    growth_factor = 1.1
    cutback_factor = 0.4
    k_threshold = 1.25
    k_postprocessor = &#x27;multiplication&#x27;
  [../]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9bc185f3-dba8-4022-aed5-8b18c62de403"><div class="modal-content"><h4>(problems/LOFA/auto_diff_rho.i)</h4><pre style="max-height:350px;"><code class="language-moose"># take in steady state variable from the other core, and run a pump coastdown transient
# here, flow_velocity is only the initial flow velocity
flow_velocity=21.7 # cm/s. See MSRE-properties.ods
tau = 5 # pump coastdown time constant
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;steady/auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    constant_velocity_values = false
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    u_func = nullFunc
    v_func = coastDownFunc
    w_func = nullFunc
    init_from_file = true
  [../]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]


[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
     type = GammaHeatSource
     variable = temp
     gamma = .0144 # Cammi .0144
     block = &#x27;moder&#x27;
     average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = CtrlConservativeTemperatureAdvection
    u_val = 0
    v_val = ${flow_velocity} # this will be changed in ctrls block
    w_val = 0
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_postpr_inlet]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    variable = temp
    postprocessor = inlet_mean_temp
  [../]
  #[./temp_postpr_inlet]
  #  boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #  type = DirichletBC
  #  variable = temp
  #  value = 922
  #[../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = nullFunc
    vel_y_func = coastDownFunc
    vel_z_func = nullFunc
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nullFunc]
    type = ParsedFunction
    value = &#x27;0&#x27;
  [../]
  [./coastDownFunc]
    type = ParsedFunction
    value = &#x27;${flow_velocity} * exp(-t / ${tau})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  # fuel cp function
  [./cp_fuel]
    type = DerivativeParsedMaterial
    f_name = cp
    function = &#x27;1967 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  # fuel k function
  [./k_fuel]
    type = DerivativeParsedMaterial
    f_name = k
    function = &#x27;0.0553 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  # moder cp fcn
  [./cp_moder]
    type = DerivativeParsedMaterial
    f_name = cp
    function = &#x27;1760 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  # moder k fcn
  [./k_moder]
    type = DerivativeParsedMaterial
    f_name = k
    function = &#x27;.312 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
  nl_abs_tol = 3e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27; #  -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu&#x27; #       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.04
    optimal_iterations = 5
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    # ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
  #multiapp
  [./inlet_mean_temp]
    type = Receiver
    execute_on = &#x27;initial timestep_begin&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Controls]
  [./flowControl]
    type = RealFunctionControl
    parameter = &#x27;*/*/v_val&#x27;
    function = coastDownFunc
    execute_on = &#x27;initial timestep_begin&#x27;
  [../]
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = &#x27;initial timestep_begin&#x27;
    positions = &#x27;100.0 100.0 0.0&#x27;
    input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
 [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9782c7b0-8627-4390-8b72-132acd1132e0"><div class="modal-content"><h4>(problems/axi-nts-temp-delayed.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity = 147 # Cammi 147 cm/s

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  group_fluxes = &#x27;group1 group2&#x27;
  # MSRE full power = 10 MW; core volume 90 ft3
  power = 200000
[]

[Mesh]
  file = &#x27;axisymm_cylinder.msh&#x27;
[]

[Variables]
  # [./pre1]
  # [../]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
  [temp]
    order = FIRST
    family = LAGRANGE
    scaling = 1e-3
  []
[]

[Kernels]
  # Neutronics
  # [./time_group1]
  #   type = NtTimeDerivative
  #   grou_number = 1
  #   variable = group1
  # [../]
  # [./time_group2]
  #   type = NtTimeDerivative
  #   grou_number = 2
  #   variable = group2
  # [../]
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
    temperature = temp
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
    temperature = temp
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
    temperature = temp
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
    temperature = temp
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  []
  # [./fission_source_group1]
  #   type = CoupledFissionKernel
  #   variable = group1
  #   group_number = 1
  #   num_groups = 2
  #   group_fluxes = &#x27;group1 group2&#x27;
  # temperature = temp
  # [../]
  # [./fission_source_group2]
  #   type = CoupledFissionKernel
  #   variable = group2
  #   group_number = 2
  #   num_groups = 2
  #   group_fluxes = &#x27;group1 group2&#x27;
  # temperature = temp
  # [../]

  # Temperature
  # [./temp_cond]
  #   type = MatDiffusion
  #   variable = temp
  #   prop_name = &#x27;k&#x27;
  # [../]
  [temp_flow_fuel]
    block = &#x27;fuel&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
    uz = ${flow_velocity}
  []
  [temp_flow_moder]
    block = &#x27;moder&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
  []
  [temp_source]
    type = FissionHeatSource
    tot_fissions = tot_fissions
    variable = temp
  []

[]

[Precursors]
  var_name_base = pre
  v_def = ${flow_velocity}
  block = &#x27;fuel&#x27;
  inlet_boundary = &#x27;fuel_bottom&#x27;
  inlet_boundary_condition = &#x27;DirichletBC&#x27;
  inlet_dirichlet_value = -20
  outlet_boundary = &#x27;fuel_top&#x27;
  T = temp
  incompressible_flow = false
  use_exp_form = true
  initial_condition = -20
[]

[AuxVariables]
  [Qf]
    family = MONOMIAL
    order = CONSTANT
  []
  [pre1_lin]
    family = MONOMIAL
    order = CONSTANT
  []
  # [./diffus_temp]
  #   family = MONOMIAL
  #   order = CONSTANT
  # [../]
  # [./diffus_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
  # [./src_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
  # [./bc_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
  # [./tot_resid]
  #   family = LAGRANGE
  #   order = FIRST
  # [../]
[]

[AuxKernels]
  [Qf]
    type = FissionHeatSourceAux
    variable = Qf
    tot_fissions = tot_fissions
  []
  [pre1_lin]
    variable = pre1_lin
    density_log = pre1
    type = Density
  []
  # [./diffus_temp]
  #   type = MatDiffusionAux
  #   variable = diffus_temp
  #   diffuse_var = temp
  #   prop_name = &#x27;k&#x27;
  # [../]
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;msr2g_enrU_mod_953_fuel_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.0123 3.327e-3 1357&#x27; # Cammi 2011 at 908 K
    temperature = temp
  []
  [moder]
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;msr2g_enrU_fuel_922_mod_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.312 1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    temperature = temp
  []
[]

[BCs]
  [temp_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DirichletBC
    variable = temp
    value = 900
  []
  [temp_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = MatINSTemperatureNoBCBC
    variable = temp
    k = &#x27;k&#x27;
  []
  [group1_vacuum]
    type = VacuumBC
    variable = group1
    boundary = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  []
  [group2_vacuum]
    type = VacuumBC
    variable = group2
    boundary = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  []
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[]

[Executioner]
  type = NonlinearEigen
  free_power_iterations = 2
  source_abs_tol = 1e-12
  source_rel_tol = 1e-8
  output_after_power_iterations = false

  # type = InversePowerMethod
  # max_power_iterations = 50
  # xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 1.7
  pfactor = 1e-2
  l_max_its = 100

  # line_search = none
  solve_type = &#x27;PJFNK&#x27;
  # solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # This system will not converge with default preconditioning; need to use asm
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -sub_ksp_type -pc_asm_overlap -ksp_gmres_restart&#x27;
  petsc_options_value = &#x27;asm lu preonly 2 31&#x27;
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    group_fluxes = &#x27;group1 group2&#x27;
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;timestep_end&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [temp_ic]
    type = ConstantIC
    variable = temp
    value = 900
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="124f45fb-ce81-4ebf-8a61-71cd88c3c19f"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-b1-two-mat.i)</h4><pre style="max-height:350px;"><code class="language-moose">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = true
[../]

[Mesh]
  file = &#x27;msre_26x26.msh&#x27;
  # file = &#x27;msre_cuboid_3x3.msh&#x27;
[../]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  [../]
  [./temp]
    initial_condition = ${diri_temp}
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;fuel_bottoms moder_bottoms fuel_sides&#x27;
    type = DirichletBC
    variable = temp
    value = ${diri_temp}
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_moder_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="55fb9c74-d817-4ef1-b1fc-6e4e8f4a285f"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/unit-cell-nts-eigenvalue.i)</h4><pre style="max-height:350px;"><code class="language-moose"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = 922
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = msre_squares.msh
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  []
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  # [./time_group1]
  #   type = NtTimeDerivative
  #   variable = group1
  #   group_number = 1
  # [../]
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionEigenKernel
    variable = group1
    group_number = 1
  []
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionEigenKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
  # [./time_group2]
  #   type = NtTimeDerivative
  #   variable = group2
  #   group_number = 2
  # [../]
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    # boundary = &#x27;fuel_bottom moderator_bottoms&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    # boundary = &#x27;fuel_bottom moderator_bottoms&#x27;
    variable = group2
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [SMP_PJFNK]
    type = SMP
    full = true
  []
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50
  xdiff = &#x27;group1diff&#x27;

  bx_norm = &#x27;bnorm&#x27;
  k0 = 2.0
  pfactor = 1e-2
  l_max_its = 100

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  []
[]

[ICs]
  [group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  []
  [group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  []
[]

[Postprocessors]
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#f0640bb3-6691-4522-ba32-fd3c404566ba" class="tooltipped" data-position="left" data-tooltip="Overview">Overview</a></li><li><a href="#af240f2a-169d-4389-910d-9f1e3e29bd72" class="tooltipped" data-position="left" data-tooltip="Example Input File Syntax">Example Input File Syntax</a></li><li><a href="#a95ff443-f85a-489e-b0fc-4c25c88793ee" class="tooltipped" data-position="left" data-tooltip="Input Parameters">Input Parameters</a></li><li><a href="#10f5b447-3601-4c0e-bd4d-155dcf5f4973" class="tooltipped" data-position="left" data-tooltip="Input Files">Input Files</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>