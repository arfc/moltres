<!DOCTYPE html><head><meta charset="UTF-8"><title>TransientFissionHeatSource | Moltres</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/moltres.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../contrib/katex/katex.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Moltres</a><a href="https://github.com/arfc/moltres" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="e45c1ae4-eadb-4e1b-99f3-a15c8337fd9c" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="ec22b0f8-89cb-48f7-b99c-1fdf9b707da9" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="d64c7a57-e5a7-4468-a8ea-cbf3c22ffdc6" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#" class="sidenav-trigger" data-target="0a0f3e9d-965b-4258-a732-cd9a63f93fc3"><i class="material-icons">menu</i></a><ul class="sidenav" id="0a0f3e9d-965b-4258-a732-cd9a63f93fc3"><li><a href="#!" class="dropdown-trigger" data-target="277e2084-f730-410a-ab4f-e0a30c9f022a" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="ae78e1bc-3a5b-4f26-8c89-ddcd8ba64406" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="82d8d211-3cec-4f3e-8d1c-4055f956b58e" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="e45c1ae4-eadb-4e1b-99f3-a15c8337fd9c"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="ec22b0f8-89cb-48f7-b99c-1fdf9b707da9"><li><a href="../../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="d64c7a57-e5a7-4468-a8ea-cbf3c22ffdc6"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul><ul class="dropdown-content" id="277e2084-f730-410a-ab4f-e0a30c9f022a"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="ae78e1bc-3a5b-4f26-8c89-ddcd8ba64406"><li><a href="../../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="82d8d211-3cec-4f3e-8d1c-4055f956b58e"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">source</a><span class="breadcrumb">kernels</span><a href="#" class="breadcrumb">TransientFissionHeatSource</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="988daacb-19a0-4070-bfef-6342a76e1dfe" data-section-level="1" data-section-text="TransientFissionHeatSource"><h1 id="transientfissionheatsource">TransientFissionHeatSource</h1><p></p><section class="scrollspy" id="ad841c56-0799-43a8-b66f-814af1bb4788" data-section-level="2" data-section-text="Overview"><h2 id="overview">Overview</h2><p>This object adds the <span class="moose-katex-inline-equation" id="moose-equation-1f7d55cf-2d3e-4f9f-b39d-d8a47e9ce83a"><script>var element = document.getElementById("moose-equation-1f7d55cf-2d3e-4f9f-b39d-d8a47e9ce83a");katex.render("\\sum_{g=1}^G \\epsilon_g\\Sigma_{f,g}\\phi_g", element, {displayMode:false,throwOnError:false});</script></span> heat source term of the time-dependent temperature advection-diffusion equation with coupled neutron fluxes from a time-dependent multigroup neutron diffusion calculation.</p></section><section class="scrollspy" id="ec3293e9-2dbb-46e4-adb4-91d4880539cc" data-section-level="2" data-section-text="Example Input File Syntax"><h2 id="example-input-file-syntax">Example Input File Syntax</h2><p></p></section><section class="scrollspy" id="a5857e35-1d63-43c0-bb5c-d3c47da7981e" data-section-level="2" data-section-text="Input Parameters"><h2 id="input-parameters">Input Parameters</h2><section id="55f50ab2-fb49-4b4d-959b-0d79246a04d8" data-section-level="3" data-section-text="Required Parameters" data-details-open="open"><details class="moose-section-content" open="open"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">group_fluxes</span><span class="moose-parameter-header-description">All the variables that hold the group fluxes. These MUST be listed by decreasing energy/increasing group number.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;VariableName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>All the variables that hold the group fluxes. These MUST be listed by decreasing energy/increasing group number.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">num_groups</span><span class="moose-parameter-header-description">The total numer of energy groups</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The total numer of energy groups</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">variable</span><span class="moose-parameter-header-description">The name of the variable that this residual object operates on</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>NonlinearVariableName</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of the variable that this residual object operates on</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Required Parameters</h3></summary></details></section><section id="aa7db9e2-c679-4d17-945c-efd48e822c94" data-section-level="3" data-section-text="Optional Parameters" data-details-open="open"><details class="moose-section-content" open="open"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">account_decay_heat</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether to account for decay heat.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether to account for decay heat.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">block</span><span class="moose-parameter-header-description">The list of blocks (ids or names) that this object will be applied</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;SubdomainName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The list of blocks (ids or names) that this object will be applied</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">decay_heat_constants</span><span class="moose-parameter-header-description">Decay Heat Constants</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;double&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Decay Heat Constants</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">decay_heat_fractions</span><span class="moose-parameter-header-description">Decay Heat Fractions</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;double&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Decay Heat Fractions</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">displacements</span><span class="moose-parameter-header-description">The displacements</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;VariableName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The displacements</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">heat_concs</span><span class="moose-parameter-header-description">All the variables that hold the decay heat precursor concentrations.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;VariableName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>All the variables that hold the decay heat precursor concentrations.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">nt_scale</span><span class="moose-parameter-header-default">1</span><span class="moose-parameter-header-description">Scaling of the neutron fluxes to aid convergence.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>1</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Scaling of the neutron fluxes to aid convergence.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">num_decay_heat_groups</span><span class="moose-parameter-header-default">0</span><span class="moose-parameter-header-description">The number of decay heat groups.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>0</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The number of decay heat groups.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">prop_getter_suffix</span><span class="moose-parameter-header-description">An optional suffix parameter that can be appended to any attempt to retrieve/get material properties. The suffix will be prepended with a '_' character.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MaterialPropertyName</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>An optional suffix parameter that can be appended to any attempt to retrieve/get material properties. The suffix will be prepended with a '_' character.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">use_exp_form</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Whether concentrations should be in an expotential/logarithmic format.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether concentrations should be in an expotential/logarithmic format.</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Optional Parameters</h3></summary></details></section><section id="9a51dc81-1ff5-49ce-ba3e-a4157735d760" data-section-level="3" data-section-text="Tagging Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">absolute_value_vector_tags</span><span class="moose-parameter-header-description">The tags for the vectors this residual object should fill with the absolute value of the residual contribution</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tags for the vectors this residual object should fill with the absolute value of the residual contribution</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">extra_matrix_tags</span><span class="moose-parameter-header-description">The extra tags for the matrices this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The extra tags for the matrices this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">extra_vector_tags</span><span class="moose-parameter-header-description">The extra tags for the vectors this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;TagName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The extra tags for the vectors this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">matrix_tags</span><span class="moose-parameter-header-default">system</span><span class="moose-parameter-header-description">The tag for the matrices this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>system</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MultiMooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nontime, system</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tag for the matrices this Kernel should fill</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">vector_tags</span><span class="moose-parameter-header-default">nontime</span><span class="moose-parameter-header-description">The tag for the vectors this Kernel should fill</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>nontime</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MultiMooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>nontime, time</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The tag for the vectors this Kernel should fill</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Tagging Parameters</h3></summary></details></section><section id="3d468490-32b9-451e-bfa9-c49ce194a0cc" data-section-level="3" data-section-text="Advanced Parameters" data-details-open="close"><details class="moose-section-content"><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">control_tags</span><span class="moose-parameter-header-description">Adds user-defined labels for accessing object parameters via control logic.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;std::string&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Adds user-defined labels for accessing object parameters via control logic.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">diag_save_in</span><span class="moose-parameter-header-description">The name of auxiliary variables to save this Kernel's diagonal Jacobian contributions to. Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;AuxVariableName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of auxiliary variables to save this Kernel's diagonal Jacobian contributions to. Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">enable</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Set the enabled status of the MooseObject.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>Yes</p><p class="moose-parameter-description"><span>Description:</span>Set the enabled status of the MooseObject.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">implicit</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Determines whether this object is calculated using an implicit or explicit form</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Determines whether this object is calculated using an implicit or explicit form</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">save_in</span><span class="moose-parameter-header-description">The name of auxiliary variables to save this Kernel's residual contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;AuxVariableName&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of auxiliary variables to save this Kernel's residual contributions to.  Everything about that variable must match everything about this variable (the type, what blocks it's on, etc.)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">seed</span><span class="moose-parameter-header-default">0</span><span class="moose-parameter-header-description">The seed for the master random number generator</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>0</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The seed for the master random number generator</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">use_displaced_mesh</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Whether or not this object should use the displaced mesh for computation. Note that in the case this is true but no displacements are provided in the Mesh block the undisplaced mesh will still be used.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether or not this object should use the displaced mesh for computation. Note that in the case this is true but no displacements are provided in the Mesh block the undisplaced mesh will still be used.</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Advanced Parameters</h3></summary></details></section></section><section class="scrollspy" id="bb5fd029-dccf-4109-8d9c-010f90afc551" data-section-level="2" data-section-text="Input Files"><h2 id="input-files">Input Files</h2><ul class="moose-list-inputs browser-default"><li><a class="moose-source-filename tooltipped modal-trigger" href="#301fd1ed-4c3f-44d6-963c-11eecfcf5463">(tutorial/transient/transient.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#d2a69155-dedf-4385-9f71-fa5e0825b89c">(problems/picard/temp.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#155622ff-1d88-4ef7-9850-b7dcb2273777">(problems/publication_level_cases/transient_single_channel_blockage/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#4c5fa844-a034-4145-86d3-12866996c2f3">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_control.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#5efe4be7-b836-41a3-bd01-937f800e228a">(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#784e8cf0-0ecc-4825-a725-dd490b44b471">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#61d0f615-c690-4a99-a249-8453a7db8720">(problems/picard/temp_no_pres.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b7f9db77-4bb6-44bd-b317-881a63cd1b44">(problems/011317_notebook_add_temperature_coupling/Input_serpent.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#1660de30-3bf0-4be4-bca1-0c58e78cab60">(tests/coupled/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#dbc756be-ad66-406e-88aa-1477767e9a37">(tests/coupled/auto_diff_rho_serpent.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e7e104bd-262c-40f1-878d-8ec44a7982be">(problems/011717_precursors/Input_restart_rdg_module.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#43f3b86b-f378-400e-991e-ea38b337d217">(problems/020617_mod_heat_source_one_minus_beta_fission/Input.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#509941e6-76bc-4fcc-9f5a-388657d25d45">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_monotone_interp.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b7397563-464a-46fc-8f54-430dd464dc25">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#df4782a5-458d-477e-8665-810310787134">(problems/021417_MSRE_materials/CG_temp.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#f556dc4c-fa11-4975-9726-e502ff74b07b">(problems/publication_level_cases/3d_steady_state/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#24b3fd25-0180-475e-8399-579ddadf5110">(problems/transient-jac-test.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#98327408-9cac-4ee2-8451-cbe3912a6d9f">(problems/012017_temperature_to_dg/Input.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#cad156ba-5a1a-4006-a36e-eb2f89183530">(problems/LOSCA/HXFailure/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#d241ef2c-1a9f-49bb-ade8-9ff04653ea84">(problems/020617_mod_heat_source_one_minus_beta_fission/gamma_source_check.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#1547cf7e-06c7-4177-8ad0-0c167ddf479f">(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-mod-heat-PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#cfeea176-aa9c-4d73-9513-a8f7a59bf9ee">(problems/2017_annals_pub_msre_compare/4group.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#d088893e-ee07-4abc-b683-3f4b4ca90e8f">(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#af42ddef-5027-4703-8009-69ca5162578e">(problems/publication_level_cases/LOSCA/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#c107cc24-9f45-4564-b4dd-842286ae4116">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_restart.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#3d3d98f6-7590-48a4-8fb6-ad68e4ac7eed">(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#f15874d3-8c81-43b0-a254-08c259c980de">(problems/picard/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#91687ca1-c9f0-4d20-97dd-221cfd3ca25b">(problems/rodded2D/rodded.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e9aaddf2-c0b0-4d81-9933-3a4b46f3adf7">(problems/011717_precursors/Input.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#8d3567ed-a1ae-4fdd-b85c-2b2490c52214">(problems/011317_notebook_perfectly_bracketed_critical_buckling_height_from_newt/Input.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#932607e0-b583-42fb-bf34-ab24f2dd111b">(problems/LOSCA/HXFailure/sub.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#46ab4af0-6915-4d1e-8f60-64f7f905a38d">(problems/LOFA/steady/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#7d7bf081-c8c2-41d1-b664-7ae204fb8f2a">(problems/transient-axi-nts-temp-delayed.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e878278f-81a0-4f78-84a6-1cc52967d903">(problems/011317_notebook_add_temperature_coupling/Input.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#78e8b1a9-4a76-4f67-bbbb-b4bae8382bbb">(problems/2017_annals_pub_msre_compare/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#54722e4e-69b3-42bb-a827-5e541605e2dd">(problems/072017_dg_temperature/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9e059621-434b-4f85-bf8d-24d917d339ac">(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function_moderator_heating.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#ac17569d-766a-4c25-87ca-f5e37cea885b">(problems/LOSCA/sub.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#7e4ba0d7-6977-4035-a509-5abb31c8894b">(tests/temp/temp.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#3677a7ba-43b5-4c7a-9a1b-5d2bf94b95ed">(problems/single_msre_channel_velocity_heat_nts/unit-cell-heat-and-nts.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#ea5628cf-93dc-46a1-9f0e-c0b68cb3b1e6">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#8fa1a722-88de-4ee3-8061-2587f93960e5">(problems/020617_mod_heat_source_one_minus_beta_fission/Input_PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#53d7282b-443c-4dc5-937b-f89159a8c534">(problems/012017_temperature_to_dg/test_mat_props.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#a4458145-e786-4e54-a5c4-63fae5009791">(problems/021417_MSRE_materials/Input.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#8335bd4e-4cba-4775-8269-a6c6f3114e68">(problems/publication_level_cases/manuBench/manuboxNoStokes.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#e4933ad7-692b-4324-ae0f-d41845dc56e2">(problems/publication_level_cases/LOSCA/HXFail/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#58b46364-143d-4e69-b070-d4f241f75507">(problems/publication_level_cases/twod_control_rod_yank/rodded.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#6312978a-8031-4d4e-ae33-4ab2a20fd609">(problems/033117_nts_temp_pre_parsed_mat/2d_axi_function_cross_sections.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#18461be0-040e-4715-87a7-e3a579557c0f">(problems/publication_level_cases/LOSCA/HXFail/sub.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#ab8f998b-5df0-4526-a38c-f9f62da5711c">(problems/picard/tmp_nts.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b216cc16-05b0-4c0b-b967-4a5b40452b2c">(problems/publication_level_cases/gamma_heating_3d_ss/3d_auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#68bc555a-6160-4753-bbdc-3014734706ce">(problems/LOFA/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#66888794-4450-41ad-8ec9-272b18208f70">(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-channel-msre-dimensions.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b4d785a8-7450-4dc8-ae6c-6489c4e593e7">(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-unit-cell.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#15481986-4bb5-40a5-a04c-d04e0b9284d5">(problems/publication_level_cases/transient_single_channel_blockage/3d_ss.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b8c879c0-e083-4360-800a-fe7f431b1693">(problems/060717_dimension_testing/one_group.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#c65694b8-b359-4587-8ee0-38d1c95ee4f3">(problems/2017_annals_pub_msre_compare/2group.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#839fe0f5-3da3-42e5-83f7-9829926dbc00">(problems/LOSCA/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#ce3ddc1b-b684-4b1c-92f6-10351a5ce6cd">(problems/publication_level_cases/dilute_absorber_controlled_by_peak_power_density/in.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#50c95b71-2253-4453-a3fd-96026ead3e6b">(problems/publication_level_cases/LOSCA/sub.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#b0abd6ca-aed6-4937-a247-946d4eab0499">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_direct.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#1352e511-f784-4c8e-94f8-ab6f789a6f70">(problems/011317_notebook_perfectly_bracketed_critical_buckling_height_from_newt/Input_serpent.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#53d3af41-d727-4d0e-963a-43e9f61afe4a">(problems/constant_inlet_outlet_temp_no_heat_flux_at_walls/auto_diff_rho.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#9e18f596-e4e8-4138-9c41-237458729146">(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#163ae21d-8473-4601-a1a9-18f846bd9617">(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-b1-two-mat.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#ad568e5b-2f91-4c1c-bc85-c23744323674">(problems/021417_MSRE_materials/mini_msre_cg_temp.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#0e920963-8db1-4ea6-a1ea-7a5b7cb0a439">(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-scale-two-mat-inverted-file-msh.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#7f11bbb8-4b2a-47b6-9f7f-bfdfe6664a93">(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive_PJFNK.i)</a></li><li><a class="moose-source-filename tooltipped modal-trigger" href="#52c62fa3-d67f-438c-8da9-01255db761fc">(problems/060717_dimension_testing/test_case.i)</a></li></ul></section></section><div class="moose-modal modal" id="301fd1ed-4c3f-44d6-963c-11eecfcf5463"><div class="modal-content"><h4>(tutorial/transient/transient.i)</h4><pre class="moose-pre"><code class="language-text">[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  temperature = temp
  sss2_input = true
  account_delayed = true
[]

[Mesh]
  coord_type = RZ
  [mesh]
    type = FileMeshGenerator
    file = &#x27;../eigenvalue/mesh.e&#x27;
  []
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
  [temp]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1000
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    family = MONOMIAL
    order = CONSTANT
    block = 0
    outlet_boundaries = &#x27;fuel_top&#x27;
    constant_velocity_values = true
    u_def = 0
    v_def = 18.085
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    transient = true
  []
[]

[Kernels]
  #---------------------------------------------------------------------
  # Group 1 Neutronics
  #---------------------------------------------------------------------
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;0&#x27;
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;0&#x27;
    group_number = 1
  []

  #---------------------------------------------------------------------
  # Group 2 Neutronics
  #---------------------------------------------------------------------
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;0&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  #---------------------------------------------------------------------
  # Temperature
  #---------------------------------------------------------------------
  [temp_time_derivative]
    type = INSTemperatureTimeDerivative
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    variable = temp
    velocity = &#x27;0 18.085 0&#x27;
    block = &#x27;0&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    variable = temp
    diffusivity = &#x27;k&#x27;
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;0&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top mod_bottom mod_top right&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top mod_bottom mod_top right&#x27;
    variable = group2
  []
  [temp_inlet_bc]
    type = FunctionDirichletBC
    variable = temp
    boundary = &#x27;fuel_bottom mod_bottom right&#x27;
    function = &#x27;temp_bc_func&#x27;
  []
  [temp_outlet_bc]
    type = TemperatureOutflowBC
    variable = temp
    boundary = &#x27;fuel_top&#x27;
    velocity = &#x27;0 18.085 0&#x27;
  []
[]

[ICs]
  [group1_ic]
    type = FunctionIC
    variable = group1
    function = ic_func
  []
  [group2_ic]
    type = FunctionIC
    variable = group2
    function = ic_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;1000 - (1000-965) * tanh(t/1)&#x27;
  []
  [dt_func]
    type = ParsedFunction
    expression = &#x27;if(t&lt;50, if(t&lt;30, .4, 5), 10)&#x27;
  []
  [ic_func]
    type = ParsedFunction
    expression = &#x27;1e5 * (-x^2+70^2) * (-y * (y-150))&#x27;
  []
[]

[Materials]
  [fuel]
    type = MoltresJsonMaterial
    block = &#x27;0&#x27;
    base_file = &#x27;../eigenvalue/xsdata.json&#x27;
    material_key = &#x27;fuel&#x27;
    interp_type = LINEAR
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27;
  []
  [graphite]
    type = MoltresJsonMaterial
    block = &#x27;1&#x27;
    base_file = &#x27;../eigenvalue/xsdata.json&#x27;
    material_key = &#x27;graphite&#x27;
    interp_type = LINEAR
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.86e-3 .312 1760&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 200

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-1

  automatic_scaling = true
  compute_scaling_once = false
  resid_vs_jac_scaling_param = 0.1
  scaling_group_variables = &#x27;group1 group2; pre1 pre2 pre3 pre4 pre5 pre6; temp&#x27;

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu       NONZERO               superlu_dist&#x27;

  line_search = none

  dtmin = 1e-3
  dtmax = 10
  [TimeStepper]
    type = FunctionDT
    function = dt_func
  []
  #  [TimeStepper]
  #    type = IterationAdaptiveDT
  #    dt = .2
  #    cutback_factor = 0.4
  #    growth_factor = 1.2
  #    optimal_iterations = 20
  #  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [powernorm]
    type = ElmIntegTotFissHeatPostprocessor
    execute_on = linear
  []
  [average_temp]
    type = ElementAverageValue
    variable = temp
    execute_on = linear
  []
  [inlet_temp]
    type = SideAverageValue
    variable = temp
    boundary = fuel_bottom
  []
  [outlet_temp]
    type = SideAverageValue
    variable = temp
    boundary = fuel_top
  []
[]

[VectorPostprocessors]
  [centerline_flux]
    type = LineValueSampler
    variable = &#x27;group1 group2&#x27;
    start_point = &#x27;0 0 0&#x27;
    end_point = &#x27;0 150 0&#x27;
    num_points = 151
    sort_by = y
    execute_on = FINAL
  []
  [midplane_flux]
    type = LineValueSampler
    variable = &#x27;group1 group2&#x27;
    start_point = &#x27;0 75 0&#x27;
    end_point = &#x27;69.375 75 0&#x27;
    num_points = 100
    sort_by = x
    execute_on = FINAL
  []
[]

[Outputs]
  perf_graph = true
  #  print_linear_residuals = true
  [exodus]
    type = Exodus
  []
  [csv]
    type = CSV
    execute_on = FINAL
  []
[]

[Debug]
  #  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d2a69155-dedf-4385-9f71-fa5e0825b89c"><div class="modal-content"><h4>(problems/picard/temp.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./temp]
    initial_condition = ${ini_temp}
  [../]
[]

[AuxVariables]
  [./group1]
  [../]
  [./group2]
  [../]
  [./pre1]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre2]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre3]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre4]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre5]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
  [./pre6]
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
  [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./pres]
    type = TransientMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = &#x27;pres.i&#x27;
  [../]
[]

[Transfers]
  [./temp_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = temp
    variable = temp
  [../]
  [./pre1_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre1
    variable = pre1
  [../]
  [./pre2_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre2
    variable = pre2
  [../]
  [./pre3_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre3
    variable = pre3
  [../]
  [./pre4_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre4
    variable = pre4
  [../]
  [./pre5_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre5
    variable = pre5
  [../]
  [./pre6_from_sub]
    type = MultiAppCopyTransfer
    direction = from_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = pre6
    variable = pre6
  [../]
  [./group1_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = group1
    variable = group1
  [../]
  [./group2_to_sub]
    type = MultiAppCopyTransfer
    direction = to_multiapp
    multi_app = &#x27;pres&#x27;
    source_variable = group2
    variable = group2
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="155622ff-1d88-4ef7-9850-b7dcb2273777"><div class="modal-content"><h4>(problems/publication_level_cases/transient_single_channel_blockage/3d_auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = 3d_ss_out.e
[]

[MeshModifiers]
  # [./scale]
  #   type = Transform
  #   transform = SCALE
  #   vector_value = &#x27;1 1 ${scale}&#x27;
  # [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    scaling = 1e4
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
  [../]
  [./group2]
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
  [./primary_fuel]
    var_name_base = pre
    block = &#x27;fuel blocked_fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    init_from_file = true
    kernel_block = &#x27;fuel&#x27;
  [../]
  [./blocked_fuel]
    var_name_base = pre
    kernel_block = &#x27;blocked_fuel&#x27;
    outlet_boundaries = &#x27;blocked_fuel_top&#x27;
    u_def = 0
    v_def = 0
    w_def = 0
    nt_exp_form = false
    create_vars = false
    object_suffix = blocked
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel blocked_fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 5e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  file_base = temp
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="4c5fa844-a034-4145-86d3-12866996c2f3"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_control.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
  [peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  # nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="5efe4be7-b836-41a3-bd01-937f800e228a"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-PJFNK.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;cylinder_structured_for_msre_comp.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;graphite_bottom fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="784e8cf0-0ecc-4825-a725-dd490b44b471"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922
base_height = 136
scale = .99
height = &#x27;${fparse base_height * scale}&#x27;
width = 145
offset = 2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  [file]
    type = FileMeshGenerator
    ## Default to jac_test.msh for quicker syntax check tests.
    ## Switch to 3D mesh for actual simulations.
    # file = &#x27;3d_msre_29x29_136.msh&#x27;
    file = jac_test.msh
  []
  [scale]
    type = TransformGenerator
    input = file
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  []
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    #     initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    #     initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [nt_ic_func]
    type = ParsedFunction
    expression = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  []
[]

[Materials]
  [fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
  #   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  #   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  #   [./temp_ic]
  #     type = RandomIC
  #     variable = temp
  #     min = 922
  #     max = 1022
  #   [../]
  #   [./group1_ic]
  #     type = RandomIC
  #     variable = group1
  #     min = .5
  #     max = 1.5
  #   [../]
  #   [./group2_ic]
  #     type = RandomIC
  #     variable = group2
  #     min = .5
  #     max = 1.5
  #   [../]
  [group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  []
  [group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="61d0f615-c690-4a99-a249-8453a7db8720"><div class="modal-content"><h4>(problems/picard/temp_no_pres.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./temp]
    initial_condition = ${ini_temp}
  [../]
[]

[AuxVariables]
  [./group1]
  [../]
  [./group2]
  [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 10
  l_max_its = 100
  dtmin = 1e-3

  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 6
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console csv&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console csv&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
  csv = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b7f9db77-4bb6-44bd-b317-881a63cd1b44"><div class="modal-content"><h4>(problems/011317_notebook_add_temperature_coupling/Input_serpent.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e0
precursor_log_inlet_conc=-17
reactor_height=175 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=900

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  v_def = ${flow_velocity}
  tau = 1
  transient_simulation = true
  incompressible_flow = false
  # prec_scale = 1e5
[../]

[Mesh]
  file = &#x27;cylinder_structured.msh&#x27;
[../]


[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  create_temperature_var = false
  # temperature = ${global_temperature}
  temperature_value = ${global_temperature}
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   inlet_boundary = &#x27;fuel_bottom&#x27;
#   inlet_boundary_condition = &#x27;DirichletBC&#x27;
#   inlet_bc_value = ${precursor_log_inlet_conc}
#   outlet_boundary = &#x27;fuel_top&#x27;
#   initial_condition = ${precursor_log_inlet_conc}
#   tau = 1
#   use_source_stabilization = true
#   offset = 24
# []

# [Kernels]
#   # Temperature
#   [./temp_flow_fuel]
#     block = &#x27;fuel&#x27;
#     type = MatINSTemperatureRZ
#     variable = temp
#     rho = &#x27;rho&#x27;
#     k = &#x27;k&#x27;
#     cp = &#x27;cp&#x27;
#     uz = ${flow_velocity}
#   [../]
#   [./temp_art_diff_fuel]
#     block = &#x27;fuel&#x27;
#     type = ScalarAdvectionArtDiff
#     variable = temp
#     use_exp_form = false
#   [../]
#   [./temp_flow_moder]
#     block = &#x27;moder&#x27;
#     type = MatINSTemperatureRZ
#     variable = temp
#     rho = &#x27;rho&#x27;
#     k = &#x27;k&#x27;
#     cp = &#x27;cp&#x27;
#   [../]
#   [./temp_source]
#     type = TransientFissionHeatSource
#     variable = temp
#     nt_scale=${nt_scale}
#   [../]
#   [./temp_time_derivative]
#     type = MatINSTemperatureTimeDerivative
#     variable = temp
#     rho = &#x27;rho&#x27;
#     cp = &#x27;cp&#x27;
#   [../]
# []

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/msr2g_Th_U_two_mat_homogenization_fuel_data_func_of_fuel_temp_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/msr2g_Th_U_two_mat_homogenization_mod_data_func_of_mod_temp_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

# [BCs]
#   [./temp_inlet]
#     boundary = &#x27;fuel_bottom graphite_bottom&#x27;
#     type = DirichletBC
#     variable = temp
#     value = ${inlet_temp}
#   [../]
#   [./temp_outlet]
#     boundary = &#x27;fuel_top&#x27;
#     type = MatINSTemperatureNoBCBC
#     variable = temp
#     k = &#x27;k&#x27;
#   [../]
#   [./temp_art_diff_fuel]
#     boundary = &#x27;fuel_top&#x27;
#     type = ScalarAdvectionArtDiffNoBCBC
#     variable = temp
#     use_exp_form = false
#   [../]
# []

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  # line_search = none
  nl_rel_tol = 1e-6
  # nl_abs_tol = 1e-5
  # trans_ss_check = true
  # ss_check_tol = 8e-9

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 10
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
  [./dof_map]
    type = DOFMap
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   # [./temp_ic]
#   #   type = ConstantIC
#   #   variable = temp
#   #   value = ${inlet_temp}
#   # [../]
#   [./temp_all_ic_func]
#     type = FunctionIC
#     variable = temp
#     function = temp_ic_func
#   [../]
# []

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  # [./temp_fuel]
  #   type = ElementAverageValue
  #   variable = temp
  #   block = &#x27;fuel&#x27;
  #   # execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;csv console&#x27;
  # [../]
  # [./temp_moder]
  #   type = ElementAverageValue
  #   variable = temp
  #   block = &#x27;moder&#x27;
  #   # execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;csv console&#x27;
  # [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="1660de30-3bf0-4be4-bca1-0c58e78cab60"><div class="modal-content"><h4>(tests/coupled/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
ini_temp = 922
diri_temp = 922
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Kernels]
  #---------------------------------------------------------------------
  # Group 1 Neutronics
  #---------------------------------------------------------------------
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  []

  #---------------------------------------------------------------------
  # Group 2 Neutronics
  #---------------------------------------------------------------------
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  #---------------------------------------------------------------------
  # Temperature
  #---------------------------------------------------------------------
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  num_steps = 80

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100
  steady_state_detection = true
  steady_state_tolerance = 1e-10

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 5
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="dbc756be-ad66-406e-88aa-1477767e9a37"><div class="modal-content"><h4>(tests/coupled/auto_diff_rho_serpent.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
ini_temp = 922
diri_temp = 922
nt_scale = 1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Kernels]
  #---------------------------------------------------------------------
  # Group 1 Neutronics
  #---------------------------------------------------------------------
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  []

  #---------------------------------------------------------------------
  # Group 2 Neutronics
  #---------------------------------------------------------------------
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  #---------------------------------------------------------------------
  # Temperature
  #---------------------------------------------------------------------
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_converted_to_serpent/serpent_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_converted_to_serpent/serpent_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  num_steps = 80

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100
  steady_state_detection = true
  steady_state_tolerance = 1e-10

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 5
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho_serpent&#x27;
    execute_on = &#x27;final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e7e104bd-262c-40f1-878d-8ec44a7982be"><div class="modal-content"><h4>(problems/011717_precursors/Input_restart_rdg_module.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e16
precursor_log_inlet_conc=-25
reactor_height=115 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=temp

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  tau = 1
  transient_simulation = true
  incompressible_flow = false
[../]

[Mesh]
  file = &#x27;Input_out.e&#x27;
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  # create_temperature_var = false
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  init_nts_from_file = true
  init_temperature_from_file = true
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
  family = MONOMIAL
  order = CONSTANT
[]

[Kernels]
  # Temperature
  [./temp_flow_fuel]
    block = &#x27;fuel&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    uz = ${flow_velocity}
  [../]
  [./temp_art_diff_fuel]
    block = &#x27;fuel&#x27;
    type = ScalarAdvectionArtDiff
    variable = temp
    use_exp_form = false
  [../]
  [./temp_flow_moder]
    block = &#x27;moder&#x27;
    type = MatINSTemperatureRZ
    variable = temp
  [../]
  [./temp_source]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
[]

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DirichletBC
    variable = temp
    value = ${inlet_temp}
  [../]
  [./temp_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = MatINSTemperatureNoBCBC
    variable = temp
    k = &#x27;k&#x27;
  [../]
  [./temp_art_diff_fuel]
    boundary = &#x27;fuel_top&#x27;
    type = ScalarAdvectionArtDiffNoBCBC
    variable = temp
    use_exp_form = false
  [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  # line_search = none
  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5
  # trans_ss_check = true
  # ss_check_tol = 8e-9

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-4
    growth_factor = 1.05
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
  [./dof_map]
    type = DOFMap
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_all_ic_func]
#     type = FunctionIC
#     variable = temp
#     function = temp_ic_func
#   [../]
# []

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="43f3b86b-f378-400e-991e-ea38b337d217"><div class="modal-content"><h4>(problems/020617_mod_heat_source_one_minus_beta_fission/Input.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e16
reactor_height=115 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=temp
sigma_val=6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
[../]

[Mesh]
  file = &#x27;cylinder_structured.msh&#x27;
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  # create_temperature_var = false
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = true
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DGFunctionDiffusionDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
    function = &#x27;inlet_boundary_temp_func&#x27;
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    type = TemperatureInflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    inlet_conc = 824
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./forcing_func]
    type = ParsedFunction
    value = &#x27;1000&#x27;
  [../]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./inlet_boundary_temp_func]
    type = ParsedFunction
    value = &#x27;${inlet_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="509941e6-76bc-4fcc-9f5a-388657d25d45"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho_monotone_interp.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b7397563-464a-46fc-8f54-430dd464dc25"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # uniform_refine = 1
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 100000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    # off_diag_row = &#x27;temp pre1 pre2 pre3 pre4 pre5 pre6 temp pre1 pre2 pre3 pre4 pre5 pre6&#x27;
    # off_diag_column = &#x27;group1 group1 group1 group1 group1 group1 group1 group2 group2 group2 group2 group2 group2 group2&#x27;
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [exodus]
    type = Exodus
    file_base = &#x27;&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []

# [Adaptivity]
#   marker = errorfrac_temp
#   max_h_level = 1
#   [./Indicators]
#     [./error_temp]
#       type = GradientJumpIndicator
#       variable = temp
#       outputs = none
#     [../]
#   [../]
#   [./Markers]
#     [./errorfrac_temp]
#       type = ErrorFractionMarker
#       refine = 0.8
#       coarsen = 0.1
#       indicator = error_temp
#       outputs = none
#     [../]
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="df4782a5-458d-477e-8665-810310787134"><div class="modal-content"><h4>(problems/021417_MSRE_materials/CG_temp.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
diri_temp=908
nt_scale=1e13
reactor_height=162.56
global_temperature=temp
# global_temperature=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
#   u_def = 0
#   v_def = 0
#   w_def = ${flow_velocity}
[../]

[Mesh]
  file = &#x27;msre_22x22_correct_vol_fraction.msh&#x27;
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  create_temperature_var = true
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = false
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[Materials]
  [./fuel]
    # type = CammiFuel
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_fuel_data_func_of_fuel_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    # type = CammiModerator
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_mod_data_func_of_mod_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;fuel_bottoms moder_bottoms fuel_sides&#x27;
    type = DirichletBC
    variable = temp
    value = ${diri_temp}
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

# [Problem]
#   type = FEProblem
#   coord_type = RZ
# [../]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  print_linear_residuals = true
  perf_graph = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./diri_temp_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
#   # [./average_fission_heat]
#   #   type = AverageFissionHeat
#   #   nt_scale = ${nt_scale}
#   #   execute_on = &#x27;linear nonlinear&#x27;
#   #   outputs = &#x27;csv console&#x27;
#   #   block = &#x27;fuel&#x27;
#   # [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="f556dc4c-fa11-4975-9726-e502ff74b07b"><div class="modal-content"><h4>(problems/publication_level_cases/3d_steady_state/3d_auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
  [./group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  [../]
  [./group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="24b3fd25-0180-475e-8399-579ddadf5110"><div class="modal-content"><h4>(problems/transient-jac-test.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 147 # Cammi 147 cm/s

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  group_fluxes = &#x27;group1 group2&#x27;
  # MSRE full power = 10 MW; core volume 90 ft3
  # power = 200000
  temperature = temp
[]

[Mesh]
  type = GeneratedMesh
  dim = 2
  nx = 2
  ny = 1
  block_id = &#x27;0&#x27;
  block_name = &#x27;fuel&#x27;
[]

[MeshModifiers]
  [bounding_box]
    type = SubdomainBoundingBox
    bottom_left = &#x27;0.5 0 0&#x27;
    top_right = &#x27;1 1 0&#x27;
    block_id = &#x27;1&#x27;
    block_name = &#x27;moder&#x27;
  []
[]

[Variables]
  # [./pre1]
  # [../]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
  [temp]
    order = FIRST
    family = LAGRANGE
    scaling = 1e-3
  []
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    group_number = 1
    variable = group1
  []
  [time_group2]
    type = NtTimeDerivative
    group_number = 2
    variable = group2
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
  []

  # Temperature
  [temp_flow_fuel]
    block = &#x27;fuel&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
    uz = ${flow_velocity}
  []
  [temp_flow_moder]
    block = &#x27;moder&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
  []
  [temp_source]
    type = TransientFissionHeatSource
    variable = temp
  []
[]

# Delayed neutron precursors

[Precursors]
  var_name_base = pre
  v_def = ${flow_velocity}
  # block = &#x27;fuel&#x27;
  inlet_boundary = &#x27;bottom&#x27;
  inlet_boundary_condition = &#x27;NeumannBC&#x27;
  inlet_bc_value = 1.1
  outlet_boundary = &#x27;top&#x27;
  temperature = temp
  incompressible_flow = false
  transient_simulation = true
  use_exp_form = false
  jac_test = true
  # initial_condition = -20
[]

# [AuxVariables]
#   [./pre1_lin]
#     family = MONOMIAL
#     order = CONSTANT
#   [../]

#   [./Qf]
#     family = MONOMIAL
#     order = CONSTANT
#   [../]
# [./diffus_temp]
#   family = MONOMIAL
#   order = CONSTANT
# [../]
# [./diffus_resid]
#   family = LAGRANGE
#   order = FIRST
# [../]
# [./src_resid]
#   family = LAGRANGE
#   order = FIRST
# [../]
# [./bc_resid]
#   family = LAGRANGE
#   order = FIRST
# [../]
# [./tot_resid]
#   family = LAGRANGE
#   order = FIRST
# [../]
# [../]

# [AuxKernels]
#   [./pre1_lin]
#     variable = pre1_lin
#     density_log = pre1
#     type = Density
#   [../]

#   [./Qf]
#     type = FissionHeatSourceAux
#     variable = Qf
#     tot_fissions = tot_fissions
#   [../]
# [./diffus_temp]
#   type = MatDiffusionAux
#   variable = diffus_temp
#   diffuse_var = temp
#   prop_name = &#x27;k&#x27;
# [../]
# []

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;msr2g_enrU_mod_953_fuel_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.0123 3.327e-3 1357&#x27; # Cammi 2011 at 908 K
  []
  [moder]
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;msr2g_enrU_fuel_922_mod_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.312 1.843e-3 1760&#x27; # Cammi 2011 at 908 K
  []
[]

[BCs]
  # [./temp_inlet]
  #   boundary = &#x27;fuel_bottom graphite_bottom&#x27;
  #   type = DirichletBC
  #   variable = temp
  #   value = 900
  # [../]
  # [./temp_outlet]
  #   boundary = &#x27;fuel_top&#x27;
  #   type = MatINSTemperatureNoBCBC
  #   variable = temp
  #   k = &#x27;k&#x27;
  # [../]
  # [./group1_vacuum]
  #   type = VacuumBC
  #   variable = group1
  #   boundary = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  # [../]
  # [./group2_vacuum]
  #   type = VacuumBC
  #   variable = group2
  #   boundary = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  # [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
  kernel_coverage_check = false
[]

[Executioner]
  type = Transient
  end_time = 10

  nl_abs_tol = 1e-11

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor -snes_test_display&#x27;
  # This system will not converge with default preconditioning; need to use asm
  petsc_options_iname = &#x27;-snes_type&#x27;
  petsc_options_value = &#x27;test&#x27;

  dtmin = 1e-7
  [TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-4
    growth_factor = 1.2
    optimal_iterations = 20
    nl_max_its = 50
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

# [Postprocessors]
#   [./bnorm]
#     type = ElmIntegTotFissNtsPostprocessor
#     group_fluxes = &#x27;group1 group2&#x27;
#     execute_on = linear
#   [../]
#   [./tot_fissions]
#     type = ElmIntegTotFissPostprocessor
#     execute_on = linear
#   [../]
#   [./group1norm]
#     type = ElementIntegralVariablePostprocessor
#     variable = group1
#     execute_on = linear
#   [../]
#   [./group2norm]
#     type = ElementIntegralVariablePostprocessor
#     variable = group2
#     execute_on = linear
#   [../]
#   [./group1max]
#     type = NodalExtremeValue
value_type = max
#     variable = group1
#     execute_on = timestep_end
#   [../]
#   [./group2max]
#     type = NodalExtremeValue
value_type = max
#     variable = group2
#     execute_on = timestep_end
#   [../]
#   [./group1diff]
#     type = ElementL2Diff
#     variable = group1
#     execute_on = &#x27;linear timestep_end&#x27;
#     use_displaced_mesh = false
#   [../]
# []

[Outputs]
  [out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  []
  [dof_map]
    type = DOFMap
  []

[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [temp_ic]
    type = RandomIC
    variable = temp
    min = 900
    max = 1400
  []
  [group1_ic]
    type = RandomIC
    variable = group1
    min = 0
    max = 600
  []
  [group2_ic]
    type = RandomIC
    variable = group2
    min = 0
    max = 600
  []
  # [./pre1_ic]
  #   type = ConstantIC
  #   variable = pre1
  #   value = -20
  # [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="98327408-9cac-4ee2-8451-cbe3912a6d9f"><div class="modal-content"><h4>(problems/012017_temperature_to_dg/Input.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e16
reactor_height=115 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=temp
sigma_val=6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
[../]

[Mesh]
  file = &#x27;cylinder_structured.msh&#x27;
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  # create_temperature_var = false
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = true
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DGFunctionDiffusionDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
    function = &#x27;inlet_boundary_temp_func&#x27;
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    type = TemperatureInflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    inlet_conc = 824
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./forcing_func]
    type = ParsedFunction
    value = &#x27;1000&#x27;
  [../]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./inlet_boundary_temp_func]
    type = ParsedFunction
    value = &#x27;${inlet_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="cad156ba-5a1a-4006-a36e-eb2f89183530"><div class="modal-content"><h4>(problems/LOSCA/HXFailure/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
  loop_precursors = true
  multi_app = loopApp
  is_loopapp = false
  inlet_boundaries = &#x27;fuel_bottoms&#x27;
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
    group_number = 1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-pc_type&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d241ef2c-1a9f-49bb-ade8-9ff04653ea84"><div class="modal-content"><h4>(problems/020617_mod_heat_source_one_minus_beta_fission/gamma_source_check.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
  type = GeneratedMesh
  dim = 2
  nx = 10
  ny = 10
[../]


[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = 1
    group_fluxes = &#x27;1 1&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = 1 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
[]

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;0&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = temp
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;1&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = temp
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = ConstantIC
    variable = temp
    value = 824
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;0&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;0&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;0&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="1547cf7e-06c7-4177-8ad0-0c167ddf479f"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale-mod-heat-PJFNK.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;cylinder_structured_for_msre_comp.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;graphite_bottom fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="cfeea176-aa9c-4d73-9513-a8f7a59bf9ee"><div class="modal-content"><h4>(problems/2017_annals_pub_msre_compare/4group.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922
gamma_frac = .075
R = 73
H = 162.56

[GlobalParams]
  num_groups = 4
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  nt_scale = ${nt_scale}
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Variables]
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  create_temperature_var = false
  scaling = 1e-4
  pre_blocks = &#x27;fuel&#x27;
[]

[Kernels]
  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
    gamma = gamma_func
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [temp_diri_cg]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = FlexiblePostprocessorDirichletBC
    postprocessor = coreEndTemp
    offset = -27.8
    variable = temp
  []
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
    gamma = gamma_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [gamma_func]
    type = ParsedFunction
    expression = &#x27;${gamma_frac} * pi^2 / 4 * cos(pi * x / (2. * ${R})) * sin(pi * y / ${H})&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4g_fuel_rod0_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4g_moder_rod0_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [TimeStepper]
    type = PostprocessorDT
    postprocessor = limit_k
    dt = 1e-3
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
  [coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  []
  [limit_k]
    type = LimitK
    execute_on = &#x27;timestep_end&#x27;
    k_postprocessor = multiplication
    growth_factor = 1.2
    cutback_factor = .4
    k_threshold = 1.5
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d088893e-ee07-4abc-b683-3f4b4ca90e8f"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-one-channel-two-mat-scale.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;cylinder_structured_for_msre_comp.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top graphite_bottom graphite_top&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;graphite_bottom fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="af42ddef-5027-4703-8009-69ca5162578e"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_condition = 1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_condition = 1
  [../]
  [./temp]
    scaling = 1e-4
    initial_condition = 930
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-5
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="c107cc24-9f45-4564-b4dd-842286ae4116"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_restart.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_auto_diff_rho_out.e&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
    scaling = 1e4
  []
  [temp]
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
  init_from_file = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="3d3d98f6-7590-48a4-8fb6-ad68e4ac7eed"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;NEWTON&#x27;
  # solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  # exodus = true
  nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="f15874d3-8c81-43b0-a254-08c259c980de"><div class="modal-content"><h4>(problems/picard/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="91687ca1-c9f0-4d20-97dd-221cfd3ca25b"><div class="modal-content"><h4>(problems/rodded2D/rodded.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 4
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_rodded_lattice.msh&#x27;
[../]

[Problem]
  coord_type = RZ
  kernel_coverage_check = false
[]

[Variables]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
  [./rodPosition]
    family = SCALAR
    order = FIRST
    initial_condition = 0.0
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall cRod_top cRod_bot&#x27;
  create_temperature_var = false
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[ScalarKernels]
  [./tdRodPos]
    type = ODETimeDerivative
    variable = rodPosition
  [../]
  [./rodposForce]
    type = ParsedODEKernel
    function = &#x27;rodPosition - 100&#x27;
    variable = rodPosition
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gfuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  [./cRod]
    type = RoddedMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;cRod&#x27;
    rodDimension = &#x27;y&#x27;
    rodPosition = rodPosition
    absorb_factor = 1e6 # how much more absorbing than usual in absorbing region?
  [../]
  [./rho_crod]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;cRod&#x27;
  [../]

[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  solve_type = &#x27;PJFNK&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100
  [./TimeStepper]
    type = PostprocessorDT
    postprocessor = limit_k
    dt = 0.1
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    # ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
     type = AverageFissionHeat
     nt_scale = ${nt_scale}
     execute_on = &#x27;linear nonlinear&#x27;
     outputs = &#x27;console&#x27;
     block = &#x27;fuel&#x27;
  [../]
  [./limit_k]
    type = LimitK
    execute_on = &#x27;timestep_end&#x27;
    k_postprocessor = multiplication
    growth_factor = 1.2
    cutback_factor = .4
    k_threshold = 1.5
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  execute_on = &#x27;timestep_end final&#x27;
  file_base = &#x27;out&#x27;
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e9aaddf2-c0b0-4d81-9933-3a4b46f3adf7"><div class="modal-content"><h4>(problems/011717_precursors/Input.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e16
precursor_log_inlet_conc=-17
reactor_height=115 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=temp

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  v_def = ${flow_velocity}
  tau = 1
  transient_simulation = true
  incompressible_flow = false
  # prec_scale = 1e5
[../]

[Mesh]
  file = &#x27;cylinder_structured.msh&#x27;
[../]


[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  # create_temperature_var = false
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  inlet_boundary = &#x27;fuel_bottom&#x27;
  inlet_boundary_condition = &#x27;DirichletBC&#x27;
  inlet_bc_value = ${precursor_log_inlet_conc}
  outlet_boundary = &#x27;fuel_top&#x27;
  initial_condition = ${precursor_log_inlet_conc}
  tau = 1
  use_source_stabilization = true
  offset = 24
[]

[Kernels]
  # Temperature
  [./temp_flow_fuel]
    block = &#x27;fuel&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
    uz = ${flow_velocity}
  [../]
  [./temp_art_diff_fuel]
    block = &#x27;fuel&#x27;
    type = ScalarAdvectionArtDiff
    variable = temp
    use_exp_form = false
  [../]
  [./temp_flow_moder]
    block = &#x27;moder&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
  [../]
  [./temp_source]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
    rho = &#x27;rho&#x27;
    cp = &#x27;cp&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DirichletBC
    variable = temp
    value = ${inlet_temp}
  [../]
  [./temp_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = MatINSTemperatureNoBCBC
    variable = temp
    k = &#x27;k&#x27;
  [../]
  [./temp_art_diff_fuel]
    boundary = &#x27;fuel_top&#x27;
    type = ScalarAdvectionArtDiffNoBCBC
    variable = temp
    use_exp_form = false
  [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  # line_search = none
  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5
  # trans_ss_check = true
  # ss_check_tol = 8e-9

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 10
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-4
    growth_factor = 1.05
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
  [./dof_map]
    type = DOFMap
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  # [./temp_ic]
  #   type = ConstantIC
  #   variable = temp
  #   value = ${inlet_temp}
  # [../]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="8d3567ed-a1ae-4fdd-b85c-2b2490c52214"><div class="modal-content"><h4>(problems/011317_notebook_perfectly_bracketed_critical_buckling_height_from_newt/Input.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e0
precursor_log_inlet_conc=-17
reactor_height=115 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=950

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  v_def = ${flow_velocity}
  tau = 1
  transient_simulation = true
  incompressible_flow = false
  # prec_scale = 1e5
[../]

[Mesh]
  file = &#x27;cylinder_structured.msh&#x27;
[../]


[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  create_temperature_var = false
  # temperature = ${global_temperature}
  temperature_value = ${global_temperature}
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   inlet_boundary = &#x27;fuel_bottom&#x27;
#   inlet_boundary_condition = &#x27;DirichletBC&#x27;
#   inlet_bc_value = ${precursor_log_inlet_conc}
#   outlet_boundary = &#x27;fuel_top&#x27;
#   initial_condition = ${precursor_log_inlet_conc}
#   tau = 1
#   use_source_stabilization = true
#   offset = 24
# []

# [Kernels]
#   # Temperature
#   [./temp_flow_fuel]
#     block = &#x27;fuel&#x27;
#     type = MatINSTemperatureRZ
#     variable = temp
#     rho = &#x27;rho&#x27;
#     k = &#x27;k&#x27;
#     cp = &#x27;cp&#x27;
#     uz = ${flow_velocity}
#   [../]
#   [./temp_art_diff_fuel]
#     block = &#x27;fuel&#x27;
#     type = ScalarAdvectionArtDiff
#     variable = temp
#     use_exp_form = false
#   [../]
#   [./temp_flow_moder]
#     block = &#x27;moder&#x27;
#     type = MatINSTemperatureRZ
#     variable = temp
#     rho = &#x27;rho&#x27;
#     k = &#x27;k&#x27;
#     cp = &#x27;cp&#x27;
#   [../]
#   [./temp_source]
#     type = TransientFissionHeatSource
#     variable = temp
#     nt_scale=${nt_scale}
#   [../]
#   [./temp_time_derivative]
#     type = MatINSTemperatureTimeDerivative
#     variable = temp
#     rho = &#x27;rho&#x27;
#     cp = &#x27;cp&#x27;
#   [../]
# []

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

# [BCs]
#   [./temp_inlet]
#     boundary = &#x27;fuel_bottom graphite_bottom&#x27;
#     type = DirichletBC
#     variable = temp
#     value = ${inlet_temp}
#   [../]
#   [./temp_outlet]
#     boundary = &#x27;fuel_top&#x27;
#     type = MatINSTemperatureNoBCBC
#     variable = temp
#     k = &#x27;k&#x27;
#   [../]
#   [./temp_art_diff_fuel]
#     boundary = &#x27;fuel_top&#x27;
#     type = ScalarAdvectionArtDiffNoBCBC
#     variable = temp
#     use_exp_form = false
#   [../]
# []

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  # line_search = none
  nl_rel_tol = 1e-6
  # nl_abs_tol = 1e-5
  # trans_ss_check = true
  # ss_check_tol = 8e-9

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 10
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
  [./dof_map]
    type = DOFMap
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   # [./temp_ic]
#   #   type = ConstantIC
#   #   variable = temp
#   #   value = ${inlet_temp}
#   # [../]
#   [./temp_all_ic_func]
#     type = FunctionIC
#     variable = temp
#     function = temp_ic_func
#   [../]
# []

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  # [./temp_fuel]
  #   type = ElementAverageValue
  #   variable = temp
  #   block = &#x27;fuel&#x27;
  #   # execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;csv console&#x27;
  # [../]
  # [./temp_moder]
  #   type = ElementAverageValue
  #   variable = temp
  #   block = &#x27;moder&#x27;
  #   # execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;csv console&#x27;
  # [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="932607e0-b583-42fb-bf34-ab24f2dd111b"><div class="modal-content"><h4>(problems/LOSCA/HXFailure/sub.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 0
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  # account_delayed = true
[]

[Mesh]
  file = &#x27;../sub.e&#x27;
[]


[Variables]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
    family = MONOMIAL
    order = CONSTANT
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  outlet_boundaries = &#x27;right&#x27;
  u_def = ${flow_velocity}
  v_def = 0
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
  loop_precursors = true
  multi_app = loopApp
  is_loopapp = true
  inlet_boundaries = left
 [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_source_fuel]
  #   type = TransientFissionHeatSource
  #   variable = temp
  #   nt_scale=${nt_scale}
  # [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  # [./temp_diffusion]
  #   type = MatDiffusion
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
  # [./temp_advection_fuel]
  #   type = ConservativeTemperatureAdvection
  #   velocity = &#x27;${flow_velocity} 0 0&#x27;
  #   variable = temp
  # [../]
[]

[DGKernels]
  [./temp_adv]
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]


[DiracKernels]
  [./heat_exchanger]
    type = DiracHX
    variable = temp
    point = &#x27;250 0 0&#x27;
    power = 4e3
  [../]
[]


[BCs]
  [./fuel_bottoms_looped]
    boundary = &#x27;left&#x27;
    type = PostprocessorTemperatureInflowBC
    postprocessor = coreEndTemp
    variable = temp
    uu = ${flow_velocity}
  [../]
  # [./diri]
  #   boundary = &#x27;left&#x27;
  #   type = DirichletBC
  #   variable = temp
  #   value = 930
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;right&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]

[Functions]
  [./heatRemovalFcn]
    type = ParsedFunction
    value = &#x27;4e3 * ( 1 - tanh( (t-5) ) )&#x27; # start losing cooling at t=5s
  [../]
[]

[Controls]
  [./hxFuncCtrl]
    type = RealFunctionControl
    parameter = &#x27;*/*/power&#x27;
    function = &#x27;heatRemovalFcn&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    outputs = &#x27;exodus console&#x27;
  [../]
  [./loopEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;right&#x27;
  [../]
  [./coreEndTemp]
    type = Receiver
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;sub&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="46ab4af0-6915-4d1e-8f60-64f7f905a38d"><div class="modal-content"><h4>(problems/LOFA/steady/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text"># walk the reactor into steady state with an attached primary loop

flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../2d_lattice_structured.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[PrecursorKernel]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_postpr_inlet]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    variable = temp
    postprocessor = inlet_mean_temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

#[Materials]
#  [./fuel]
#    type = GenericMoltresMaterial
#    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
#    interp_type = &#x27;spline&#x27;
#    block = &#x27;fuel&#x27;
#  [../]
#  [./rho_fuel]
#    type = DerivativeParsedMaterial
#    f_name = rho
#    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  # fuel cp function
#  [./cp_fuel]
#    type = DerivativeParsedMaterial
#    f_name = cp
#    function = &#x27;1967 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  # fuel k function
#  [./k_fuel]
#    type = DerivativeParsedMaterial
#    f_name = k
#    function = &#x27;0.0553 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;fuel&#x27;
#  [../]
#  [./moder]
#    type = GenericMoltresMaterial
#    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
#    interp_type = &#x27;spline&#x27;
#    block = &#x27;moder&#x27;
#  [../]
#  [./rho_moder]
#    type = DerivativeParsedMaterial
#    f_name = rho
#    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#  # moder cp fcn
#  [./cp_moder]
#    type = DerivativeParsedMaterial
#    f_name = cp
#    function = &#x27;1760 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#  # moder k fcn
#  [./k_moder]
#    type = DerivativeParsedMaterial
#    f_name = k
#    function = &#x27;.312 + 1e-16 * temp&#x27;
#    args = &#x27;temp&#x27;
#    derivative_order = 1
#    block = &#x27;moder&#x27;
#  [../]
#[]
[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 100

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  dtmax = 100
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  #multiapp
  [./inlet_mean_temp]
    type = Receiver
    execute_on = &#x27;timestep_begin&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = &#x27;initial timestep_begin&#x27;
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = average
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="7d7bf081-c8c2-41d1-b664-7ae204fb8f2a"><div class="modal-content"><h4>(problems/transient-axi-nts-temp-delayed.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
nt_scale=1e18

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  group_fluxes = &#x27;group1 group2&#x27;
[../]

[Mesh]
  file = &#x27;axisymm_cylinder.msh&#x27;
[../]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
    # scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    group_number = 1
    variable = group1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    group_number = 2
    variable = group2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
    temperature = temp
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
    temperature = temp
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
    temperature = temp
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
    temperature = temp
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    num_groups = 2
    group_fluxes = &#x27;group1 group2&#x27;
    temperature = temp
  [../]

  # Temperature
  [./temp_flow_fuel]
    block = &#x27;fuel&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
    uz = ${flow_velocity}
  [../]
  [./temp_flow_moder]
    block = &#x27;moder&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
  [../]
  [./temp_source]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
    rho = &#x27;rho&#x27;
    cp = &#x27;cp&#x27;
  [../]
[]

# Delayed neutron precursors

# [Precursors]
#   var_name_base = pre
#   v_def = ${flow_velocity}
#   block = &#x27;fuel&#x27;
#   inlet_boundary = &#x27;fuel_bottom&#x27;
#   inlet_boundary_condition = &#x27;DirichletBC&#x27;
#   inlet_bc_value = -20
#   outlet_boundary = &#x27;fuel_top&#x27;
#   temperature = temp
#   incompressible_flow = false
#   transient_simulation = true
#   use_exp_form = true
#   initial_condition = -20
# []

# [AuxVariables]
# []

# [AuxKernels]
# []

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;msr2g_enrU_mod_953_fuel_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.0123 3.327e-3 1357&#x27; # Cammi 2011 at 908 K
    # prop_values = &#x27;.123 3.327e-3 1357&#x27;
    temperature = temp
  [../]
  [./moder]
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;msr2g_enrU_fuel_922_mod_interp_&#x27;
    num_groups = 2
    num_precursor_groups = 8
    prop_names = &#x27;k rho cp&#x27;
    prop_values = &#x27;.312 1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    # prop_values = &#x27;3.12 1.843e-3 1760&#x27;
    temperature = temp
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DirichletBC
    variable = temp
    value = ${inlet_temp}
  [../]
  [./temp_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = MatINSTemperatureNoBCBC
    variable = temp
    k = &#x27;k&#x27;
  [../]
  [./group1_vacuum]
    type = VacuumBC
    variable = group1
    boundary = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  [../]
  [./group2_vacuum]
    type = VacuumBC
    variable = group2
    boundary = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  nl_abs_tol = 4e-9
  trans_ss_check = true
  ss_check_tol = 4e-9
  nl_rel_tol = 1e-6

  # solve_type = &#x27;PJFNK&#x27;
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # This system will not converge with default preconditioning; need to use asm
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -sub_ksp_type -pc_asm_overlap -ksp_gmres_restart -snes_linesearch_mindlambda&#x27;
  # petsc_options_value = &#x27;asm lu preonly 2 31 1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 superlu_dist&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-6
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-6
    growth_factor = 1.2
    optimal_iterations = 10
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_ic]
    type = ConstantIC
    variable = temp
    value = ${inlet_temp}
  [../]
  [./group1_ic]
    type = ConstantIC
    variable = group1
    value = 1
  [../]
  [./group2_ic]
    type = ConstantIC
    variable = group2
    value = 1
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
    # outputs = &#x27;csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
    # outputs = &#x27;csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
    # outputs = &#x27;csv&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e878278f-81a0-4f78-84a6-1cc52967d903"><div class="modal-content"><h4>(problems/011317_notebook_add_temperature_coupling/Input.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e16
precursor_log_inlet_conc=-17
reactor_height=115 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=temp

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  v_def = ${flow_velocity}
  tau = 1
  transient_simulation = true
  incompressible_flow = false
  # prec_scale = 1e5
[../]

[Mesh]
  file = &#x27;cylinder_structured.msh&#x27;
[../]


[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  # create_temperature_var = false
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   inlet_boundary = &#x27;fuel_bottom&#x27;
#   inlet_boundary_condition = &#x27;DirichletBC&#x27;
#   inlet_bc_value = ${precursor_log_inlet_conc}
#   outlet_boundary = &#x27;fuel_top&#x27;
#   initial_condition = ${precursor_log_inlet_conc}
#   tau = 1
#   use_source_stabilization = true
#   offset = 24
# []

[Kernels]
  # Temperature
  [./temp_flow_fuel]
    block = &#x27;fuel&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
    uz = ${flow_velocity}
  [../]
  [./temp_art_diff_fuel]
    block = &#x27;fuel&#x27;
    type = ScalarAdvectionArtDiff
    variable = temp
    use_exp_form = false
  [../]
  [./temp_flow_moder]
    block = &#x27;moder&#x27;
    type = MatINSTemperatureRZ
    variable = temp
    rho = &#x27;rho&#x27;
    k = &#x27;k&#x27;
    cp = &#x27;cp&#x27;
  [../]
  [./temp_source]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
    rho = &#x27;rho&#x27;
    cp = &#x27;cp&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DirichletBC
    variable = temp
    value = ${inlet_temp}
  [../]
  [./temp_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = MatINSTemperatureNoBCBC
    variable = temp
    k = &#x27;k&#x27;
  [../]
  [./temp_art_diff_fuel]
    boundary = &#x27;fuel_top&#x27;
    type = ScalarAdvectionArtDiffNoBCBC
    variable = temp
    use_exp_form = false
  [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  # line_search = none
  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5
  # trans_ss_check = true
  # ss_check_tol = 8e-9

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 10
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-4
    growth_factor = 1.05
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
  [./dof_map]
    type = DOFMap
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  # [./temp_ic]
  #   type = ConstantIC
  #   variable = temp
  #   value = ${inlet_temp}
  # [../]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="78e8b1a9-4a76-4f67-bbbb-b4bae8382bbb"><div class="modal-content"><h4>(problems/2017_annals_pub_msre_compare/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922
gamma_frac = .075
R = 70.1675
H = 162.56

[GlobalParams]
  num_groups = 4
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  nt_scale = ${nt_scale}
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Variables]
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  create_temperature_var = false
  scaling = 1e-4
  pre_blocks = &#x27;fuel&#x27;
[]

[Kernels]
  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
    gamma = gamma_func
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [temp_diri_cg]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = FlexiblePostprocessorDirichletBC
    postprocessor = coreEndTemp
    offset = -27.8
    variable = temp
  []
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
    gamma = gamma_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [gamma_func]
    type = ParsedFunction
    expression = &#x27;${gamma_frac} * pi^2 / 4 * cos(pi * x / (2. * ${R})) * sin(pi * y / ${H})&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4g_fuel_rod0_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4g_moder_rod0_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [TimeStepper]
    type = PostprocessorDT
    postprocessor = limit_k
    dt = 1e-3
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
  [coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  []
  [limit_k]
    type = LimitK
    execute_on = &#x27;timestep_end&#x27;
    k_postprocessor = multiplication
    growth_factor = 1.2
    cutback_factor = .4
    k_threshold = 1.5
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="54722e4e-69b3-42bb-a827-5e541605e2dd"><div class="modal-content"><h4>(problems/072017_dg_temperature/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
sigma_val=.6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
    order = FIRST
    family = MONOMIAL
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    type = DGDiffusionPostprocessorDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diffusivity = &#x27;k&#x27;
    postprocessor = coreEndTemp
    offset = -50
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    type = PostprocessorTemperatureInflowBC
    variable = temp
    uu = 0
    vv = ${flow_velocity}
    ww = 0
    postprocessor = coreEndTemp
    offset = -50
  [../]
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  [../]
[]

[VectorPostprocessors]
  [./outlet_temps]
    type = LineValueSampler
    start_point = &#x27;0 153 0&#x27;
    end_point = &#x27;72.5 153 0&#x27;
    num_points = 1000
    variable = temp
    sort_by = &#x27;x&#x27;
    outputs = &#x27;csv&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./csv]
    type = CSV
    execute_on = &#x27;final&#x27;
  [../]
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9e059621-434b-4f85-bf8d-24d917d339ac"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function_moderator_heating.i)</h4><pre class="moose-pre"><code class="language-text"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 33.28
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_func = vel_x_func
  v_func = vel_y_func
  w_func = vel_z_func
  constant_velocity_values = false
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = VelocityFunctionTemperatureAdvection
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [vel_x_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_y_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_z_func]
    type = ParsedFunction
    expression = &#x27;${fuel_velocity_max_inlet} * cos(pi * x / (2 * ${fuel_sq_rad})) * cos(pi * y / (2 * ${fuel_sq_rad}))&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 100000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200
  line_search = none

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  []
  [peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="ac17569d-766a-4c25-87ca-f5e37cea885b"><div class="modal-content"><h4>(problems/LOSCA/sub.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 0
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  # account_delayed = true
[]

[Mesh]
  type = GeneratedMesh
  dim = 1
  nx = 600
  xmax = 500
  elem_type = EDGE2
[../]

[Variables]
  [./temp]
    initial_condition = 930 #approx steady outlet of other problem
    scaling = 1e-4
    family = MONOMIAL
    order = CONSTANT
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  outlet_boundaries = &#x27;right&#x27;
  u_def = ${flow_velocity}
  v_def = 0
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  loop_precursors = true
  multi_app = loopApp
  is_loopapp = true
  inlet_boundaries = left

 [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_source_fuel]
  #   type = TransientFissionHeatSource
  #   variable = temp
  #   nt_scale=${nt_scale}
  # [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  # [./temp_diffusion]
  #   type = MatDiffusion
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
  # [./temp_advection_fuel]
  #   type = ConservativeTemperatureAdvection
  #   velocity = &#x27;${flow_velocity} 0 0&#x27;
  #   variable = temp
  # [../]
[]

[DGKernels]
  [./temp_adv]
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]


[DiracKernels]
  [./heat_exchanger]
    type = DiracHX
    variable = temp
    power = 4e3 # see controls
    point = &#x27;250 0 0&#x27;
  [../]
[]


[BCs]
  [./fuel_bottoms_looped]
    boundary = &#x27;left&#x27;
    type = PostprocessorTemperatureInflowBC
    postprocessor = coreEndTemp
    variable = temp
    uu = ${flow_velocity}
  [../]
  # [./diri]
  #   boundary = &#x27;left&#x27;
  #   type = DirichletBC
  #   variable = temp
  #   value = 930
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;right&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    outputs = &#x27;exodus console&#x27;
  [../]
  [./loopEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;right&#x27;
  [../]
  [./coreEndTemp]
    type = Receiver
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;sub&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# connect inlet and outlet to multiapp
# [Transfers]
#   [./to_core]
#     type = MultiAppPostprocessorTransfer
#     multi_app = MoltresApp
#     from_postprocessor = loopEndTemp
#     to_postprocessor = inlet_mean_temp
#     direction = to_multiapp
#   [../]
#   [./from_core]
#     type = MultiAppPostprocessorTransfer
#     multi_app = MoltresApp
#     from_postprocessor = coreEndTemp
#     to_postprocessor = coreEndTemp
#     direction = to_multiapp
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="7e4ba0d7-6977-4035-a509-5abb31c8894b"><div class="modal-content"><h4>(tests/temp/temp.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  sss2_input = false
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured_smaller.msh&#x27;
[]

[Variables]
  [temp]
    initial_condition = ${ini_temp}
  []
[]

[Kernels]
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
    group_fluxes = &#x27;1 1&#x27;
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp}&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = temp
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = temp
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Steady
  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;console&#x27;
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="3677a7ba-43b5-4c7a-9a1b-5d2bf94b95ed"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/unit-cell-heat-and-nts.i)</h4><pre class="moose-pre"><code class="language-text"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = msre_squares.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    scaling = 1e2
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    scaling = 1e2
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
    scaling = 1e-4
    # initial_condition = 900
  [../]
[]

[AuxVariables]
  # [./vel_x]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./vel_y]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./vel_z]
  #   block = &#x27;fuel&#x27;
  # [../]
  # [./p]
  #   block = &#x27;fuel&#x27;
  # [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_fuel_transport]
  #   type = INSTemperature
  #   u = vel_x
  #   v = vel_y
  #   w = vel_z
  #   variable = temp
  #   block = &#x27;fuel&#x27;
  # [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 21.73&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    # block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottoms&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 21.73&#x27;
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;linear&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-2
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;linear&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    ksp_norm = &#x27;none&#x27;
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # line_search = &#x27;none&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-5
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

# [MultiApps]
#   [./sub]
#     type = FullSolveMultiApp
#     app_type = MoltresApp
#     positions = &#x27;0 0 0&#x27;
#     input_files = solution_aux_exodus.i
#     execute_on = &#x27;initial&#x27;
#   [../]
# []

# [Transfers]
#   [./vel_x]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_x
#     variable = vel_x
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./vel_y]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_y
#     variable = vel_y
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./vel_z]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = vel_z
#     variable = vel_z
#     execute_on = &#x27;initial&#x27;
#   [../]
#   [./p]
#     type = MultiAppNearestNodeTransfer
#     direction = from_multiapp
#     multi_app = sub
#     source_variable = p
#     variable = p
#     execute_on = &#x27;initial&#x27;
#   [../]
# []

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    # outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    # outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="ea5628cf-93dc-46a1-9f0e-c0b68cb3b1e6"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin.i)</h4><pre class="moose-pre"><code class="language-text"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 39.94
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="8fa1a722-88de-4ee3-8061-2587f93960e5"><div class="modal-content"><h4>(problems/020617_mod_heat_source_one_minus_beta_fission/Input_PJFNK.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e16
reactor_height=115 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=temp
sigma_val=6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
[../]

[Mesh]
  file = &#x27;cylinder_structured.msh&#x27;
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  # create_temperature_var = false
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = true
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DGFunctionDiffusionDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
    function = &#x27;inlet_boundary_temp_func&#x27;
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    type = TemperatureInflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    inlet_conc = 824
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -ksp_gmres_restart&#x27;
  petsc_options_value = &#x27;asm      lu           2               preonly       31&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  print_linear_residuals = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./forcing_func]
    type = ParsedFunction
    value = &#x27;1000&#x27;
  [../]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./inlet_boundary_temp_func]
    type = ParsedFunction
    value = &#x27;${inlet_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="53d7282b-443c-4dc5-937b-f89159a8c534"><div class="modal-content"><h4>(problems/012017_temperature_to_dg/test_mat_props.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e16
reactor_height=115 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=temp
sigma_val=6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
[../]

[Mesh]
  file = &#x27;one_element.msh&#x27;
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  # create_temperature_var = false
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = true
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./source]
  #   type = UserForcingFunction
  #   variable = temp
  #   function = &#x27;forcing_func&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_fuel_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/newt_mod_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;fuel_bottom graphite_bottom&#x27;
    type = DGFunctionDiffusionDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
    function = &#x27;inlet_boundary_temp_func&#x27;
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    type = TemperatureInflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    inlet_conc = 824
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 1e-3

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./forcing_func]
    type = ParsedFunction
    value = &#x27;1000&#x27;
  [../]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./inlet_boundary_temp_func]
    type = ParsedFunction
    value = &#x27;${inlet_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    # execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="a4458145-e786-4e54-a5c4-63fae5009791"><div class="modal-content"><h4>(problems/021417_MSRE_materials/Input.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
diri_temp=908
nt_scale=1e13
reactor_height=162.56
global_temperature=temp
# global_temperature=922
sigma_val=6

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
#   u_def = 0
#   v_def = 0
#   w_def = ${flow_velocity}
[../]

[Mesh]
  # file = &#x27;msre_22x22_correct_vol_fraction.msh&#x27;
  file = msre_cuboid_3x3.msh
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;boundary&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  create_temperature_var = true
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = true
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[DGKernels]
  [./temp_advection_fuel]
    block = &#x27;fuel&#x27;
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
  [./temp_diffusion]
    type = DGDiffusion
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
  [../]
[]

[Materials]
  [./fuel]
    # type = CammiFuel
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_fuel_data_func_of_fuel_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    # type = CammiModerator
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_mod_data_func_of_mod_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_dirichlet_diffusion_inlet]
    boundary = &#x27;temp_diri_bnd&#x27;
    type = DGFunctionDiffusionDirichletBC
    variable = temp
    sigma = ${sigma_val}
    epsilon = -1
    diff = &#x27;k&#x27;
    function = &#x27;diri_temp_func&#x27;
  [../]
  [./temp_advection_inlet]
    boundary = &#x27;temp_inflow_bnd&#x27;
    type = TemperatureInflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    inlet_conc = ${diri_temp}
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;temp_outflow_bnd&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

# [Problem]
#   type = FEProblem
#   coord_type = RZ
# [../]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type&#x27; # -ksp_gmres_restart&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly&#x27;      # 31&#x27;

  nl_max_its = 20
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  print_linear_residuals = true
  perf_graph = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./diri_temp_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
#   # [./average_fission_heat]
#   #   type = AverageFissionHeat
#   #   nt_scale = ${nt_scale}
#   #   execute_on = &#x27;linear nonlinear&#x27;
#   #   outputs = &#x27;csv console&#x27;
#   #   block = &#x27;fuel&#x27;
#   # [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="8335bd4e-4cba-4775-8269-a6c6f3114e68"><div class="modal-content"><h4>(problems/publication_level_cases/manuBench/manuboxNoStokes.i)</h4><pre class="moose-pre"><code class="language-text">library_path=/home/gavin/projects/moose/modules/navier_stokes/lib/

[GlobalParams]
  # neutronics
  num_groups=6
  num_precursor_groups=8
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4 group5 group6&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6 pre7 pre8&#x27;
  account_delayed = true
[]

[Mesh]
  type = GeneratedMesh
  dim = 2
  xmin = 0
  xmax = 1.0
  ymin = 0
  ymax = 1.0
  elem_type = QUAD9
  nx = 20
  ny = 20
[]

[Variables]
  # temperature
  [./temp]
    family = LAGRANGE
    order = FIRST
    initial_condition = 900
    scaling = 1e-4
  [../]
[]

# nt -&gt; neutron
[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;top bottom left right&#x27;
  create_temperature_var = false
  eigen = true
  scaling = 1e-10
[]

[Precursors]
  [./preblock]
    var_name_base = pre
    # block = &#x27;fuel&#x27;
    constant_velocity_values = false
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    outlet_boundaries = &#x27;&#x27;
    transient = false
    u_func = 0.0
    v_func = 0.0
    w_func = 0.0
  [../]
[]

[Kernels]
    [./heating]
        type = TransientFissionHeatSource
        variable = temp
        group_fluxes = &#x27;group1 group2 group3 group4 group5 group6&#x27;
    [../]

    [./heatRemoval]
      type = ConvectiveHeatExchanger
      variable = temp
      tref = 900.0
      htc  = 1.0
    [../]
[]

[BCs]
[]

[Materials]
  # alpha = coefficient of thermal expansion where rho  = rho0 -alpha * rho0 * delta T
  # Dr. Aufiero uses nu rather than mu, (kinematic rather than absolute viscosity)
  # likewise, \rho c_p is given rather than separate \rho, c_p
  # accordingly, we let \rho = 1 to obtain equivalent results
  # also, Manu gives a length expansion coefficient. Boussinesq approximations
  # typically use an expansion coefficient with units 1/K, but for mass instead.
  # The relation between the two is alpha = -3 beta, if linearized.
  # Also, had to use Pr = mu * cp / k
  [./const]
    type = GenericConstantMaterial
    prop_names = &#x27;mu     rho alpha   k         cp&#x27;
    prop_values = &#x27;0.025 1.0 6.0e-4  0.5  6.15e6&#x27;
  [../]

  [./fuelneutronicproperties]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;./groupconstants/&#x27;
    interp_type = &#x27;none&#x27; # &#x27;spline&#x27;
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    solve_type = &#x27;PJFNK&#x27;
  [../]
[]

[Executioner]
  type = InversePowerMethod
  max_power_iterations = 50

  # fission power normalization:
  normalization = powernorm
  normal_factor = 1e9 # watts

  # power iteration options
  xdiff = &#x27;group1diff&#x27;
  bx_norm = &#x27;bnorm&#x27;
  pfactor = 1e-2

  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu NONZERO&#x27;
  nl_rel_tol = 1e-12
  nl_abs_tol = 1e-13
  nl_max_its = 6
  l_tol = 1e-6
  l_max_its = 100
[]

[Outputs]
  [./exodus]
    type = Exodus
  [../]
  [./csv]
    type = CSV
  [../]
[]

[Postprocessors]
  [./bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  [../]
  [./group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
    use_displaced_mesh = false
  [../]
  [./powernorm]
    type = ElmIntegTotFissHeatPostprocessor
    execute_on = linear
  [../]
[]

[AuxVariables]
  [./deltaT]
    type = ConstantDifferenceAux
    variable = deltaT
    comparevar = temp
    constant = 900
  [../]
[]

[AuxKernels]
  [./deltaTCalc]
    type =  ConstantDifferenceAux
    variable = deltaT
    compareVar = temp
    constant = 900
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e4933ad7-692b-4324-ae0f-d41845dc56e2"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/HXFail/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;../auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
 [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-pc_type&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="58b46364-143d-4e69-b070-d4f241f75507"><div class="modal-content"><h4>(problems/publication_level_cases/twod_control_rod_yank/rodded.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 4
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2 group3 group4&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_rodded_lattice.msh&#x27;
[../]

[Problem]
  coord_type = RZ
  kernel_coverage_check = false
[]

[Variables]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
  [./rodPosition]
    family = SCALAR
    order = FIRST
    initial_condition = 0.0
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall cRod_top cRod_bot&#x27;
  create_temperature_var = false
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[ScalarKernels]
  [./tdRodPos]
    type = ODETimeDerivative
    variable = rodPosition
  [../]
  [./rodposForce]
    type = ParsedODEKernel
    function = &#x27;rodPosition - 100&#x27;
    variable = rodPosition
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gfuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  [./cRod]
    type = RoddedMaterial
    property_tables_root = &#x27;../../tutorial/step01_groupConstants/MSREProperties/msre_gentry_4gmoder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;cRod&#x27;
    rodDimension = &#x27;y&#x27;
    rodPosition = rodPosition
    absorb_factor = 1e6 # how much more absorbing than usual in absorbing region?
  [../]
  [./rho_crod]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;cRod&#x27;
  [../]

[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  solve_type = &#x27;PJFNK&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100
  [./TimeStepper]
    type = PostprocessorDT
    postprocessor = limit_k
    dt = 0.1
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    # ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
     type = AverageFissionHeat
     nt_scale = ${nt_scale}
     execute_on = &#x27;linear nonlinear&#x27;
     outputs = &#x27;console&#x27;
     block = &#x27;fuel&#x27;
  [../]
  [./limit_k]
    type = LimitK
    execute_on = &#x27;timestep_end&#x27;
    k_postprocessor = multiplication
    growth_factor = 1.2
    cutback_factor = .4
    k_threshold = 1.5
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  execute_on = &#x27;timestep_end final&#x27;
  file_base = &#x27;out&#x27;
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="6312978a-8031-4d4e-ae33-4ab2a20fd609"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/2d_axi_function_cross_sections.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[]

[MeshModifiers]
  [scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 1&#x27;
  []
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
  #  petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
    execute_on = &#x27;timestep_end final&#x27;
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="18461be0-040e-4715-87a7-e3a579557c0f"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/HXFail/sub.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 0
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  # account_delayed = true
[]

[Mesh]
  file = &#x27;../sub.e&#x27;
[]


[Variables]
  [./temp]
    scaling = 1e-4
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
    family = MONOMIAL
    order = CONSTANT
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  outlet_boundaries = &#x27;right&#x27;
  u_def = ${flow_velocity}
  v_def = 0
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  init_from_file = true
 [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_source_fuel]
  #   type = TransientFissionHeatSource
  #   variable = temp
  #   nt_scale=${nt_scale}
  # [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  # [./temp_diffusion]
  #   type = MatDiffusion
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
  # [./temp_advection_fuel]
  #   type = ConservativeTemperatureAdvection
  #   velocity = &#x27;${flow_velocity} 0 0&#x27;
  #   variable = temp
  # [../]
[]

[DGKernels]
  [./temp_adv]
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]


[DiracKernels]
  [./heat_exchanger]
    type = DiracHX
    variable = temp
    point = &#x27;250 0 0&#x27;
    power = 4e3
  [../]
[]


[BCs]
  [./fuel_bottoms_looped]
    boundary = &#x27;left&#x27;
    type = PostprocessorTemperatureInflowBC
    postprocessor = coreEndTemp
    variable = temp
    uu = ${flow_velocity}
  [../]
  # [./diri]
  #   boundary = &#x27;left&#x27;
  #   type = DirichletBC
  #   variable = temp
  #   value = 930
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;right&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]

[Functions]
  [./heatRemovalFcn]
    type = ParsedFunction
    value = &#x27;4e3 * ( 1 - tanh( (t-5) ) )&#x27; # start losing cooling at t=5s
  [../]
[]

[Controls]
  [./hxFuncCtrl]
    type = RealFunctionControl
    parameter = &#x27;*/*/power&#x27;
    function = &#x27;heatRemovalFcn&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    outputs = &#x27;exodus console&#x27;
  [../]
  [./loopEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;right&#x27;
  [../]
  [./coreEndTemp]
    type = Receiver
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;sub&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="ab8f998b-5df0-4526-a38c-f9f62da5711c"><div class="modal-content"><h4>(problems/picard/tmp_nts.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  account_delayed = false
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = &#x27;2d_lattice_structured_jac.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 3e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;lu       NONZERO&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = PostprocessorDT
    postprocessor = &#x27;limit_k&#x27;
    dt = 1e-3
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./limit_k]
    type = LimitK
    growth_factor = 1.1
    cutback_factor = 0.4
    k_threshold = 1.25
    k_postprocessor = &#x27;multiplication&#x27;
  [../]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b216cc16-05b0-4c0b-b967-4a5b40452b2c"><div class="modal-content"><h4>(problems/publication_level_cases/gamma_heating_3d_ss/3d_auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_msre_29x29_136.msh&#x27;
  # file = jac_test.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
#     initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;sin(pi * z / ${height}) * sin(pi * (x + ${offset}) / ${width}) * sin(pi * (y + ${offset}) / ${width})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
#   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-7
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
  [./group1_ic]
    type = FunctionIC
    variable = group1
    function = &#x27;nt_ic_func&#x27;
  [../]
  [./group2_ic]
    type = FunctionIC
    variable = group2
    function = &#x27;nt_ic_func&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="68bc555a-6160-4753-bbdc-3014734706ce"><div class="modal-content"><h4>(problems/LOFA/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text"># take in steady state variable from the other core, and run a pump coastdown transient
# here, flow_velocity is only the initial flow velocity
flow_velocity=21.7 # cm/s. See MSRE-properties.ods
tau = 5 # pump coastdown time constant
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;steady/auto_diff_rho.e&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    constant_velocity_values = false
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    u_func = nullFunc
    v_func = coastDownFunc
    w_func = nullFunc
    init_from_file = true
  [../]
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group1
    initial_from_file_timestep = LATEST [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
    initial_from_file_var = group2
    initial_from_file_timestep = LATEST
  [../]
  [./temp]
    scaling = 1e-4
    order = FIRST
    family = LAGRANGE
    initial_from_file_var = temp
    initial_from_file_timestep = LATEST
  [../]
[]


[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
     type = GammaHeatSource
     variable = temp
     gamma = .0144 # Cammi .0144
     block = &#x27;moder&#x27;
     average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = CtrlConservativeTemperatureAdvection
    u_val = 0
    v_val = ${flow_velocity} # this will be changed in ctrls block
    w_val = 0
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_postpr_inlet]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    variable = temp
    postprocessor = inlet_mean_temp
  [../]
  #[./temp_postpr_inlet]
  #  boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #  type = DirichletBC
  #  variable = temp
  #  value = 922
  #[../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = nullFunc
    vel_y_func = coastDownFunc
    vel_z_func = nullFunc
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
  [./nullFunc]
    type = ParsedFunction
    value = &#x27;0&#x27;
  [../]
  [./coastDownFunc]
    type = ParsedFunction
    value = &#x27;${flow_velocity} * exp(-t / ${tau})&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  # fuel cp function
  [./cp_fuel]
    type = DerivativeParsedMaterial
    f_name = cp
    function = &#x27;1967 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  # fuel k function
  [./k_fuel]
    type = DerivativeParsedMaterial
    f_name = k
    function = &#x27;0.0553 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;/home/gav/projects/moltres/property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  # moder cp fcn
  [./cp_moder]
    type = DerivativeParsedMaterial
    f_name = cp
    function = &#x27;1760 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
  # moder k fcn
  [./k_moder]
    type = DerivativeParsedMaterial
    f_name = k
    function = &#x27;.312 + 1e-16 * temp&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
  nl_abs_tol = 3e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27; #  -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu&#x27; #       NONZERO               1e-10                   preonly   1e-3&#x27;
  line_search = &#x27;none&#x27;
   # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.04
    optimal_iterations = 5
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    # ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
  #multiapp
  [./inlet_mean_temp]
    type = Receiver
    execute_on = &#x27;initial timestep_begin&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Controls]
  [./flowControl]
    type = RealFunctionControl
    parameter = &#x27;*/*/v_val&#x27;
    function = coastDownFunc
    execute_on = &#x27;initial timestep_begin&#x27;
  [../]
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = &#x27;initial timestep_begin&#x27;
    positions = &#x27;100.0 100.0 0.0&#x27;
    input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
 [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="66888794-4450-41ad-8ec9-272b18208f70"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-channel-msre-dimensions.i)</h4><pre class="moose-pre"><code class="language-text"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = single_channel_msre_dimensions.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[AuxVariables]
  [./vel_x]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_y]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_z]
    block = &#x27;fuel&#x27;
  [../]
  [./p]
    block = &#x27;fuel&#x27;
  [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_fuel_transport]
    type = INSTemperature
    u = vel_x
    v = vel_y
    w = vel_z
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    solve_type = PJFNK
    ksp_norm = none
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

[MultiApps]
  [./sub]
    type = FullSolveMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = solution_aux_exodus.i
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Transfers]
  [./vel_x]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_x
    variable = vel_x
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_y]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_y
    variable = vel_y
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_z]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_z
    variable = vel_z
    execute_on = &#x27;initial&#x27;
  [../]
  [./p]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = p
    variable = p
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b4d785a8-7450-4dc8-ae6c-6489c4e593e7"><div class="modal-content"><h4>(problems/single_msre_channel_velocity_heat_nts/heat-nts-single-unit-cell.i)</h4><pre class="moose-pre"><code class="language-text"># This input file tests outflow boundary conditions for the incompressible NS equations.
width = 3.048
height = 1.016
length = 162.56
nt_scale=1e13

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = false
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = msre_squares.msh
[]


[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    # initial_condition = 1
    # scaling = 1e4
  [../]
  [./temp]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[AuxVariables]
  [./vel_x]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_y]
    block = &#x27;fuel&#x27;
  [../]
  [./vel_z]
    block = &#x27;fuel&#x27;
  [../]
  [./p]
    block = &#x27;fuel&#x27;
  [../]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   outlet_boundaries = &#x27;fuel_top&#x27;
#   u_func = vel_x_func
#   v_func = vel_y_func
#   w_func = vel_z_func
#   constant_velocity_values = false
#   nt_exp_form = false
#   family = MONOMIAL
#   order = CONSTANT
#   # jac_test = true
# []

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # [./delayed_group1]
  #   type = DelayedNeutronSource
  #   variable = group1
  # [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]

  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_fuel_transport]
    type = INSTemperature
    u = vel_x
    v = vel_y
    w = vel_z
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_mod_transport]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
    block = &#x27;moderator&#x27;
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moderator&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moderator&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[BCs]
  [./temp_inlet]
    boundary = &#x27;fuel_bottom&#x27;
    variable = temp
    value = 900
    type = DirichletBC
  [../]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top moderator_bottoms moderator_tops&#x27;
    variable = group2
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.0553 1967 2.146e-3&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.312 1760 1.86e-3&#x27; # Cammi 2011 at 908 K
    block = &#x27;moderator&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[Preconditioning]
  [./SMP_PJFNK]
    type = SMP
    full = true
    solve_type = PJFNK
    ksp_norm = none
  [../]
[]

# [Executioner]
#   # type = Steady
#   type = Transient
#   dt = 1
#   num_steps = 1
#   petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
#   petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
#   petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
#   # line_search = none
#   nl_rel_tol = 1e-8
#   nl_max_its = 50
#   l_max_its = 300
# []

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  # petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  # petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

#   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Outputs]
  perf_graph = true
  exodus = true
  csv = true
  file_base = &#x27;out&#x27;
[]

[Functions]
  [./nt_ic]
    type = ParsedFunction
    value = &#x27;10 * sin(pi * z / ${length})&#x27;
  [../]
  [./temp_ic]
    type = ParsedFunction
    value = &#x27;900 + 100 / ${length} * z&#x27;
  [../]
[]

[ICs]
  [./temp]
    type = FunctionIC
    variable = temp
    function = temp_ic
  [../]
  [./group1]
    type = FunctionIC
    variable = group1
    function = nt_ic
  [../]
  [./group2]
    type = FunctionIC
    variable = group2
    function = nt_ic
  [../]
[]

[MultiApps]
  [./sub]
    type = FullSolveMultiApp
    app_type = MoltresApp
    positions = &#x27;0 0 0&#x27;
    input_files = solution_aux_exodus.i
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Transfers]
  [./vel_x]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_x
    variable = vel_x
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_y]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_y
    variable = vel_y
    execute_on = &#x27;initial&#x27;
  [../]
  [./vel_z]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = vel_z
    variable = vel_z
    execute_on = &#x27;initial&#x27;
  [../]
  [./p]
    type = MultiAppNearestNodeTransfer
    direction = from_multiapp
    multi_app = sub
    source_variable = p
    variable = p
    execute_on = &#x27;initial&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moderator&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear timestep_begin&#x27;
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="15481986-4bb5-40a5-a04c-d04e0b9284d5"><div class="modal-content"><h4>(problems/publication_level_cases/transient_single_channel_blockage/3d_ss.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922
base_height=136
scale=.99
height=${* ${base_height} ${scale}}
width=145
offset=2.5

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = msre_vol_frac_29x29_h_136.msh
[]

[MeshModifiers]
  [./scale]
    type = Transform
    transform = SCALE
    vector_value = &#x27;1 1 ${scale}&#x27;
  [../]
[]

[Problem]
[]

[Variables]
  [./group1]
    scaling = 1e4
    initial_condition = 1
  [../]
  [./group2]
    scaling = 1e4
    initial_condition = 1
  [../]
  [./temp]
    scaling = 1e-4
    initial_condition = ${ini_temp}
  [../]
[]

[Precursors]
  [./primary_fuel]
    var_name_base = pre
    block = &#x27;fuel blocked_fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops blocked_fuel_top&#x27;
    u_def = 0
    v_def = 0
    w_def = ${flow_velocity}
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    kernel_block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    gamma = .0144 # Cammi .0144
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides blocked_fuel_top blocked_fuel_bottom&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides blocked_fuel_bottom&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops blocked_fuel_top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = MsreFuelTwoGrpXSFunctionMaterial
    block = &#x27;fuel blocked_fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
  [./moder]
    type = GraphiteTwoGrpXSFunctionMaterial
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  line_search = &#x27;none&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  dtmin = 1e-7
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-6
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
    ksp_norm = none
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    nt_scale = ${nt_scale}
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;console&#x27;
    block = &#x27;fuel blocked_fuel&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b8c879c0-e083-4360-800a-fe7f431b1693"><div class="modal-content"><h4>(problems/060717_dimension_testing/one_group.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 1
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  # coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-6
  [../]
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  scaling = 1
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
  # [./temp_diffusion_outlet]
  #   boundary = &#x27;fuel_tops&#x27;
  #   type = DiffusiveFluxBC
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_one_group_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  file_base = &#x27;&#x27;
  [./exodus]
    type = Exodus
  [../]
  [./csv]
    type = CSV
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="c65694b8-b359-4587-8ee0-38d1c95ee4f3"><div class="modal-content"><h4>(problems/2017_annals_pub_msre_compare/2group.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922
gamma_frac = .075
R = 73
H = 162.56

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  nt_scale = ${nt_scale}
[]

[Mesh]
  coord_type = RZ
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Variables]
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[AuxVariables]
  [power_density]
    order = CONSTANT
    family = MONOMIAL
  []
[]

[Precursors]
  [pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  []
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  create_temperature_var = false
  scaling = 1e-4
  pre_blocks = &#x27;fuel&#x27;
[]

[Kernels]
  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  []
  [temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
    gamma = gamma_func
  []
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [temp_diri_cg]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = FlexiblePostprocessorDirichletBC
    postprocessor = coreEndTemp
    offset = -27.8
    variable = temp
  []
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  []
[]

[AuxKernels]
  [fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  []
  [moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
    gamma = gamma_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [gamma_func]
    type = ParsedFunction
    expression = &#x27;${gamma_frac} * pi^2 / 4 * cos(pi * x / (2. * ${R})) * sin(pi * y / ${H})&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/serp3d2group0.78eV/2g0.78eV_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/serp3d2group0.78eV/2g0.78eV_moder_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [TimeStepper]
    type = PostprocessorDT
    postprocessor = limit_k
    dt = 1e-3
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  []
  [coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  []
  [limit_k]
    type = LimitK
    execute_on = &#x27;timestep_end&#x27;
    k_postprocessor = multiplication
    growth_factor = 1.2
    cutback_factor = .4
    k_threshold = 1.5
  []
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="839fe0f5-3da3-42e5-83f7-9829926dbc00"><div class="modal-content"><h4>(problems/LOSCA/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[../]

[Problem]
  coord_type = RZ
[]

[Nt]
  var_name_base = group
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  create_temperature_var = false
  scaling = 1e-4
  pre_blocks = &#x27;fuel&#x27;
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    scaling = 1e4
  [../]
  [./temp]
    scaling = 1e-4
    initial_condition = 930
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = ${flow_velocity}
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  loop_precursors = true
  multi_app = loopApp
  is_loopapp = false
  inlet_boundaries = &#x27;fuel_bottoms&#x27;
 [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./fuel_bottoms_looped]
    boundary = &#x27;fuel_bottoms outer_wall&#x27;
    type = PostprocessorDirichletBC
    postprocessor = inlet_mean_temp
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-5
  nl_abs_tol = 1e-5

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console exodus&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console exodus&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;exodus console&#x27;
  [../]
  # MULTIAPP
  [./inlet_mean_temp]
    type = Receiver
    initialize_old = true
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;auto_diff_rho&#x27;
    execute_on = &#x27;timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[MultiApps]
  [./loopApp]
    type = TransientMultiApp
    app_type = MoltresApp
    execute_on = timestep_begin
    positions = &#x27;100.0 100.0 0.0&#x27;
   input_files = &#x27;sub.i&#x27;
 [../]
[]

# connect inlet and outlet to multiapp
[Transfers]
  [./from_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = loopEndTemp
    to_postprocessor = inlet_mean_temp
    direction = from_multiapp
    reduction_type = maximum
  [../]
  [./to_loop]
    type = MultiAppPostprocessorTransfer
    multi_app = loopApp
    from_postprocessor = coreEndTemp
    to_postprocessor = coreEndTemp
    direction = to_multiapp
  [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="ce3ddc1b-b684-4b1c-92f6-10351a5ce6cd"><div class="modal-content"><h4>(problems/publication_level_cases/dilute_absorber_controlled_by_peak_power_density/in.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
  # file = 2d_split_mesh/auto_diff_rho_in.e
  # file = auto_diff_rho_in.e
  # nemesis = true
  # parallel_type = DISTRIBUTED
[../]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    peak_power_density = peak_power_density
    controller_gain = 1e-4
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    peak_power_density = peak_power_density
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./peak_power_density]
    type = ElementExtremeValue
    value_type = max
    variable = power_density
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  # nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="50c95b71-2253-4453-a3fd-96026ead3e6b"><div class="modal-content"><h4>(problems/publication_level_cases/LOSCA/sub.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 0
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  # account_delayed = true
[]

[Mesh]
  type = GeneratedMesh
  dim = 1
  nx = 600
  xmax = 500
  elem_type = EDGE2
[../]

[Variables]
  [./temp]
    initial_condition = 930 #approx steady outlet of other problem
    scaling = 1e-4
    family = MONOMIAL
    order = CONSTANT
  [../]
[]

[Precursors]
 [./core]
  var_name_base = pre
  outlet_boundaries = &#x27;right&#x27;
  u_def = ${flow_velocity}
  v_def = 0
  w_def = 0
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
 [../]
[]

[Kernels]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  # [./temp_source_fuel]
  #   type = TransientFissionHeatSource
  #   variable = temp
  #   nt_scale=${nt_scale}
  # [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  # [./temp_diffusion]
  #   type = MatDiffusion
  #   diffusivity = &#x27;k&#x27;
  #   variable = temp
  # [../]
  # [./temp_advection_fuel]
  #   type = ConservativeTemperatureAdvection
  #   velocity = &#x27;${flow_velocity} 0 0&#x27;
  #   variable = temp
  # [../]
[]

[DGKernels]
  [./temp_adv]
    type = DGTemperatureAdvection
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]


[DiracKernels]
  [./heat_exchanger]
    type = DiracHX
    variable = temp
    power = 4e3 # see controls
    point = &#x27;250 0 0&#x27;
  [../]
[]


[BCs]
  [./fuel_bottoms_looped]
    boundary = &#x27;left&#x27;
    type = PostprocessorTemperatureInflowBC
    postprocessor = coreEndTemp
    variable = temp
    uu = ${flow_velocity}
  [../]
  # [./diri]
  #   boundary = &#x27;left&#x27;
  #   type = DirichletBC
  #   variable = temp
  #   value = 930
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;right&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;${flow_velocity} 0 0&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;
  line_search = &#x27;none&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    outputs = &#x27;exodus console&#x27;
  [../]
  [./loopEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;right&#x27;
  [../]
  [./coreEndTemp]
    type = Receiver
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  [./exodus]
    type = Exodus
    file_base = &#x27;sub&#x27;
    execute_on = &#x27;timestep_begin&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# connect inlet and outlet to multiapp
# [Transfers]
#   [./to_core]
#     type = MultiAppPostprocessorTransfer
#     multi_app = MoltresApp
#     from_postprocessor = loopEndTemp
#     to_postprocessor = inlet_mean_temp
#     direction = to_multiapp
#   [../]
#   [./from_core]
#     type = MultiAppPostprocessorTransfer
#     multi_app = MoltresApp
#     from_postprocessor = coreEndTemp
#     to_postprocessor = coreEndTemp
#     direction = to_multiapp
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="b0abd6ca-aed6-4937-a247-946d4eab0499"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_rho_direct.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  #   file = &#x27;3d_msre_29x29_136.msh&#x27;
  file = split_mesh/3d_auto_diff_rho_in.e
  nemesis = true
  skip_partioning = true
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  #   petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  #   petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;lu	  NONZERO		1e-10			preonly	  1e-3&#x27;
  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    ksp_norm = none
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
  nemesis = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="1352e511-f784-4c8e-94f8-ab6f789a6f70"><div class="modal-content"><h4>(problems/011317_notebook_perfectly_bracketed_critical_buckling_height_from_newt/Input_serpent.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=147 # Cammi 147 cm/s
inlet_temp=824
initial_outlet_temp=824
nt_scale=1e0
precursor_log_inlet_conc=-17
reactor_height=175 # Cammi 396 cm; critical_buckling_from_newt ~ 115 cm
global_temperature=900

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
  v_def = ${flow_velocity}
  tau = 1
  transient_simulation = true
  incompressible_flow = false
  # prec_scale = 1e5
[../]

[Mesh]
  file = &#x27;cylinder_structured.msh&#x27;
[../]


[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_top graphite_top fuel_bottom graphite_bottom&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  create_temperature_var = false
  # temperature = ${global_temperature}
  temperature_value = ${global_temperature}
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   inlet_boundary = &#x27;fuel_bottom&#x27;
#   inlet_boundary_condition = &#x27;DirichletBC&#x27;
#   inlet_bc_value = ${precursor_log_inlet_conc}
#   outlet_boundary = &#x27;fuel_top&#x27;
#   initial_condition = ${precursor_log_inlet_conc}
#   tau = 1
#   use_source_stabilization = true
#   offset = 24
# []

# [Kernels]
#   # Temperature
#   [./temp_flow_fuel]
#     block = &#x27;fuel&#x27;
#     type = MatINSTemperatureRZ
#     variable = temp
#     rho = &#x27;rho&#x27;
#     k = &#x27;k&#x27;
#     cp = &#x27;cp&#x27;
#     uz = ${flow_velocity}
#   [../]
#   [./temp_art_diff_fuel]
#     block = &#x27;fuel&#x27;
#     type = ScalarAdvectionArtDiff
#     variable = temp
#     use_exp_form = false
#   [../]
#   [./temp_flow_moder]
#     block = &#x27;moder&#x27;
#     type = MatINSTemperatureRZ
#     variable = temp
#     rho = &#x27;rho&#x27;
#     k = &#x27;k&#x27;
#     cp = &#x27;cp&#x27;
#   [../]
#   [./temp_source]
#     type = TransientFissionHeatSource
#     variable = temp
#     nt_scale=${nt_scale}
#   [../]
#   [./temp_time_derivative]
#     type = MatINSTemperatureTimeDerivative
#     variable = temp
#     rho = &#x27;rho&#x27;
#     cp = &#x27;cp&#x27;
#   [../]
# []

[Materials]
  [./fuel]
    type = CammiFuel
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/msr2g_Th_U_two_mat_homogenization_fuel_data_func_of_fuel_temp_&#x27;
    prop_names = &#x27;cp&#x27;
    prop_values = &#x27;1357&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    type = CammiModerator
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/msr2g_Th_U_two_mat_homogenization_mod_data_func_of_mod_temp_&#x27;
    prop_names = &#x27;rho cp&#x27;
    prop_values = &#x27;1.843e-3 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

# [BCs]
#   [./temp_inlet]
#     boundary = &#x27;fuel_bottom graphite_bottom&#x27;
#     type = DirichletBC
#     variable = temp
#     value = ${inlet_temp}
#   [../]
#   [./temp_outlet]
#     boundary = &#x27;fuel_top&#x27;
#     type = MatINSTemperatureNoBCBC
#     variable = temp
#     k = &#x27;k&#x27;
#   [../]
#   [./temp_art_diff_fuel]
#     boundary = &#x27;fuel_top&#x27;
#     type = ScalarAdvectionArtDiffNoBCBC
#     variable = temp
#     use_exp_form = false
#   [../]
# []

[Problem]
  type = FEProblem
  coord_type = RZ
[../]

[Executioner]
  type = Transient
  end_time = 10000

  # line_search = none
  nl_rel_tol = 1e-6
  # nl_abs_tol = 1e-5
  # trans_ss_check = true
  # ss_check_tol = 8e-9

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_factor_shift_type -pc_factor_shift_amount -ksp_type -snes_linesearch_minlambda -pc_factor_mat_solver_package&#x27;
  petsc_options_value = &#x27;lu NONZERO 1.e-10 preonly 1e-3 mumps&#x27;

  nl_max_its = 10
  l_max_its = 10

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
  [./dof_map]
    type = DOFMap
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   # [./temp_ic]
#   #   type = ConstantIC
#   #   variable = temp
#   #   value = ${inlet_temp}
#   # [../]
#   [./temp_all_ic_func]
#     type = FunctionIC
#     variable = temp
#     function = temp_ic_func
#   [../]
# []

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;(${initial_outlet_temp} - ${inlet_temp}) / ${reactor_height} * y + ${inlet_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  # [./temp_fuel]
  #   type = ElementAverageValue
  #   variable = temp
  #   block = &#x27;fuel&#x27;
  #   # execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;csv console&#x27;
  # [../]
  # [./temp_moder]
  #   type = ElementAverageValue
  #   variable = temp
  #   block = &#x27;moder&#x27;
  #   # execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;csv console&#x27;
  # [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="53d3af41-d727-4d0e-963a-43e9f61afe4a"><div class="modal-content"><h4>(problems/constant_inlet_outlet_temp_no_heat_flux_at_walls/auto_diff_rho.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
ini_temp=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = false
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
  gamma = .0144 # Cammi .0144
  nt_scale = ${nt_scale}
[]

[Mesh]
  file = &#x27;2d_lattice_structured.msh&#x27;
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e4
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  [../]
[]

[AuxVariables]
  [./power_density]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]

[Precursors]
  [./pres]
    var_name_base = pre
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_tops&#x27;
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    family = MONOMIAL
    order = CONSTANT
    # jac_test = true
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]

  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
  [./temp_source_mod]
    type = GammaHeatSource
    variable = temp
    block = &#x27;moder&#x27;
    average_fission_heat = &#x27;average_fission_heat&#x27;
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;fuel_bottoms&#x27;
    type = FlexiblePostprocessorDirichletBC
    postprocessor = coreEndTemp
    offset = -50
    variable = temp
  [../]
  # [./temp_diri_cg]
  #   boundary = &#x27;moder_bottoms fuel_bottoms outer_wall&#x27;
  #   type = FunctionDirichletBC
  #   function = &#x27;temp_bc_func&#x27;
  #   variable = temp
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[AuxKernels]
  [./fuel]
    block = &#x27;fuel&#x27;
    type = FissionHeatSourceTransientAux
    variable = power_density
  [../]
  [./moderator]
    block = &#x27;moder&#x27;
    type = ModeratorHeatSourceTransientAux
    average_fission_heat = &#x27;average_fission_heat&#x27;
    variable = power_density
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    controller_gain = 0
  [../]
  [./rho_fuel]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
    controller_gain = 0
  [../]
  [./rho_moder]
    type = DerivativeParsedMaterial
    f_name = rho
    function = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    args = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 6e-6

  solve_type = &#x27;PJFNK&#x27;
  line_search = none
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type&#x27;
  petsc_options_value = &#x27;lu&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./average_fission_heat]
    type = AverageFissionHeat
    execute_on = &#x27;linear nonlinear&#x27;
    outputs = &#x27;csv console&#x27;
    block = &#x27;fuel&#x27;
  [../]
  [./coreEndTemp]
    type = SideAverageValue
    variable = temp
    boundary = &#x27;fuel_tops&#x27;
    outputs = &#x27;csv console&#x27;
    execute_on = &#x27;linear nonlinear&#x27;
  [../]
[]

[VectorPostprocessors]
  [./outlet_temps]
    type = LineValueSampler
    start_point = &#x27;0 153 0&#x27;
    end_point = &#x27;72.5 153 0&#x27;
    num_points = 1000
    variable = temp
    sort_by = &#x27;x&#x27;
    outputs = &#x27;csv&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  exodus = true
  [./csv]
    type = CSV
    execute_on = &#x27;final&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="9e18f596-e4e8-4138-9c41-237458729146"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_single_pin_velocity_function.i)</h4><pre class="moose-pre"><code class="language-text"># flow_velocity=21.7 # cm/s. See MSRE-properties.ods
fuel_velocity_max_inlet = 43.4
fuel_sq_rad = 33.28
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_func = vel_x_func
  v_func = vel_y_func
  w_func = vel_z_func
  constant_velocity_values = false
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = VelocityFunctionTemperatureAdvection
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = VelocityFunctionTemperatureOutflowBC
    variable = temp
    vel_x_func = vel_x_func
    vel_y_func = vel_y_func
    vel_z_func = vel_z_func
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
  [vel_x_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_y_func]
    type = ParsedFunction
    expression = &#x27;0&#x27;
  []
  [vel_z_func]
    type = ParsedFunction
    expression = &#x27;${fuel_velocity_max_inlet} * cos(pi * x / (2 * ${fuel_sq_rad})) * cos(pi * y / (2 * ${fuel_sq_rad}))&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  exodus = true
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="163ae21d-8473-4601-a1a9-18f846bd9617"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-b1-two-mat.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = true
[../]

[Mesh]
  file = &#x27;msre_26x26.msh&#x27;
  # file = &#x27;msre_cuboid_3x3.msh&#x27;
[../]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
  [../]
  [./temp]
    initial_condition = ${diri_temp}
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;fuel_bottoms moder_bottoms fuel_sides&#x27;
    type = DirichletBC
    variable = temp
    value = ${diri_temp}
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/B1_msre_single_unit_cell_moder_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="ad568e5b-2f91-4c1c-bc85-c23744323674"><div class="modal-content"><h4>(problems/021417_MSRE_materials/mini_msre_cg_temp.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
diri_temp=908
nt_scale=1e13
reactor_height=162.56
global_temperature=temp
# global_temperature=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 8
  use_exp_form = true
  group_fluxes = &#x27;group1 group2&#x27;
#   u_def = 0
#   v_def = 0
#   w_def = ${flow_velocity}
[../]

[Mesh]
  file = &#x27;mini_msre_cuboid.msh&#x27;
[../]

[Nt]
  var_name_base = &#x27;group&#x27;
  vacuum_boundaries = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops fuel_sides&#x27;
  temp_scaling = 1e0
  nt_ic_function = &#x27;nt_ic_func&#x27;
  create_temperature_var = true
  temperature = ${global_temperature}
  # temperature_value = ${global_temperature}
  dg_for_temperature = false
[]

# [Precursors]
#   var_name_base = pre
#   block = &#x27;fuel&#x27;
#   advection_boundaries = &#x27;fuel_top fuel_bottom&#x27;
#   family = MONOMIAL
#   order = CONSTANT
# []

[Kernels]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[Materials]
  [./fuel]
    # type = CammiFuel
    type = GenericMoltresMaterial
    block = &#x27;fuel&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_fuel_data_func_of_fuel_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
  [./moder]
    # type = CammiModerator
    type = GenericMoltresMaterial
    block = &#x27;moder&#x27;
    property_tables_root = &#x27;../property_file_dir/full_core_cuboid_msre_comp_mod_data_func_of_mod_temp_&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
  [../]
[]

[BCs]
  [./temp_diri_cg]
    boundary = &#x27;fuel_bottoms moder_bottoms fuel_sides&#x27;
    type = DirichletBC
    variable = temp
    value = ${diri_temp}
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

# [Problem]
#   type = FEProblem
#   coord_type = RZ
# [../]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Outputs]
  csv = true
  print_linear_residuals = true
  perf_graph = true
  [./out]
    type = Exodus
    execute_on = &#x27;initial timestep_end&#x27;
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]

[ICs]
  [./temp_all_ic_func]
    type = FunctionIC
    variable = temp
    function = temp_ic_func
  [../]
[]

[Functions]
  [./temp_ic_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
  [./nt_ic_func]
    type = ParsedFunction
    value = &#x27;4/${reactor_height} * y * (1 - y/${reactor_height})&#x27;
  [../]
  [./diri_temp_func]
    type = ParsedFunction
    value = &#x27;${diri_temp}&#x27;
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;csv console&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
#   # [./average_fission_heat]
#   #   type = AverageFissionHeat
#   #   nt_scale = ${nt_scale}
#   #   execute_on = &#x27;linear nonlinear&#x27;
#   #   outputs = &#x27;csv console&#x27;
#   #   block = &#x27;fuel&#x27;
#   # [../]
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="0e920963-8db1-4ea6-a1ea-7a5b7cb0a439"><div class="modal-content"><h4>(problems/021417_MSRE_materials/transient-nts-cg-temp-two-grp-scale-two-mat-inverted-file-msh.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=21.7 # cm/s. See MSRE-properties.ods
nt_scale=1e13
global_temperature=temp
# global_temperature=922
ini_temp=1022
diri_temp=922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = ${global_temperature}
  sss2_input = false
[../]

[Mesh]
  file = &#x27;inverted_29x29_h_133.msh&#x27;
  # file = &#x27;inverted_3x3_h_15.msh&#x27;
[../]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1e1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    scaling = 1e-3
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  [./diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  [../]
  [./sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  [../]
  [./fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  [../]
  [./inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  [../]
  [./inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  [../]
  # Temperature
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
    block = &#x27;fuel&#x27;
  [../]
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  [../]
[]

[BCs]
  [./vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group1
  [../]
  [./vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;moder_bottoms moder_tops fuel_bottoms fuel_tops moder_sides&#x27;
    variable = group2
  [../]
  [./temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  [./temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    block = &#x27;fuel&#x27;
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;2.146e-3 .0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  [../]
  [./moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;spline&#x27;
    temperature = ${global_temperature}
    prop_names = &#x27;rho k cp&#x27;
    prop_values = &#x27;1.843e-3 .312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000
#   num_steps = 1

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-5

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  [./TimeStepper]
    type = IterationAdaptiveDT
    cutback_factor = 0.4
    dt = 1e-3
    growth_factor = 1.025
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
  [./temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  csv = true
  [./out]
    type = Exodus
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="7f11bbb8-4b2a-47b6-9f7f-bfdfe6664a93"><div class="modal-content"><h4>(problems/033117_nts_temp_pre_parsed_mat/3d_auto_diff_single_pin_adaptive_PJFNK.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity = 21.7 # cm/s. See MSRE-properties.ods
nt_scale = 1e13
ini_temp = 922
diri_temp = 922

[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  sss2_input = false
  account_delayed = true
  temperature = temp
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
[]

[Mesh]
  file = &#x27;3d_single_unit_msre_vol_fraction.msh&#x27;
  # uniform_refine = 1
  # file = jac_test.msh
[]

[Problem]
[]

[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [group2]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    # scaling = 1e4
  []
  [temp]
    initial_condition = ${ini_temp}
    scaling = 1e-4
  []
[]

[Precursors]
  var_name_base = pre
  block = &#x27;fuel&#x27;
  outlet_boundaries = &#x27;fuel_tops&#x27;
  u_def = 0
  v_def = 0
  w_def = ${flow_velocity}
  nt_exp_form = false
  family = MONOMIAL
  order = CONSTANT
  # jac_test = true
[]

[Kernels]
  # Neutronics
  [time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [time_group2]
    type = NtTimeDerivative
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []

  # Temperature
  [temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  []
  [temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale = ${nt_scale}
    block = &#x27;fuel&#x27;
  []
  # [./temp_source_mod]
  #   type = GammaHeatSource
  #   variable = temp
  #   gamma = .0144 # Cammi .0144
  #   block = &#x27;moder&#x27;
  #   average_fission_heat = &#x27;average_fission_heat&#x27;
  # [../]
  [temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  []
  [temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
    variable = temp
    block = &#x27;fuel&#x27;
  []
[]

[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops moder_sides&#x27;
    variable = group2
  []
  [temp_diri_cg]
    boundary = &#x27;moder_bottoms fuel_bottoms moder_sides&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  []
  [temp_advection_outlet]
    boundary = &#x27;fuel_tops&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 0 ${flow_velocity}&#x27;
  []
[]

[Functions]
  [temp_bc_func]
    type = ParsedFunction
    expression = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  []
[]

[Materials]
  [fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_fuel_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    block = &#x27;fuel&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.0553 1967&#x27; # Robertson MSRE technical report @ 922 K
  []
  [rho_fuel]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;2.146e-3 * exp(-1.8 * 1.18e-4 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;fuel&#x27;
  []
  [moder]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/newt_msre_mod_&#x27;
    interp_type = &#x27;monotone_cubic&#x27;
    prop_names = &#x27;k cp&#x27;
    prop_values = &#x27;.312 1760&#x27; # Cammi 2011 at 908 K
    block = &#x27;moder&#x27;
  []
  [rho_moder]
    type = DerivativeParsedMaterial
    property_name = rho
    expression = &#x27;1.86e-3 * exp(-1.8 * 1.0e-5 * (temp - 922))&#x27;
    coupled_variables = &#x27;temp&#x27;
    derivative_order = 1
    block = &#x27;moder&#x27;
  []
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 200

  #   dtmax = 1
  dtmin = 1e-5
  # dt = 1e-3
  [TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
    linear_iteration_ratio = 1000
  []
[]

[Preconditioning]
  [SMP]
    type = SMP
    full = true
    # off_diag_row = &#x27;temp pre1 pre2 pre3 pre4 pre5 pre6 temp pre1 pre2 pre3 pre4 pre5 pre6&#x27;
    # off_diag_column = &#x27;group1 group1 group1 group1 group1 group1 group1 group2 group2 group2 group2 group2 group2 group2&#x27;
  []
[]

[Postprocessors]
  [group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  []
  [multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  []
  [temp_fuel]
    type = ElementAverageValue
    variable = temp
    block = &#x27;fuel&#x27;
    outputs = &#x27;csv console&#x27;
  []
  [temp_moder]
    type = ElementAverageValue
    variable = temp
    block = &#x27;moder&#x27;
    outputs = &#x27;csv console&#x27;
  []
  # [./average_fission_heat]
  #   type = AverageFissionHeat
  #   nt_scale = ${nt_scale}
  #   execute_on = &#x27;linear nonlinear&#x27;
  #   outputs = &#x27;console&#x27;
  #   block = &#x27;fuel&#x27;
  # [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  csv = true
  [out]
    type = Exodus
  []
[]

[Debug]
  show_var_residual_norms = true
[]

# [ICs]
#   [./temp_ic]
#     type = RandomIC
#     variable = temp
#     min = 922
#     max = 1022
#   [../]
#   [./group1_ic]
#     type = RandomIC
#     variable = group1
#     min = .5
#     max = 1.5
#   [../]
#   [./group2_ic]
#     type = RandomIC
#     variable = group2
#     min = .5
#     max = 1.5
#   [../]
# []

# [Adaptivity]
#   marker = errorfrac_temp
#   max_h_level = 1
#   [./Indicators]
#     [./error_temp]
#       type = GradientJumpIndicator
#       variable = temp
#       outputs = none
#     [../]
#   [../]
#   [./Markers]
#     [./errorfrac_temp]
#       type = ErrorFractionMarker
#       refine = 0.8
#       coarsen = 0.1
#       indicator = error_temp
#       outputs = none
#     [../]
#   [../]
# []
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="52c62fa3-d67f-438c-8da9-01255db761fc"><div class="modal-content"><h4>(problems/060717_dimension_testing/test_case.i)</h4><pre class="moose-pre"><code class="language-text">flow_velocity=1
nt_scale = ${/ 1E0 1.6E-13}
ini_temp=1
diri_temp=1

[GlobalParams]
  num_groups = 1
  num_precursor_groups = 1
  use_exp_form = false
  group_fluxes = &#x27;group1&#x27;
  temperature = temp
  sss2_input = false
  account_delayed = false
[]

[Mesh]
  type = GeneratedMesh
  nx = 10
  ny = 10
  dim = 2
  xmax = 2.42 # Bessel zero is 2.405
  ymax = 3.149
[]

[Problem]
  coord_type = RZ
[]

[Variables]
  [./group1]
    order = FIRST
    family = LAGRANGE
    initial_condition = 1
    scaling = 1
  [../]
  [./temp]
    initial_condition = ${ini_temp}
    # order = CONSTANT
    # family = MONOMIAL
  [../]
[]

[Kernels]
  # Neutronics
  [./time_group1]
    type = NtTimeDerivative
    variable = group1
    group_number = 1
  [../]
  [./diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  [../]
  [./fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
  [../]
  # Temperature
  [./temp_time_derivative]
    type = MatINSTemperatureTimeDerivative
    variable = temp
  [../]
  [./temp_source_fuel]
    type = TransientFissionHeatSource
    variable = temp
    nt_scale=${nt_scale}
  [../]
  [./temp_diffusion]
    type = MatDiffusion
    diffusivity = &#x27;k&#x27;
    variable = temp
  [../]
  [./temp_advection_fuel]
    type = ConservativeTemperatureAdvection
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
    variable = temp
  [../]
[]

# [DGKernels]
#   [./temp]
#     type = DGConvection
#     variable = temp
#     velocity = &#x27;0 ${flow_velocity} 0&#x27;
#   [../]
# []

[BCs]
  # [./vacuum_group1]
  #   type = VacuumConcBC
  #   boundary = &#x27;fuel_bottoms fuel_tops moder_bottoms moder_tops outer_wall&#x27;
  #   variable = group1
  # [../]
  [./group1]
    type = DirichletBC
    value = 0
    boundary = &#x27;top right bottom&#x27;
    variable = &#x27;group1&#x27;
  [../]
  [./temp_diri_cg]
    boundary = &#x27;bottom right&#x27;
    type = FunctionDirichletBC
    function = &#x27;temp_bc_func&#x27;
    variable = temp
  [../]
  # [./temp_advection_inlet]
  #   boundary = &#x27;bottom&#x27;
  #   type = TemperatureInflowBC
  #   velocity = &#x27;0 ${flow_velocity} 0&#x27;
  #   variable = temp
  #   inlet_conc = 1
  # [../]
  [./temp_advection_outlet]
    boundary = &#x27;top&#x27;
    type = TemperatureOutflowBC
    variable = temp
    velocity = &#x27;0 ${flow_velocity} 0&#x27;
  [../]
[]

[Functions]
  [./temp_bc_func]
    type = ParsedFunction
    value = &#x27;${ini_temp} - (${ini_temp} - ${diri_temp}) * tanh(t/1e-2)&#x27;
  [../]
[]

[Materials]
  [./fuel]
    type = GenericMoltresMaterial
    property_tables_root = &#x27;../property_file_dir/dummy_&#x27;
    interp_type = &#x27;spline&#x27;
    prop_names = &#x27;k cp rho&#x27;
    prop_values = &#x27;.1 1 1&#x27; # Robertson MSRE technical report @ 922 K
  [../]
[]

[Executioner]
  type = Transient
  end_time = 10000

  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-6

  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -sub_pc_type -pc_asm_overlap -sub_ksp_type -snes_linesearch_minlambda&#x27;
  petsc_options_value = &#x27;asm      lu           1               preonly       1e-3&#x27;
  # petsc_options_iname = &#x27;-snes_type&#x27;
  # petsc_options_value = &#x27;test&#x27;

  nl_max_its = 30
  l_max_its = 100

  dtmin = 1e-5
  # dtmax = 1
  # dt = 1e-3
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1e-3
    cutback_factor = 0.4
    growth_factor = 1.2
    optimal_iterations = 20
  [../]
[]

[Preconditioning]
  [./SMP]
    type = SMP
    full = true
  [../]
[]

[Postprocessors]
  [./group1_current]
    type = IntegralNewVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./group1_old]
    type = IntegralOldVariablePostprocessor
    variable = group1
    outputs = &#x27;console csv&#x27;
  [../]
  [./multiplication]
    type = DivisionPostprocessor
    value1 = group1_current
    value2 = group1_old
    outputs = &#x27;console csv&#x27;
  [../]
  [./temp_fuel]
    type = ElementAverageValue
    variable = temp
    outputs = &#x27;csv console&#x27;
  [../]
[]

[Outputs]
  perf_graph = true
  print_linear_residuals = true
  file_base = &#x27;&#x27;
  [./exodus]
    type = Exodus
  [../]
  [./csv]
    type = CSV
  [../]
[]

[Debug]
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#ad841c56-0799-43a8-b66f-814af1bb4788" class="tooltipped" data-position="left" data-tooltip="Overview">Overview</a></li><li><a href="#ec3293e9-2dbb-46e4-adb4-91d4880539cc" class="tooltipped" data-position="left" data-tooltip="Example Input File Syntax">Example Input File Syntax</a></li><li><a href="#a5857e35-1d63-43c0-bb5c-d3c47da7981e" class="tooltipped" data-position="left" data-tooltip="Input Parameters">Input Parameters</a></li><li><a href="#bb5fd029-dccf-4109-8d9c-010f90afc551" class="tooltipped" data-position="left" data-tooltip="Input Files">Input Files</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>