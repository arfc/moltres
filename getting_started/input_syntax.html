<!DOCTYPE html><head><meta charset="UTF-8"><title>Introduction to the Moltres Input File Syntax | Moltres</title><link href="../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../css/katex_moose.css" type="text/css" rel="stylesheet"></link><link href="../css/moltres.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../contrib/katex/katex.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Moltres</a><a href="https://github.com/arfc/moltres" class="right"><img src="../media/framework/github-logo.png" class="github-mark"></img><img src="../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="e0de987d-0e3e-4542-875d-cf70beecd1f3" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="c8477b02-f6cb-4716-8dac-df9dadc5dc7c" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="6ba322f1-d0e3-498b-8bed-fd5a2c80470b" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../citing.html">Citing</a></li></ul><a href="#" class="sidenav-trigger" data-target="4ab56177-540c-4dbd-89d3-985dcdb395ed"><i class="material-icons">menu</i></a><ul class="sidenav" id="4ab56177-540c-4dbd-89d3-985dcdb395ed"><li><a href="#!" class="dropdown-trigger" data-target="b491d241-4d71-43f9-b578-19bf98bf6098" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="ee0fb8d0-bfa3-4851-85c8-c8506eedae15" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="603977e9-96d5-4949-9936-a35efb888afb" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../citing.html">Citing</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="e0de987d-0e3e-4542-875d-cf70beecd1f3"><li><a href="installation.html">Install Moltres</a></li><li><a href="theory.html">Theory</a></li><li><a href="tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="c8477b02-f6cb-4716-8dac-df9dadc5dc7c"><li><a href="../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../development/contributing.html">Contributing</a></li><li><a href="../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="6ba322f1-d0e3-498b-8bed-fd5a2c80470b"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul><ul class="dropdown-content" id="b491d241-4d71-43f9-b578-19bf98bf6098"><li><a href="installation.html">Install Moltres</a></li><li><a href="theory.html">Theory</a></li><li><a href="tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="ee0fb8d0-bfa3-4851-85c8-c8506eedae15"><li><a href="../syntax/index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../development/contributing.html">Contributing</a></li><li><a href="../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="603977e9-96d5-4949-9936-a35efb888afb"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><span class="breadcrumb">getting_started</span><a href="#" class="breadcrumb">input_syntax</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="fbe5a420-761b-458b-90fa-584bfc90fa80" data-section-level="1" data-section-text="Introduction to the Moltres Input File Syntax"><h1 id="introduction-to-the-moltres-input-file-syntax">Introduction to the Moltres Input File Syntax</h1><p>The input file example documented here is taken from <a href="https://github.com/arfc/moltres/blob/devel/tutorial/eigenvalue/nts.i"><code>moltres/tutorial/eigenvalue/nts.i</code></a> for the Eigenvalue Calculation tutorial. This is a simple 2-D axisymmetric core model of the Molten Salt Reactor Experiment (MSRE) that was developed at Oak Ridge National Laboratory and was operated from 1965 through 1969. Simulation results from a similar 2-D model are documented in the article, <a href="http://arfc.github.io/papers/lindsay_introduction_2018.pdf">Introduction to Moltres: An application for simulation of Molten Salt Reactors</a>, which discusses simulation results, and compares them to a 3-D Moltres model of the MSRE and to MSRE data and calculated results. </p><p>Assuming that Moltres has been successfully compiled, to execute this input file from the command line, run the following from a terminal window, substituting <code>$moltres_root</code> with the path to the Moltres root directory:</p><pre class="moose-pre"><code class="language-text">
cd $moltres_root/tutorial/eigenvalue
../../moltres-opt -i nts.i
</code></pre><p>In serial, this job takes around 9 seconds on a 4.3 GHz machine. To run the job in parallel, execute:</p><pre class="moose-pre"><code class="language-text">
mpirun -n 2 ../../moltres-opt -i nts.i
</code></pre><p>where the number of processors can be changed from 2 to however many processes you want to run. The parallel performance of the job depends on the number of degrees of freedom in the problem and the preconditioner used. A general rule of thumb for optimal scaling is not to go below 10k degrees of freedom per processor, otherwise communication becomes a performance drag. Additionally many preconditioners do not perform as well when spread over multiple processes as they lose access to &quot;new&quot; information. (See http://www.mcs.anl.gov/petsc/documentation/faq.html#slowerparallel for more discussion of this). This particular input file (<code>nts.i</code>) only has 9,308 degrees of freedom so communication is a factor; we can get faster solution time with more processors, albeit at sublinear scaling. On the same 4.3 GHz machine, the solution times for 1-4 processors are given below.</p><ul class="browser-default"><li><p>Single processor solution time: 9.1 seconds </p></li><li><p>Two processors: 5.4 seconds </p></li><li><p>Four processors: 3.6 seconds</p></li></ul><p>The Exodus output file corresponding to the input file under discussion will be generated as <code>nts.e</code> after running the input file. The most common application for visualizing Exodus files is <a href="https://www.paraview.org/">ParaView</a>, although <a href="https://wci.llnl.gov/simulation/computer-codes/visit/">VisIt</a> or <a href="http://yt-project.org/">yt</a> may also be used.</p><section class="scrollspy" id="d2858c89-bbae-418d-ad6a-62065da57641" data-section-level="2" data-section-text="Model Geometry"><h2 id="model-geom">Model Geometry</h2><p>The figure below shows the domain for the 2-D MSRE model. It is a 72.2 cm by 165 cm rectangle that is axisymmetric about the left boundary. The domain consists of 14 fuel channels, alternating with 14 solid graphite moderator regions, represented in the figure by gray and red rectangles, respectively.</p><div class="card moose-float" style="width:35%;text-align:center;margin-left:auto;margin-right:auto;" id="msre-2d"><div class="card-content"><picture class="materialboxed moose-image"><img src="../media/msre_2d.png"></img></picture><p class="moose-caption"><span class="moose-caption-heading">Figure 1: </span><span class="moose-caption-text" id="msre-2d">2-D axisymmetric model of the MSRE</span></p></div></div></section><section class="scrollspy" id="87bc4eb4-e591-4ee8-b41f-f6843b019f29" data-section-level="2" data-section-text="File Format"><h2 id="file-format">File Format</h2><p>Moltres is built on top of the MOOSE framework, and the input file uses the &quot;hierarchical input text format&quot; (hit) input format adopted by MOOSE. A brief description of the input syntax is presented <a href="https://www.mooseframework.org/application_usage/input_syntax.html">here</a>. This is a relatively simple file format that uses <code>[names in brackets]</code> to mark the start of input blocks. Empty brackets <code>[]</code> are used to indicate the end of a block. <em>Note that block names and parameter names are generally case sensitive in the input file.</em> In addition, in Moltres/MOOSE input files, the <code>#</code> symbol is used to mark the start of a comment. Comments may start anywhere on a line.</p></section><section class="scrollspy" id="d8d9a766-885e-4435-bd87-b890442613bb" data-section-level="2" data-section-text="Substitution Variables"><h2 id="sub-var">Substitution Variables</h2><p>Root level variables can be used as substitution variables throughout the document by using the syntax <code>${varname}</code>. Starting at the top of the input file, the following substitution variables are defined:</p><pre class="moose-pre"><code class="language-text">
flow_velocity=17.55  # cm/s
</code></pre><p><code>flow_velocity</code> is used to set the upward flow velocity of the fuel/molten salt in this model. Comments can be added after the <code>#</code> character for inline documentation.</p><p>You may set the flow velocity to zero to obtain the multiplication factor of this system without delayed neutron precursor (DNP) drift. Note that this input file does not model the looping of DNPs back into the core after flowing through out-of-core components. Therefore, all DNPs flowing out of the core are considered lost.</p></section><section class="scrollspy" id="2e9a575b-1825-4e5f-a59e-056183953148" data-section-level="2" data-section-text="GlobalParams Block"><h2 id="global-params">GlobalParams Block</h2><p>Following the substitution variable definitions, we have the <code>GlobalParams</code> block:</p><pre class="moose-pre"><code class="language-text">
[GlobalParams]
  num_groups = 2
  num_precursor_groups = 6
  use_exp_form = false
  group_fluxes = &#x27;group1 group2&#x27;
  temperature = temp
  sss2_input = true
  pre_concs = &#x27;pre1 pre2 pre3 pre4 pre5 pre6&#x27;
  account_delayed = true
[]
</code></pre><p>In <code>GlobalParams</code>, parameters like <code>num_groups</code> can be globally set to a value. Consequently any class (e.g. the kernel class <code>GroupDiffusion</code>) that has the parameter <code>num_groups</code> will read in a value of <code>2</code> unless it is overridden locally in its input block. It should be noted that the <code>GlobalParams</code> block and any other MOOSE input block can be placed anywhere in the input file. At execution time each block will be read when it is needed. Below is a description of the parameters included in the GlobalParams section:</p><ul class="browser-default"><li><p><code>num_groups</code>: The number of energy groups for neutron diffusion </p></li><li><p><code>num_precursor_groups</code>: The number of delayed neutron precursor groups </p></li><li><p><code>use_exp_form</code>: Whether the actual neutron/precursor fluxes/concentrations should be represented by <span class="moose-katex-inline-equation" id="moose-equation-33bca68c-ae89-412b-9cd1-0f1d00d15155"><script>var element = document.getElementById("moose-equation-33bca68c-ae89-412b-9cd1-0f1d00d15155");katex.render("u", element, {displayMode:false,throwOnError:false});</script></span> or <span class="moose-katex-inline-equation" id="moose-equation-a5f30aa7-a199-48bf-88cd-5e0b7b3b2d5f"><script>var element = document.getElementById("moose-equation-a5f30aa7-a199-48bf-88cd-5e0b7b3b2d5f");katex.render("e^u", element, {displayMode:false,throwOnError:false});</script></span> where <span class="moose-katex-inline-equation" id="moose-equation-b8cad84a-92a9-4c45-92d3-7a68557f18b9"><script>var element = document.getElementById("moose-equation-b8cad84a-92a9-4c45-92d3-7a68557f18b9");katex.render("u", element, {displayMode:false,throwOnError:false});</script></span> is the actual variable value </p></li><li><p><code>group_fluxes</code>: The names of the neutron group fluxes </p></li><li><p><code>temperature</code>: The name of the temperature variable. Some of the kernel or boundary  condition variables require an input named <code>temperature</code> which specifies the  variable used to represent temperature. The variable <code>temp</code> will be specified  below in the <code>[Variables]</code> block. </p></li><li><p><code>sss2_input</code>: True if the macroscopic group constants were generated by Serpent 2 or OpenMC. False otherwise </p></li><li><p><code>pre_concs</code>: The names of the precursor concentration variables </p></li><li><p><code>account_delayed</code>: Whether to account for delayed neutron production. Modifies the neutron source term</p></li></ul></section><section class="scrollspy" id="995bae5a-e9c0-409f-91f4-04c704861dbe" data-section-level="2" data-section-text="Mesh Block"><h2 id="mesh">Mesh Block</h2><p>Next in our input file we have the <code>Mesh</code> block. The two most commonly used <code>Mesh</code> types are <code>FileMesh</code> and <code>GeneratedMesh</code>. The <code>Mesh</code> input block by default assumes type <code>FileMesh</code> and takes a parameter argument <code>file = &lt;mesh_file_name&gt;</code>.</p><pre class="moose-pre"><code class="language-text">
[Mesh]
  coord_type = RZ
  [mesh]
    type = FileMeshGenerator
    file = &#x27;mesh.e&#x27;
  []
[]
</code></pre><p>We use <code>coord_type</code> to indicate to Moltres that this is a 2-D axisymmetric problem. By default, it takes a xy-coordinate mesh and considers the y-axis (x=0) to be the axis of symmetry.</p><p>MOOSE has an extensive <code>MeshGenerators</code> system for generating simple meshes or making simple edits. We refer the reader <a href="https://mooseframework.inl.gov/syntax/Mesh/index.html#c5bbb23b-df10-499b-93c5-3c6380133731">here</a> for more information about the system. The <code>mesh.i</code> file uses this system to generate the mesh for the parallel channel structure of the 2-D MSRE model. The &#x27;mesh.e&#x27; file for this tutorial can be generated by running the following command:</p><pre class="moose-pre"><code class="language-text">
../../moltres-opt -i mesh.i --mesh-only mesh.e
</code></pre><p>Many MOOSE users generate more complex meshes using Cubit/Trelis. For national lab employees this software is free; however, academic or industry users must pay. Consequently, many of Moltres meshes to date have been generated using <code>MeshGenerators</code> or the open-source software <a href="http://gmsh.info/">gmsh</a>. Gmsh binaries for Windows, Mac, and Linux as well as source code can be downloaded <a href="http://gmsh.info/#Download">here</a>. Ubuntu users may also install Gmsh using <code>sudo apt-get install gmsh</code>. We will not go into the details of using Gmsh but the interested user should peruse its <a href="http://gmsh.info/doc/texinfo/gmsh.html">documentation</a>. There are many example Gmsh input files in the Moltres repository (denoted by the <code>.geo</code> extension). To generate a mesh for use with Moltres, a typical bash command is <code>gmsh -2 -o file_name.msh file_name.geo</code> where <code>2</code> should be replaced with the dimension of the mesh, the argument following <code>-o</code> is the name of the output <code>.msh</code> file, and the last argument is the input <code>.geo</code> file.</p></section><section class="scrollspy" id="d040903c-9b50-4c48-96f4-d31b1062b168" data-section-level="2" data-section-text="Problem Block"><h2 id="problem">Problem Block</h2><p>The <code>Problem</code> block is used to indicate the type of problem we are solving. MOOSE automatically identifies which problem class is suitable for your simulation type (e.g., <code>FEProblem</code> or <code>EigenProblem</code>). However, for this particular input file, we want to set the <code>bx_norm</code> parameter for determining the eigenvalue estimate during each iteration of the eigensolver. Therefore, this input file requires us to indicate the problem type and the <code>bx_norm</code> parameter.</p><pre class="moose-pre"><code class="language-text">
[Problem]
  type = EigenProblem
  bx_norm = bnorm
[]
</code></pre></section><section class="scrollspy" id="a338cab1-e7a9-4604-96ec-86f5b529aea9" data-section-level="2" data-section-text="Variables Block"><h2 id="variables">Variables Block</h2><p>The <code>Variables</code> block is used to indicate the primary solution variables, or equivalently, to indicate the number of partial differential equations (PDEs) that will be defined in the <a href="input_syntax.html#Kernels">Kernels</a> and <a href="input_syntax.html#BCs">BCs</a> blocks. For this model, the <code>group1</code> and <code>group2</code> neutron fluxes are the system variables that are being solved for by the PDEs. In the <a href="input_syntax.html#Kernels">Kernels</a> and <a href="input_syntax.html#BCs">BCs</a> blocks described below, each kernel and BC term must be associated with one primary variable from the <code>Variables</code> list below to indicate which PDE the term is included in.</p><pre class="moose-pre"><code class="language-text">
[Variables]
  [group1]
    order = FIRST
    family = LAGRANGE
  []
  [group2]
    order = FIRST
    family = LAGRANGE
  []
[]
</code></pre><p>Sub-blocks are initialized with <code>[&lt;object_name&gt;]</code> and closed with <code>[]</code>. The <code>[group1]</code> sub-block creates a <code>MooseVariable</code> object with the name <code>group1</code>. The parameters purpose of the parameter is as follows:</p><ul class="browser-default"><li><p><code>family</code> describes the shape function type used to form the approximate finite element solution. </p></li><li><p><code>order</code> denotes the polynomial order of the shape functions. </p></li><li><p><code>initial_condition</code> is an optional parameter that can be used to set a spatially uniform initial value for the variable. </p></li><li><p><code>scaling</code> is another optional parameter that can be used to scale the residual of the corresponding variable; this is usually done when different variables have residuals of different orders of magnitude.</p></li></ul></section><section class="scrollspy" id="2dfeedce-bebe-425e-a431-aa82c43913c0" data-section-level="2" data-section-text="Precursors Block"><h2 id="precursors">Precursors Block</h2><p>Whereas all the other blocks that have been introduced are standard MOOSE blocks, <code>Precursors</code> is a custom input file block unique to Moltres. The <code>Precursors</code> action sets up the delayed neutron precursor concentration equations:</p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-788a9c93-2ca4-4dc6-a9a3-c50f72db49ae"></span><script>var element = document.getElementById("moose-equation-788a9c93-2ca4-4dc6-a9a3-c50f72db49ae");katex.render("\\frac{\\partial C_i}{\\partial t} + \\bar{u} \\cdot \\nabla C_i + \\lambda_i C_i    - \\sum_{g'=1}^{G} \\beta_i \\nu \\Sigma_{g'}^f \\phi_{g'} = 0", element, {displayMode:true,throwOnError:false});</script></span><p>The precursor variables, kernels, and boundary conditions necessary for solving the precursor governing equations are all instantiated by the <code>Precursors</code> action. Six precursor groups (symbolized by the index i in the equation above) are modeled, as specified via the <code>num_precursor_groups</code> in the <a href="input_syntax.html#global-params"><code>GlobalParams</code></a> block. <span class="moose-katex-inline-equation" id="moose-equation-8c1a512b-accf-4ad5-b946-9d5fb6a78240"><script>var element = document.getElementById("moose-equation-8c1a512b-accf-4ad5-b946-9d5fb6a78240");katex.render("G", element, {displayMode:false,throwOnError:false});</script></span> is the number of neutron flux energy groups, and <span class="moose-katex-inline-equation" id="moose-equation-44d5307e-5350-419e-ab06-fc9e80d72124"><script>var element = document.getElementById("moose-equation-44d5307e-5350-419e-ab06-fc9e80d72124");katex.render("g'", element, {displayMode:false,throwOnError:false});</script></span> is the index associated with the energy groups. For this problem two energy groups are modeled, with the equations configured explicitly in the <a href="input_syntax.html#Kernels">Kernels</a> and <a href="input_syntax.html#BCs">BCs</a> blocks documented after this section.</p><pre class="moose-pre"><code class="language-text">
[Precursors]
  [./pres]
    var_name_base = pre
    family = MONOMIAL
    order = CONSTANT
    block = &#x27;fuel&#x27;
    outlet_boundaries = &#x27;fuel_top&#x27;
    constant_velocity_values = true
    u_def = 0
    v_def = ${flow_velocity}
    w_def = 0
    nt_exp_form = false
    loop_precursors = false
    transient = false
    eigen = true
  [../]
[]
</code></pre><p>Parameter descriptions:</p><ul class="browser-default"><li><p><code>var_name_base</code>: The prefix for the precursor variable names. Name suffixes are numbers, e.g. <code>pre1, pre2, ...</code> </p></li><li><p><code>block</code>: This is a parameter ubiquitous to many MOOSE classes such as kernels and materials. By specifying a value for <code>block</code> the user is asking that in this case, precursors and their associated governing equations only be solved for in the <code>fuel</code> mesh subdomains </p></li><li><p><code>outlet_boundaries</code>: The mesh boundaries from which the precursors flow out </p></li><li><p><code>u_def, v_def, w_def</code>: The x, y, and z components of velocity, or in the case of an RZ simulation, <code>u_def</code> is the r velocity component, <code>v_def</code> is the z-component, and <code>w_def</code> has no meaning </p></li><li><p><code>nt_exp_form</code>: Whether the neutron group fluxes have their concentrations in an exponential form. If <code>use_exp_form</code> is false in the <code>GlobalParams</code> block, this should also be false </p></li><li><p><code>loop_precursors</code>: Whether the DNPs are looped back into the core through the flow inlet </p></li><li><p><code>transient</code>: Whether this is a transient or time-independent simulation </p></li><li><p><code>eigen</code>: Whether this is an eigenvalue problem</p></li></ul></section><section class="scrollspy" id="1519ba35-c9e7-4ad7-85b5-4fb63a518eac" data-section-level="2" data-section-text="Kernels Block"><h2 id="kernels">Kernels Block</h2><p>The <code>Kernels</code> block is used to construct PDEs that are included in the system of equations that are solved. Each PDE has a primary variable that is being solved for, and the list of variables being solved for is defined in the <a href="input_syntax.html#variables">Variables</a> block shown above. There is an additional PDE solved as part of the system of PDEs for each variable defined in the <code>Variables</code> section. In this case, three solution variables were defined in the variable section:</p><ul class="browser-default"><li><p>The <code>group1</code> fast group neutron flux. </p></li><li><p>The <code>group2</code> thermal group neutron flux.</p></li></ul><p>Note that additional precursor variables are automatically defined by the <a href="input_syntax.html#precursors"><code>Precursors</code></a> block.</p><p>The <code>Kernels</code> section defines a set of &quot;Kernels&quot;, where a &quot;Kernel&quot; represents a single term included in a PDE. A PDE is constructed by specifying the set of terms (or Kernels) that will be included in the PDE in the <code>Kernels</code> block, and by specifying which PDE the kernel is associated with. This is done by indicating which of the above three variables the kernel is associated with (i.e., <code>group1</code> or <code>group2</code>).</p><p>Thus, each entry in the <code>Kernels</code> block specifies a term to include in one of PDEs that are solved. The <code>type = &lt;kernel type&gt;</code> parameter associated with a kernel entry identifies the term (or Kernel) that will be included in the PDE, and the <code>variable = &lt;primary variable&gt;</code> value indicates the primary solution variable (from the <a href="input_syntax.html#Variables">Variables</a> block) associated with the term, or equivalently which PDE the term will be included in. MOOSE provides several standard kernels that can be included in a PDE. Moltres defines an additional set of kernels that are useful in modeling neutron flux and associated phenomenon in molten salt reactors. The mathematical form of each Moltres kernel can be found its corresponding documentation webpage on <a href="../syntax/index.html">Moltres Syntax</a>.</p><p>Kernels can be optionally restricted to specific subdomains within the model by setting <code>block = &lt;subdomain_names&gt;</code>. Note that this implies that the form of the equation that is solved may differ in different mesh regions. The equations that are modeled are represented below, followed by the input required to construct these equations. In the <code>group1</code> and <code>group2</code> neutron flux equations below and in the input that follows, notice that the fission kernel (<code>CoupledFissionKernel</code>) is only included in the fuel region (&#x27;0&#x27;), and is not included in the moderator region (&#x27;1&#x27;) since there is no fuel in the moderator region. Also, the <code>DelayedNeutronSource</code> kernel, which contributes neutrons from the precursor group equations, is only included as part of the <code>group1</code> or fast group equation.</p><p><strong>Neutron Diffusion Equation for the <em>k</em>-Eigenvalue Problem with <code>group1</code> and <code>group2</code> Variables (g = 1 or 2)</strong></p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-29a20f05-748a-4033-938a-dc7b7459cf43"></span><script>var element = document.getElementById("moose-equation-29a20f05-748a-4033-938a-dc7b7459cf43");katex.render("\\underbrace{\\frac{1}{v_g}\\frac{\\partial \\phi_g}{\\partial t}}_{NtTimeDerivative}   + \\underbrace{\\Sigma_g^r \\phi_g}_{SigmaR}   - \\underbrace{\\nabla \\cdot D_g \\nabla \\phi_g}_{GroupDiffusion}   - \\underbrace{\\sum_{g \\ne g'}^G \\Sigma_{g'\\rightarrow g}^s \\phi_{g'}}_{InScatter}   - \\underbrace{\\chi_g^p \\sum_{g' = 1}^G (1 - \\beta) \\frac{\\nu \\Sigma_{f,g'}}{k} \\phi_{g'}}_{\\substack{CoupledFissionKernel\\\\ \\textrm{'Fuel' region only}}}   - \\underbrace{\\chi_g^d \\sum_i^I \\lambda_i C_i}_{\\substack{DelayedNeutronSource\\\\ \\textrm{'Fuel' region only} \\\\ \\textrm{Not in group2 Eqn}}}   = 0", element, {displayMode:true,throwOnError:false});</script></span><p>The <code>extra_vector_tags = eigen</code> parameter indicates all kernels to be scaled by the <span class="moose-katex-inline-equation" id="moose-equation-d2d8b24b-50e4-4a19-b92e-ecffd5da9ec2"><script>var element = document.getElementById("moose-equation-d2d8b24b-50e4-4a19-b92e-ecffd5da9ec2");katex.render("1/k", element, {displayMode:false,throwOnError:false});</script></span> eigenvalue in this eigenvalue problem. This parameter is omitted for non-eigenvalue problems discussed in the other tutorial problems.</p><pre class="moose-pre"><code class="language-text">
[Kernels]
  #---------------------------------------------------------------------
  # Group 1 Neutronics
  #---------------------------------------------------------------------
  [sigma_r_group1]
    type = SigmaR
    variable = group1
    group_number = 1
  []
  [diff_group1]
    type = GroupDiffusion
    variable = group1
    group_number = 1
  []
  [inscatter_group1]
    type = InScatter
    variable = group1
    group_number = 1
  []
  [fission_source_group1]
    type = CoupledFissionKernel
    variable = group1
    group_number = 1
    block = &#x27;0&#x27;
    extra_vector_tags = &#x27;eigen&#x27;
  []
  [delayed_group1]
    type = DelayedNeutronSource
    variable = group1
    block = &#x27;0&#x27;
    group_number = 1
  []

  #---------------------------------------------------------------------
  # Group 2 Neutronics
  #---------------------------------------------------------------------
  [sigma_r_group2]
    type = SigmaR
    variable = group2
    group_number = 2
  []
  [diff_group2]
    type = GroupDiffusion
    variable = group2
    group_number = 2
  []
  [fission_source_group2]
    type = CoupledFissionKernel
    variable = group2
    group_number = 2
    block = &#x27;0&#x27;
    extra_vector_tags = &#x27;eigen&#x27;
  []
  [inscatter_group2]
    type = InScatter
    variable = group2
    group_number = 2
  []
[]
</code></pre></section><section class="scrollspy" id="94966aea-fe34-4b13-829a-f6bffbca293f" data-section-level="2" data-section-text="BCs Block"><h2 id="bcs">BCs Block</h2><p>The <code>BCs</code> block is very similar to the <code>Kernels</code> block except the <code>boundary = &lt;boundary_names&gt;</code> parameter must be specified to indicate where the boundary conditions should be applied. Documentation for the BCs can be also found on the <a href="../syntax/index.html">Moltres Syntax</a> page.</p><pre class="moose-pre"><code class="language-text">
[BCs]
  [vacuum_group1]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top mod_bottom mod_top right&#x27;
    variable = group1
  []
  [vacuum_group2]
    type = VacuumConcBC
    boundary = &#x27;fuel_bottom fuel_top mod_bottom mod_top right&#x27;
    variable = group2
  []
[]
</code></pre></section><section class="scrollspy" id="701bd8cd-5035-4f29-8b78-b189cf6aed02" data-section-level="2" data-section-text="Materials Block"><h2 id="materials">Materials Block</h2><p>In the <code>Materials</code> block, we specify materials that live on a mesh subdomain. Any given subdomain can have as many material definitions as desired, so long as a property is not multiply defined. We use <code>MoltresJsonMaterial</code> here which is used to parse the JSON-based group constant data file.</p><pre class="moose-pre"><code class="language-text">
[Materials]
  [fuel]
    type = MoltresJsonMaterial
    block = &#x27;0&#x27;
    base_file = &#x27;xsdata.json&#x27;
    material_key = &#x27;fuel&#x27;
    interp_type = LINEAR
    prop_names =&#x27;&#x27;
    prop_values = &#x27;&#x27;
  []
  [graphite]
    type = MoltresJsonMaterial
    block = &#x27;1&#x27;
    base_file = &#x27;xsdata.json&#x27;
    material_key = &#x27;graphite&#x27;
    interp_type = LINEAR
    prop_names =&#x27;&#x27;
    prop_values = &#x27;&#x27;
  []
[]
</code></pre><p>Materials within the <code>Materials</code> block support the following parameters:</p><ul class="browser-default"><li><p><code>base_file</code>: The relative/absolute path and name of the JSON file containing the macroscopic group constants that define neutron interactions in this material. </p></li><li><p><code>material_key</code>: The name of the material in the JSON file that corresponds to this <code>Material</code> object.</p><p></p></li><li><p><code>interp_type</code>: The type of fitting/interpolation to be carried out on the temperature grid. Options are:</p><ul class="browser-default"><li><p><code>spline</code>: Cubic spline interpolation </p></li><li><p><code>linear</code>: Linear spline interpolation </p></li><li><p><code>monotone_cubic</code>: Monotone cubic interpolation </p></li><li><p><code>none</code>: Only should be used when single values for constants are supplied   at a single temperature</p></li></ul><p></p></li><li><p><code>prop_names, prop_values</code>: name-value pairs used to define material property values from the input file. For example, the density <span class="moose-katex-inline-equation" id="moose-equation-cb5a5d2a-e92e-49b9-9024-412754b67551"><script>var element = document.getElementById("moose-equation-cb5a5d2a-e92e-49b9-9024-412754b67551");katex.render("\\rho", element, {displayMode:false,throwOnError:false});</script></span>, thermal conductivity <span class="moose-katex-inline-equation" id="moose-equation-088f76fe-9d8a-4f05-8116-a075b07ce5b4"><script>var element = document.getElementById("moose-equation-088f76fe-9d8a-4f05-8116-a075b07ce5b4");katex.render("k", element, {displayMode:false,throwOnError:false});</script></span>, and the specific heat capacity <span class="moose-katex-inline-equation" id="moose-equation-02c83588-a13c-4d10-964f-4abead5def83"><script>var element = document.getElementById("moose-equation-02c83588-a13c-4d10-964f-4abead5def83");katex.render("c_p", element, {displayMode:false,throwOnError:false});</script></span> may be defined for simulations involving a temperature variable.</p></li></ul></section><section class="scrollspy" id="6a127e8b-3b89-4afe-bba7-e3fe2c690e80" data-section-level="2" data-section-text="Executioner and Preconditioning Blocks"><h2 id="executioner">Executioner and Preconditioning Blocks</h2><p>The <code>Executioner</code> and <code>Preconditioning</code> blocks are essential for setting the method used to solve the system of non-linear equations created by finite element discretization of our molten salt reactor governing equations. <code>Executioner</code> and <code>Preconditioning</code> documentation can be found <a href="https://www.mooseframework.org/syntax/Executioner/index.html">here</a> and <a href="https://www.mooseframework.org/syntax/Preconditioning/index.html">here</a> respectively. You may also refer to our <a href="getting_started/recommended">guide</a> for basic instructions.</p><pre class="moose-pre"><code class="language-text">
[Executioner]
  type = Eigenvalue
  initial_eigenvalue = 1
  solve_type = &#x27;PJFNK&#x27;
  petsc_options = &#x27;-snes_converged_reason -ksp_converged_reason -snes_linesearch_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_hypre_type&#x27;
  petsc_options_value = &#x27;hypre boomeramg&#x27;

  automatic_scaling = true
  compute_scaling_once = false
  resid_vs_jac_scaling_param = 0.1

  line_search = none
[]
</code></pre></section><section class="scrollspy" id="6b9d3e64-dce6-4bd8-b1d1-a263a194d772" data-section-level="2" data-section-text="Postprocessors Block"><h2 id="postprocessors">Postprocessors Block</h2><p>A <code>PostProcessor</code> computes a single scalar value during the simulations. General postprocessor documentation can be found <a href="https://www.mooseframework.org/syntax/Postprocessors/index.html">here</a>. </p><p><code>k_eff</code> retrieves the real part of the computed eigenvalue which is taken to be the <span class="moose-katex-inline-equation" id="moose-equation-8724f5b4-8f1f-4c75-b29e-4a56abc243eb"><script>var element = document.getElementById("moose-equation-8724f5b4-8f1f-4c75-b29e-4a56abc243eb");katex.render("k", element, {displayMode:false,throwOnError:false});</script></span> multiplication factor. The <code>bnorm</code>, <code>tot_fissions</code>, and <code>powernorm</code> postprocessor objects calculate the total number of fission neutrons, fission interactions, and fission heat, respectively. The <code>bnorm</code> parameter is required by the <code>Eigenvalue</code> executioner as an estimate for <span class="moose-katex-inline-equation" id="moose-equation-b6ecccee-abb5-46c0-bcf5-5a46cef31c69"><script>var element = document.getElementById("moose-equation-b6ecccee-abb5-46c0-bcf5-5a46cef31c69");katex.render("k", element, {displayMode:false,throwOnError:false});</script></span> in each iteration. The other two may be used to normalize the flux solution at the end of the calculation through the <code>normalization</code> and <code>normal_factor</code> parameters in the <code>Executioner</code> block. The rest of the postprocessors calculate the integral sum, diff, or maximum values of the <code>group1</code> and <code>group2</code> flux variables.</p><pre class="moose-pre"><code class="language-text">
[Postprocessors]
  [k_eff]
    type = VectorPostprocessorComponent
    index = 0
    vectorpostprocessor = k_vpp
    vector_name = eigen_values_real
  []
  [bnorm]
    type = ElmIntegTotFissNtsPostprocessor
    execute_on = linear
  []
  [tot_fissions]
    type = ElmIntegTotFissPostprocessor
    execute_on = linear
  []
  [powernorm]
    type = ElmIntegTotFissHeatPostprocessor
    execute_on = linear
  []
  [group1norm]
    type = ElementIntegralVariablePostprocessor
    variable = group1
    execute_on = linear
  []
  [group1max]
    type = NodalExtremeValue
    value_type = max
    variable = group1
    execute_on = timestep_end
  []
  [group1diff]
    type = ElementL2Diff
    variable = group1
    execute_on = &#x27;linear timestep_end&#x27;
  []
  [group2norm]
    type = ElementIntegralVariablePostprocessor
    variable = group2
    execute_on = linear
  []
  [group2max]
    type = NodalExtremeValue
    value_type = max
    variable = group2
    execute_on = timestep_end
  []
  [group2diff]
    type = ElementL2Diff
    variable = group2
    execute_on = &#x27;linear timestep_end&#x27;
  []
[]
</code></pre></section><section class="scrollspy" id="b89cae21-87cc-4dce-a990-43f449c23eca" data-section-level="2" data-section-text="Outputs Block"><h2 id="outputs">Outputs Block</h2><p>In the <code>Outputs</code> block, we can control the settings for various data output formats. <code>Outputs</code> documentation is <a href="https://www.mooseframework.org/syntax/Outputs/index.html">here</a>. In this input file, the Exodus and CSV output formats are enabled with default settings associated with each output type. <code>print_graph</code> prints various computational performance information in the console (e.g., time taken in each section of the simulation). <code>print_linear_residuals</code> prints all linear residual values during the simulation, which may be desired when running test runs.</p><pre class="moose-pre"><code class="language-text">
[Outputs]
  print_graph = true
  print_linear_residuals = true
  [exodus]
    type = Exodus
  []
  [csv]
    type = CSV
  []
[]
</code></pre></section><section class="scrollspy" id="6e79490c-2c9a-4933-9ada-55e727d2dcc1" data-section-level="2" data-section-text="Debug Block"><h2 id="debug">Debug Block</h2><p>This parameter tells Moltres to print the variable residual norms during the non-linear solve. Residual information is useful for debugging convergence issues by identifying which variable is exhibiting slow or no convergence behavior.</p><pre class="moose-pre"><code class="language-text">
[Debug]
  show_var_residual_norms = true
[]
</code></pre></section></section></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#d2858c89-bbae-418d-ad6a-62065da57641" class="tooltipped" data-position="left" data-tooltip="Model Geometry">Model Geometry</a></li><li><a href="#87bc4eb4-e591-4ee8-b41f-f6843b019f29" class="tooltipped" data-position="left" data-tooltip="File Format">File Format</a></li><li><a href="#d8d9a766-885e-4435-bd87-b890442613bb" class="tooltipped" data-position="left" data-tooltip="Substitution Variables">Substitution Variables</a></li><li><a href="#2e9a575b-1825-4e5f-a59e-056183953148" class="tooltipped" data-position="left" data-tooltip="GlobalParams Block">GlobalParams Block</a></li><li><a href="#995bae5a-e9c0-409f-91f4-04c704861dbe" class="tooltipped" data-position="left" data-tooltip="Mesh Block">Mesh Block</a></li><li><a href="#d040903c-9b50-4c48-96f4-d31b1062b168" class="tooltipped" data-position="left" data-tooltip="Problem Block">Problem Block</a></li><li><a href="#a338cab1-e7a9-4604-96ec-86f5b529aea9" class="tooltipped" data-position="left" data-tooltip="Variables Block">Variables Block</a></li><li><a href="#2dfeedce-bebe-425e-a431-aa82c43913c0" class="tooltipped" data-position="left" data-tooltip="Precursors Block">Precursors Block</a></li><li><a href="#1519ba35-c9e7-4ad7-85b5-4fb63a518eac" class="tooltipped" data-position="left" data-tooltip="Kernels Block">Kernels Block</a></li><li><a href="#94966aea-fe34-4b13-829a-f6bffbca293f" class="tooltipped" data-position="left" data-tooltip="BCs Block">BCs Block</a></li><li><a href="#701bd8cd-5035-4f29-8b78-b189cf6aed02" class="tooltipped" data-position="left" data-tooltip="Materials Block">Materials Block</a></li><li><a href="#6a127e8b-3b89-4afe-bba7-e3fe2c690e80" class="tooltipped" data-position="left" data-tooltip="Executioner and Preconditioning Blocks">Executioner and Preconditioning Blocks</a></li><li><a href="#6b9d3e64-dce6-4bd8-b1d1-a263a194d772" class="tooltipped" data-position="left" data-tooltip="Postprocessors Block">Postprocessors Block</a></li><li><a href="#b89cae21-87cc-4dce-a990-43f449c23eca" class="tooltipped" data-position="left" data-tooltip="Outputs Block">Outputs Block</a></li><li><a href="#6e79490c-2c9a-4933-9ada-55e727d2dcc1" class="tooltipped" data-position="left" data-tooltip="Debug Block">Debug Block</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../js/init.js"></script><script type="text/javascript" src="../js/navigation.js"></script><script type="text/javascript" src="../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../js/search_index.js"></script><script type="text/javascript" src="../js/sqa_moose.js"></script>