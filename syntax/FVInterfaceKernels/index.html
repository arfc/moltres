<!DOCTYPE html><head><meta charset="UTF-8"><title>FVInterfaceKernels System | Moltres</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/moltres.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Moltres</a><a href="https://github.com/arfc/moltres" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="3ff65db7-0626-4ba7-a3ad-06bc306707c4" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="a4a2588d-145e-4596-a7cd-5bf20ca8d4eb" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="ba886552-3118-475c-8ecf-dff22e0d5f3e" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#" class="sidenav-trigger" data-target="089d5a85-4fe0-400f-b697-bd68dd29a61d"><i class="material-icons">menu</i></a><ul class="sidenav" id="089d5a85-4fe0-400f-b697-bd68dd29a61d"><li><a href="#!" class="dropdown-trigger" data-target="f9cdf11e-35f0-4a27-9ba2-d55c6ee1fd78" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="19d418d3-51d3-4d80-98d9-6b1395ab0baf" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="8a4efc79-2a80-4afd-bc1f-6cc308d76ce3" data-constrainWidth="false">Help<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../citing.html">Citing</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="3ff65db7-0626-4ba7-a3ad-06bc306707c4"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="a4a2588d-145e-4596-a7cd-5bf20ca8d4eb"><li><a href="../index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="ba886552-3118-475c-8ecf-dff22e0d5f3e"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul><ul class="dropdown-content" id="f9cdf11e-35f0-4a27-9ba2-d55c6ee1fd78"><li><a href="../../getting_started/installation.html">Install Moltres</a></li><li><a href="../../getting_started/tutorials.html">Tutorials</a></li></ul><ul class="dropdown-content" id="19d418d3-51d3-4d80-98d9-6b1395ab0baf"><li><a href="../index.html">Moltres Syntax</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Syntax</a></li><li><a href="../../doxygen/classes.html">Moltres Doxygen</a></li><li><a href="https://mooseframework.inl.gov/docs/doxygen/moose/classes.html">MOOSE Doxygen</a></li><li><a href="../../development/contributing.html">Contributing</a></li><li><a href="../../publications.html">List of Publications</a></li></ul><ul class="dropdown-content" id="8a4efc79-2a80-4afd-bc1f-6cc308d76ce3"><li><a href="https://github.com/arfc/moltres/discussions">Moltres Discussion Forum</a></li><li><a href="https://github.com/idaholab/moose/discussions">MOOSE Discussion Forum</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">syntax</a><a href="." class="breadcrumb">FVInterfaceKernels</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="065908c5-a922-43e5-91e1-ec953b73b3bd" data-section-level="1" data-section-text="FVInterfaceKernels System"><h1 id="fvinterfacekernels-system">FVInterfaceKernels System</h1><p>For an overview of MOOSE FV please see <a href="../../finite_volumes/fv_design.html">Finite Volume Design Decisions in MOOSE</a>.</p><p><code>FVInterfaceKernels</code> are meant to communicate data at interfaces between subdomains. An <code>FVInterfaceKernel</code> may contribute to the residuals/Jacobians of a single variable, specified with the parameter <code>variable1</code>, or to multiple variables by also using the <code>variable2</code> parameter. There are two additional critical/required parameters: <code>subdomain1</code> and <code>subdomain2</code>. In cases for which an <code>FVInterfaceKernel</code> is operating on two variables, <code>subdomain1</code> should correspond to the subdomain(s) neighboring the <code>boundary</code> parameter that <code>variable1</code> lives on, and similarly for <code>subdomain2</code> and <code>variable2</code>. By checking the <code>subdomain</code> parameters against the subdomain IDs of the <code>FaceInfo::elem</code> and <code>FaceInfo::neighbor</code> members a <code>FVInterfaceKernel</code> developer can be sure that they are fetching and using sensical data. For instance, a developer may want to create an <code>FVInterfaceKernel</code> that uses <code>prop1</code> on the <code>subdomain1</code> side of the <code>boundary</code> and <code>prop2</code> on the <code>subdomain2</code> side of the boundary. However, MOOSE only provides these APIs for fetching material properties: <code>get(AD)MaterialProperty</code> and <code>getNeighbor(AD)MaterialProperty</code>. The return value of <code>get(AD)MaterialProperty</code> will always correspond to a material property evaluation on the <code>FaceInfo::elem</code> side of a (inter)face, while the return value of <code>getNeighbor(AD)MaterialProperty</code> will always correspond to a material property evaluation on the <code>FaceInfo::neighbor</code> side of a (inter)face. However, when moving along an interface, it is possible that the <code>FaceInfo::elem</code> side of the interface is sometimes the <code>subdomain1</code> side and sometimes the <code>subdomain2</code> side. So making use of the <code>subdomain</code> parameters, we provide a protected method called <code>elemIsOne()</code> that returns a boolean indicating whether the <code>FaceInfo::elem</code> side of the interface corresponds to the <code>subdomain1</code> side of the interface. This allows the developer to write code like the following:</p><pre class="moose-pre"><code class="language-text">
FVFooInterface::FVFooInterface(const InputParameters &amp; params)
  : FVInterfaceKernel(params),
    _coeff1_elem(getADMaterialProperty&lt;Real&gt;(&quot;coeff1&quot;)),
    _coeff2_elem(getADMaterialProperty&lt;Real&gt;(&quot;coeff2&quot;)),
    _coeff1_neighbor(getNeighborADMaterialProperty&lt;Real&gt;(&quot;coeff1&quot;)),
    _coeff2_neighbor(getNeighborADMaterialProperty&lt;Real&gt;(&quot;coeff2&quot;))
{
}

ADReal
FVFooInterface::computeQpResidual()
{
  const auto &amp; coef_elem = elemIsOne() ? _coeff1_elem : _coeff2_elem;
  const auto &amp; coef_neighbor = elemIsOne() ? _coeff2_neighbor : _coeff1_neighbor;

  /// Code that uses coef_elem and coef_neighbor
}
</code></pre><p>and have confidence that they have good data in <code>coef_elem</code> and <code>coef_neighbor</code> and have clarity about what is happening in their code.</p><div class="card moose-alert moose-alert-note"><div class="card-title moose-alert-title"><i class="material-icons moose-inline-icon">comment</i><span class="moose-alert-title-brand">note</span></div><div class="card-content"><div class="moose-alert-content"><p>When using an FVInterfaceKernel which connects variables that belong to different nonlinear systems, create two kernels with flipped variable and material property parameters. The reason behind this is that the interface kernel will only contribute to the system which <code>variable1</code> belongs to. For an example, see:</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Mesh]
  [gmg]
    type = CartesianMeshGenerator
    dim = 1
    ix = &#x27;50 50&#x27;
    dx = &#x27;1 1&#x27;
    subdomain_id = &#x27;0 1&#x27;
  []
  [sds]
    type = SideSetsBetweenSubdomainsGenerator
    input = gmg
    new_boundary = &#x27;between&#x27;
    paired_block = &#x27;1&#x27;
    primary_block = &#x27;0&#x27;
  []
[]

[Problem]
  nl_sys_names = &#x27;u v&#x27;
  error_on_jacobian_nonzero_reallocation = true
[]

[Variables]
  [u]
    type = MooseVariableFVReal
    nl_sys = &#x27;u&#x27;
    block = 0
  []
  [v]
    type = MooseVariableFVReal
    nl_sys = &#x27;v&#x27;
    block = 1
  []
[]

[FVKernels]
  [diff_u]
    type = FVDiffusion
    variable = u
    coeff = 3.0
  []
  [force_u]
    type = FVBodyForce
    variable = u
    function = 5
  []
  [diff_v]
    type = FVDiffusion
    variable = v
    coeff = 1.0
  []
  [force_v]
    type = FVBodyForce
    variable = v
    function = 5
  []
[]

[FVInterfaceKernels]
  [diff_ik]
    type = FVDiffusionInterface
    variable1 = u
    variable2 = v
    boundary = &#x27;between&#x27;
    coeff1 = 3
    coeff2 = 1
    subdomain1 = 0
    subdomain2 = 1
  []
  [diff_ik_v]
    type = FVDiffusionInterface
    variable1 = v
    variable2 = u
    boundary = &#x27;between&#x27;
    coeff1 = 1
    coeff2 = 3
    subdomain1 = 1
    subdomain2 = 0
  []
[]

[FVBCs]
  [left_u]
    type = FVDirichletBC
    variable = u
    boundary = left
    value = 0
  []
  [right_v]
    type = FVDirichletBC
    variable = v
    boundary = right
    value = 1
  []
[]

[Executioner]
  type = SteadySolve2
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_hypre_type&#x27;
  petsc_options_value = &#x27;hypre boomeramg&#x27;
  first_nl_sys_to_solve = &#x27;u&#x27;
  second_nl_sys_to_solve = &#x27;v&#x27;
  number_of_iterations = 200
  nl_abs_tol = 1e-10
[]

[Outputs]
  print_nonlinear_residuals = false
  print_linear_residuals = false
  exodus = true
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#d72f764c-d85f-42f0-b599-22e0c405987c">(moose/test/tests/fviks/diffusion/multisystem.i)</a><p></p></div></div></div></section><div class="moose-modal modal" id="d72f764c-d85f-42f0-b599-22e0c405987c"><div class="modal-content"><h4>(moose/test/tests/fviks/diffusion/multisystem.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
  [gmg]
    type = CartesianMeshGenerator
    dim = 1
    ix = &#x27;50 50&#x27;
    dx = &#x27;1 1&#x27;
    subdomain_id = &#x27;0 1&#x27;
  []
  [sds]
    type = SideSetsBetweenSubdomainsGenerator
    input = gmg
    new_boundary = &#x27;between&#x27;
    paired_block = &#x27;1&#x27;
    primary_block = &#x27;0&#x27;
  []
[]

[Problem]
  nl_sys_names = &#x27;u v&#x27;
  error_on_jacobian_nonzero_reallocation = true
[]

[Variables]
  [u]
    type = MooseVariableFVReal
    nl_sys = &#x27;u&#x27;
    block = 0
  []
  [v]
    type = MooseVariableFVReal
    nl_sys = &#x27;v&#x27;
    block = 1
  []
[]

[FVKernels]
  [diff_u]
    type = FVDiffusion
    variable = u
    coeff = 3.0
  []
  [force_u]
    type = FVBodyForce
    variable = u
    function = 5
  []
  [diff_v]
    type = FVDiffusion
    variable = v
    coeff = 1.0
  []
  [force_v]
    type = FVBodyForce
    variable = v
    function = 5
  []
[]

[FVInterfaceKernels]
  [diff_ik]
    type = FVDiffusionInterface
    variable1 = u
    variable2 = v
    boundary = &#x27;between&#x27;
    coeff1 = 3
    coeff2 = 1
    subdomain1 = 0
    subdomain2 = 1
  []
  [diff_ik_v]
    type = FVDiffusionInterface
    variable1 = v
    variable2 = u
    boundary = &#x27;between&#x27;
    coeff1 = 1
    coeff2 = 3
    subdomain1 = 1
    subdomain2 = 0
  []
[]

[FVBCs]
  [left_u]
    type = FVDirichletBC
    variable = u
    boundary = left
    value = 0
  []
  [right_v]
    type = FVDirichletBC
    variable = v
    boundary = right
    value = 1
  []
[]

[Executioner]
  type = SteadySolve2
  solve_type = &#x27;NEWTON&#x27;
  petsc_options = &#x27;-snes_monitor&#x27;
  petsc_options_iname = &#x27;-pc_type -pc_hypre_type&#x27;
  petsc_options_value = &#x27;hypre boomeramg&#x27;
  first_nl_sys_to_solve = &#x27;u&#x27;
  second_nl_sys_to_solve = &#x27;v&#x27;
  number_of_iterations = 200
  nl_abs_tol = 1e-10
[]

[Outputs]
  print_nonlinear_residuals = false
  print_linear_residuals = false
  exodus = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>